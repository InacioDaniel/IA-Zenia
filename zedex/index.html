<!DOCTYPE html>
<html lang="pt-BR" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Zedex â€” AI Web App Generator</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ZEDEX v3 â€” by ZÃ©nia Projects
   @inacio.u.daniel
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --accent:#7c6af7;--accent2:#f06292;
  --font-ui:'Segoe UI',system-ui,sans-serif;
  --font-code:'JetBrains Mono','Fira Code','Consolas',monospace;
  --tr:0.22s ease;
}

/* â”€â”€ THEMES â”€â”€ */
[data-theme="dark"]{--bg:#0d0d0f;--panel:#13131a;--side:#111118;--card:#1a1a24;--hov:#22223a;--inp:#191924;--brd:#2a2a3d;--t1:#e8e8ff;--t2:#9898b8;--t3:#5a5a78;--hdr:rgba(13,13,15,.95);--tbar:#0f0f16;--ed:#0d0d0f;--ln:#3a3a5c;--gut:#151520;--scr:#2a2a3d}
[data-theme="light"]{--bg:#f0f0f7;--panel:#fff;--side:#f5f5fc;--card:#e8e8f5;--hov:#dcdcf0;--inp:#f8f8ff;--brd:#d0d0e8;--t1:#1a1a2e;--t2:#5050a0;--t3:#8080b0;--hdr:rgba(240,240,247,.95);--tbar:#e8e8f5;--ed:#fafafe;--ln:#b0b0d0;--gut:#f0f0fa;--scr:#c8c8e8}
[data-theme="nord"]{--bg:#242933;--panel:#2e3440;--side:#272c36;--card:#3b4252;--hov:#434c5e;--inp:#2e3440;--brd:#434c5e;--t1:#eceff4;--t2:#d8dee9;--t3:#81a1c1;--hdr:rgba(36,41,51,.97);--tbar:#2e3440;--ed:#2e3440;--ln:#4c566a;--gut:#2a3040;--scr:#4c566a;--accent:#88c0d0;--accent2:#bf616a}
[data-theme="dracula"]{--bg:#1e1f29;--panel:#282a36;--side:#21222c;--card:#313341;--hov:#393b4d;--inp:#282a36;--brd:#44475a;--t1:#f8f8f2;--t2:#bd93f9;--t3:#6272a4;--hdr:rgba(30,31,41,.97);--tbar:#21222c;--ed:#282a36;--ln:#6272a4;--gut:#21222c;--scr:#44475a;--accent:#bd93f9;--accent2:#ff79c6}
[data-theme="monokai"]{--bg:#1c1c1e;--panel:#272822;--side:#1e1e20;--card:#2f3025;--hov:#3a3b30;--inp:#272822;--brd:#383830;--t1:#f8f8f2;--t2:#a8a8a2;--t3:#75715e;--hdr:rgba(28,28,30,.97);--tbar:#1e1e20;--ed:#272822;--ln:#52524a;--gut:#222220;--scr:#383830;--accent:#a6e22e;--accent2:#f92672}
[data-theme="neon"]{--bg:#050510;--panel:#0a0a1a;--side:#07070f;--card:#0f0f22;--hov:#161630;--inp:#0a0a1a;--brd:#1a1a40;--t1:#e0e0ff;--t2:#8080d0;--t3:#4040a0;--hdr:rgba(5,5,16,.97);--tbar:#07070f;--ed:#050510;--ln:#303080;--gut:#080818;--scr:#1a1a40;--accent:#00ffc8;--accent2:#ff00aa}
[data-theme="onedark"]{--bg:#21252b;--panel:#282c34;--side:#21252b;--card:#2c313c;--hov:#333842;--inp:#282c34;--brd:#3a3f4b;--t1:#abb2bf;--t2:#636d83;--t3:#4b5263;--hdr:rgba(33,37,43,.97);--tbar:#21252b;--ed:#282c34;--ln:#4b5263;--gut:#21252b;--scr:#3a3f4b;--accent:#61afef;--accent2:#e06c75}
[data-theme="github"]{--bg:#0d1117;--panel:#161b22;--side:#0d1117;--card:#1c2128;--hov:#22272e;--inp:#161b22;--brd:#30363d;--t1:#e6edf3;--t2:#848d97;--t3:#484f58;--hdr:rgba(13,17,23,.97);--tbar:#0d1117;--ed:#0d1117;--ln:#484f58;--gut:#0d1117;--scr:#30363d;--accent:#388bfd;--accent2:#f78166}
[data-theme="solarized"]{--bg:#002b36;--panel:#073642;--side:#00303d;--card:#094652;--hov:#0d5260;--inp:#073642;--brd:#0d5260;--t1:#fdf6e3;--t2:#93a1a1;--t3:#586e75;--hdr:rgba(0,43,54,.97);--tbar:#073642;--ed:#002b36;--ln:#2a6e7b;--gut:#06303a;--scr:#0d5260;--accent:#268bd2;--accent2:#cb4b16}

/* â”€â”€ SYNTAX per theme â”€â”€ */
[data-theme="dark"]{--sk:#c792ea;--ss:#c3e88d;--sc:#546e7a;--sf:#82aaff;--sn:#f78c6c;--stg:#f07178;--sa:#ffcb6b;--sv:#c3e88d;--scl:#ffcb6b;--so:#89ddff;--svr:#f07178;--sp:#80cbc4}
[data-theme="light"]{--sk:#7c4dff;--ss:#2e7d32;--sc:#90a4ae;--sf:#1565c0;--sn:#e64a19;--stg:#c62828;--sa:#6d4c41;--sv:#2e7d32;--scl:#00695c;--so:#0097a7;--svr:#c62828;--sp:#00695c}
[data-theme="nord"]{--sk:#81a1c1;--ss:#a3be8c;--sc:#4c566a;--sf:#88c0d0;--sn:#b48ead;--stg:#bf616a;--sa:#d08770;--sv:#a3be8c;--scl:#ebcb8b;--so:#81a1c1;--svr:#bf616a;--sp:#8fbcbb}
[data-theme="dracula"]{--sk:#ff79c6;--ss:#f1fa8c;--sc:#6272a4;--sf:#50fa7b;--sn:#bd93f9;--stg:#ff5555;--sa:#ffb86c;--sv:#f1fa8c;--scl:#ffb86c;--so:#ff79c6;--svr:#ff5555;--sp:#8be9fd}
[data-theme="monokai"]{--sk:#f92672;--ss:#e6db74;--sc:#75715e;--sf:#a6e22e;--sn:#ae81ff;--stg:#f92672;--sa:#a6e22e;--sv:#e6db74;--scl:#66d9e8;--so:#f92672;--svr:#f92672;--sp:#66d9e8}
[data-theme="neon"]{--sk:#ff00aa;--ss:#00ffc8;--sc:#304080;--sf:#00d4ff;--sn:#ff8c00;--stg:#ff0055;--sa:#ffdc00;--sv:#00ffc8;--scl:#ffdc00;--so:#ff00aa;--svr:#ff0055;--sp:#00e5ff}
[data-theme="onedark"]{--sk:#c678dd;--ss:#98c379;--sc:#5c6370;--sf:#61afef;--sn:#d19a66;--stg:#e06c75;--sa:#d19a66;--sv:#98c379;--scl:#e5c07b;--so:#56b6c2;--svr:#e06c75;--sp:#56b6c2}
[data-theme="github"]{--sk:#ff7b72;--ss:#a5d6ff;--sc:#8b949e;--sf:#d2a8ff;--sn:#79c0ff;--stg:#ff7b72;--sa:#79c0ff;--sv:#a5d6ff;--scl:#ffa657;--so:#ff7b72;--svr:#ff7b72;--sp:#79c0ff}
[data-theme="solarized"]{--sk:#859900;--ss:#2aa198;--sc:#586e75;--sf:#268bd2;--sn:#d33682;--stg:#dc322f;--sa:#b58900;--sv:#2aa198;--scl:#b58900;--so:#6c71c4;--svr:#dc322f;--sp:#2aa198}

/* â”€â”€ BASE â”€â”€ */
body{font-family:var(--font-ui);background:var(--bg);color:var(--t1);height:100dvh;overflow:hidden;display:flex;flex-direction:column;transition:background var(--tr),color var(--tr)}
::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--scr);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:var(--accent)}

/* â”€â”€ HEADER â”€â”€ */
.hdr{background:var(--hdr);backdrop-filter:blur(20px);border-bottom:1px solid var(--brd);padding:0 20px;height:54px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;z-index:200;position:relative}
.logo{display:flex;align-items:center;gap:10px}
.logo-ic{width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:17px;color:#fff;box-shadow:0 0 20px color-mix(in srgb,var(--accent) 40%,transparent)}
.logo h1{font-size:18px;font-weight:700;color:var(--t1);line-height:1}
.logo span{font-size:10px;color:var(--t3)}
.hdr-r{display:flex;align-items:center;gap:8px}
.tbtn-hdr{background:var(--card);border:1px solid var(--brd);color:var(--t2);padding:7px 13px;border-radius:6px;cursor:pointer;font-size:12px;display:flex;align-items:center;gap:5px;transition:all var(--tr);font-family:var(--font-ui)}.tbtn-hdr:hover{border-color:var(--accent);color:var(--t1)}
.ham{display:none;background:var(--card);border:1px solid var(--brd);color:var(--t2);width:38px;height:38px;border-radius:8px;cursor:pointer;font-size:16px;align-items:center;justify-content:center;transition:all var(--tr)}.ham:hover{color:var(--t1);border-color:var(--accent)}

/* â”€â”€ THEME DROPDOWN â”€â”€ */
.tdrop{position:absolute;top:58px;right:20px;background:var(--panel);border:1px solid var(--brd);border-radius:12px;padding:8px;display:none;grid-template-columns:repeat(3,1fr);gap:6px;z-index:999;box-shadow:0 20px 60px rgba(0,0,0,.5);min-width:285px}
.tdrop.open{display:grid;animation:dropIn .18s ease}
@keyframes dropIn{from{opacity:0;transform:translateY(-7px)}to{opacity:1;transform:translateY(0)}}
.topt{padding:7px 10px;border-radius:8px;cursor:pointer;font-size:12px;display:flex;align-items:center;gap:6px;color:var(--t2);transition:all var(--tr);border:1px solid transparent;white-space:nowrap}.topt:hover{background:var(--hov);color:var(--t1);border-color:var(--brd)}.topt.on{background:color-mix(in srgb,var(--accent) 15%,transparent);border-color:var(--accent);color:var(--t1)}
.tsw{width:15px;height:15px;border-radius:3px;flex-shrink:0;border:1px solid rgba(255,255,255,.12)}

/* â”€â”€ TABS BAR â”€â”€ */
.tabbar{background:var(--tbar);border-bottom:1px solid var(--brd);display:flex;align-items:center;height:42px;padding:0 6px;gap:2px;flex-shrink:0}
.pagetab{padding:0 18px;height:34px;background:transparent;border:1px solid transparent;border-radius:6px;color:var(--t3);cursor:pointer;font-size:13px;font-family:var(--font-ui);display:flex;align-items:center;gap:7px;transition:all var(--tr);white-space:nowrap}.pagetab:hover{background:var(--hov);color:var(--t2)}.pagetab.on{background:color-mix(in srgb,var(--accent) 12%,transparent);border-color:color-mix(in srgb,var(--accent) 40%,transparent);color:var(--t1);font-weight:600}
.pulsedot{width:7px;height:7px;border-radius:50%;background:var(--accent);display:none;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* â”€â”€ WORKSPACE â”€â”€ */
.ws{flex:1;display:flex;overflow:hidden}
.pg{display:none;flex:1;flex-direction:column;overflow:hidden}.pg.on{display:flex}

/* â”€â”€ SIDEBAR â”€â”€ */
.sb{width:330px;background:var(--side);border-right:1px solid var(--brd);display:flex;flex-direction:column;flex-shrink:0;overflow:hidden;transition:transform var(--tr)}
.sbh{padding:15px 16px;border-bottom:1px solid var(--brd);display:flex;align-items:center;gap:9px}.sbh h2{font-size:14px;font-weight:600;color:var(--t1)}.sbh i{color:var(--accent);font-size:15px}
.sbb{flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:12px}
.lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);margin-bottom:4px}
.ta{background:var(--inp);border:1px solid var(--brd);border-radius:10px;padding:12px;font-family:var(--font-ui);font-size:13px;color:var(--t1);resize:none;outline:none;min-height:115px;width:100%;transition:border-color var(--tr);line-height:1.6}.ta:focus{border-color:var(--accent)}.ta::placeholder{color:var(--t3)}
.chips{display:flex;flex-direction:column;gap:5px}
.chip{padding:8px 12px;background:var(--card);border:1px solid var(--brd);border-radius:8px;color:var(--t2);cursor:pointer;font-size:12px;text-align:left;transition:all var(--tr);font-family:var(--font-ui)}.chip:hover{background:var(--hov);border-color:var(--accent);color:var(--t1);transform:translateX(3px)}
.genbtn{width:100%;padding:13px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;font-family:var(--font-ui);transition:all var(--tr);box-shadow:0 4px 20px color-mix(in srgb,var(--accent) 35%,transparent)}.genbtn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 28px color-mix(in srgb,var(--accent) 50%,transparent)}.genbtn:disabled{opacity:.5;cursor:not-allowed;transform:none}

/* â”€â”€ CONTENT â”€â”€ */
.cnt{flex:1;display:flex;flex-direction:column;overflow:hidden;background:var(--bg)}

/* â”€â”€ THINKING â”€â”€ */
.tkp{background:var(--panel);border-bottom:1px solid var(--brd);padding:11px 15px;font-size:12px;max-height:220px;overflow-y:auto;display:none;font-family:var(--font-code)}
.tkp.show{display:block;animation:sld .28s ease}@keyframes sld{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
.trow{display:flex;gap:8px;padding:4px 0;border-bottom:1px solid color-mix(in srgb,var(--brd) 40%,transparent);animation:fr .35s ease}.trow:last-child{border:none}
@keyframes fr{from{opacity:0;transform:translateX(-9px)}to{opacity:1;transform:translateX(0)}}
.tt{line-height:1.5;color:var(--t2)}.trow.plan .tt{color:#ffcb6b}.trow.ana .tt{color:#82aaff}.trow.gen .tt{color:var(--accent)}.trow.fin .tt{color:#c3e88d}
.csm{margin-top:8px;background:var(--ed);border-radius:6px;padding:9px;font-size:11px;max-height:110px;overflow:hidden}
.sl{color:var(--t2);line-height:1.65;animation:ftl .07s ease}@keyframes ftl{from{opacity:0}to{opacity:1}}

/* â”€â”€ VISUAL TOOLBAR â”€â”€ */
.vtb{background:var(--panel);border-bottom:1px solid var(--brd);padding:8px 12px;display:flex;align-items:center;gap:6px;flex-shrink:0;flex-wrap:wrap}
.vbtn{padding:7px 13px;background:var(--card);border:1px solid var(--brd);border-radius:6px;color:var(--t2);cursor:pointer;font-size:12px;font-family:var(--font-ui);display:flex;align-items:center;gap:5px;transition:all var(--tr)}.vbtn:hover{background:var(--hov);border-color:var(--accent);color:var(--t1)}.vbtn.on{background:color-mix(in srgb,var(--accent) 15%,transparent);border-color:var(--accent);color:var(--accent)}

/* â”€â”€ PREVIEW â”€â”€ */
.pvwrap{flex:1;display:flex;overflow:hidden;position:relative}
.pvframe{flex:1;border:none;background:#fff;display:none}
.pvempty{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;color:var(--t3);pointer-events:none}
.pvempty i{font-size:60px;opacity:.15}.pvempty p{font-size:14px}.pvempty small{font-size:11px;opacity:.55}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NO-CODE VISUAL EDITOR PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ncpanel{width:0;background:var(--side);border-left:1px solid var(--brd);overflow:hidden;transition:width .3s ease;flex-shrink:0;display:flex;flex-direction:column;position:relative}
.ncpanel.open{width:290px}
.nchdr{padding:12px 14px;border-bottom:1px solid var(--brd);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.nchdr-title{font-size:13px;font-weight:700;color:var(--t1);display:flex;align-items:center;gap:7px}.nchdr-title i{color:var(--accent)}
.nc-close{background:none;border:none;color:var(--t3);cursor:pointer;font-size:16px;transition:color var(--tr)}.nc-close:hover{color:var(--t1)}
.ncbody{flex:1;overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px}

/* No-code groups */
.ncg{background:var(--card);border:1px solid var(--brd);border-radius:9px;overflow:hidden}
.ncg-title{padding:9px 12px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.7px;color:var(--t2);border-bottom:1px solid var(--brd);background:color-mix(in srgb,var(--accent) 8%,transparent);display:flex;align-items:center;gap:6px}
.ncg-title i{color:var(--accent);font-size:11px}
.ncprop{padding:9px 12px;display:flex;flex-direction:column;gap:5px;border-bottom:1px solid color-mix(in srgb,var(--brd) 50%,transparent)}.ncprop:last-child{border:none}
.ncprop label{font-size:11px;color:var(--t3);font-weight:500}
.ncprop input,.ncprop select,.ncprop textarea{background:var(--inp);border:1px solid var(--brd);border-radius:6px;padding:6px 9px;color:var(--t1);font-family:var(--font-ui);font-size:12px;outline:none;width:100%;transition:border-color var(--tr)}.ncprop input:focus,.ncprop select:focus,.ncprop textarea:focus{border-color:var(--accent)}
.ncprop input[type=color]{height:32px;padding:2px 4px;cursor:pointer}
.ncprop textarea{resize:none;min-height:55px;line-height:1.5}
.ncprop select option{background:var(--panel);color:var(--t1)}
.nc-row{display:flex;gap:7px}.nc-row input{flex:1}
/* Quick action btns */
.qa-btn{width:100%;padding:9px 12px;background:var(--card);border:1px solid var(--brd);border-radius:7px;color:var(--t2);cursor:pointer;font-size:12px;font-family:var(--font-ui);display:flex;align-items:center;gap:8px;transition:all var(--tr);text-align:left}.qa-btn:hover{background:var(--hov);border-color:var(--accent);color:var(--t1)}
.qa-btn i{color:var(--accent);font-size:12px;width:16px;text-align:center}
/* Apply btn */
.nc-apply{width:100%;padding:11px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:13px;font-weight:700;font-family:var(--font-ui);transition:all var(--tr);display:flex;align-items:center;justify-content:center;gap:7px}.nc-apply:hover:not(:disabled){opacity:.9;transform:translateY(-1px)}.nc-apply:disabled{opacity:.4;cursor:not-allowed;transform:none}
.nc-info{font-size:11px;color:var(--t3);text-align:center;padding:14px;line-height:1.5}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AI ITERATIVE CHAT PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.aichat{border-top:1px solid var(--brd);background:var(--panel);display:none;flex-direction:column;max-height:290px;flex-shrink:0}
.aichat.show{display:flex}
.aichat-hdr{padding:9px 14px;border-bottom:1px solid var(--brd);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.aichat-title{font-size:12px;font-weight:600;color:var(--t1);display:flex;align-items:center;gap:7px}
.aichat-title i{color:var(--accent)}
.aichat-title .badge{background:color-mix(in srgb,var(--accent) 15%,transparent);border:1px solid color-mix(in srgb,var(--accent) 40%,transparent);color:var(--accent);font-size:10px;padding:2px 7px;border-radius:20px}
.done-btn{padding:5px 12px;background:color-mix(in srgb,#50fa7b 12%,transparent);border:1px solid color-mix(in srgb,#50fa7b 50%,transparent);border-radius:6px;color:#50fa7b;cursor:pointer;font-size:11px;font-family:var(--font-ui);font-weight:600;transition:all var(--tr);display:flex;align-items:center;gap:5px}.done-btn:hover{background:color-mix(in srgb,#50fa7b 22%,transparent)}
.msgs{flex:1;overflow-y:auto;padding:10px 14px;display:flex;flex-direction:column;gap:8px;min-height:90px}
.msg{padding:9px 12px;border-radius:9px;font-size:12px;line-height:1.55;max-width:88%;animation:msgIn .2s ease;word-break:break-word}
@keyframes msgIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.msg.user{background:color-mix(in srgb,var(--accent) 18%,transparent);border:1px solid color-mix(in srgb,var(--accent) 35%,transparent);color:var(--t1);align-self:flex-end}
.msg.ai{background:var(--card);border:1px solid var(--brd);color:var(--t2);align-self:flex-start}
.msg.ai.loading{color:var(--accent);font-style:italic}
.msg.ai.loading::after{content:'...';animation:dots 1.2s infinite}
@keyframes dots{0%{content:''}33%{content:'.'}66%{content:'..'}100%{content:'...'}}
.chat-inp-row{padding:9px 12px;border-top:1px solid var(--brd);display:flex;gap:7px;align-items:center;flex-shrink:0}
.chat-inp{flex:1;background:var(--inp);border:1px solid var(--brd);border-radius:8px;padding:8px 12px;color:var(--t1);font-family:var(--font-ui);font-size:12px;outline:none;transition:border-color var(--tr)}.chat-inp:focus{border-color:var(--accent)}.chat-inp::placeholder{color:var(--t3)}
.chat-send{padding:8px 15px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:12px;font-family:var(--font-ui);font-weight:600;display:flex;align-items:center;gap:5px;transition:all var(--tr)}.chat-send:hover{opacity:.9;transform:translateY(-1px)}.chat-send:disabled{opacity:.4;cursor:not-allowed;transform:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CODE EDITOR PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cdl{flex:1;display:flex;flex-direction:column;overflow:hidden}
.cdhdr{background:color-mix(in srgb,var(--panel) 95%,var(--accent) 5%);border-bottom:1px solid var(--brd);display:flex;align-items:center;justify-content:space-between;padding:0 12px;height:40px;flex-shrink:0}
.cdtabs{display:flex;align-items:center;gap:2px;overflow-x:auto;flex:1}.cdtabs::-webkit-scrollbar{height:2px}
.cdtab{padding:0 14px;height:32px;background:transparent;border:none;border-bottom:2px solid transparent;color:var(--t3);cursor:pointer;font-size:12px;font-family:var(--font-code);display:flex;align-items:center;gap:5px;transition:all var(--tr);white-space:nowrap;flex-shrink:0}.cdtab:hover{color:var(--t2);background:var(--hov)}.cdtab.on{color:var(--t1);border-bottom-color:var(--accent);background:var(--ed)}
.ehtml{color:#e34c26!important}.ecss{color:#1572b6!important}.ejs{color:#f7df1e!important}.epy{color:#3572a5!important}.ejv{color:#b07219!important}.ets{color:#2b7489!important}.ephp{color:#4f5d95!important}.ecpp{color:#f34b7d!important}.erb{color:#701516!important}.ego{color:#00add8!important}.ers{color:#dea584!important}
.cdactions{display:flex;align-items:center;gap:5px;flex-shrink:0}
.cdabtn{padding:5px 10px;background:var(--card);border:1px solid var(--brd);border-radius:5px;color:var(--t2);cursor:pointer;font-size:11px;font-family:var(--font-ui);display:flex;align-items:center;gap:4px;transition:all var(--tr)}.cdabtn:hover{background:var(--hov);color:var(--t1);border-color:var(--accent)}.cdabtn.run{border-color:color-mix(in srgb,var(--accent) 50%,transparent);color:var(--accent)}
.lbar{background:var(--gut);border-bottom:1px solid var(--brd);padding:5px 12px;display:flex;gap:4px;flex-wrap:nowrap;overflow-x:auto;flex-shrink:0}.lbar::-webkit-scrollbar{height:2px}
.lp{padding:4px 10px;border-radius:20px;border:1px solid var(--brd);background:transparent;color:var(--t3);font-size:11px;font-family:var(--font-code);cursor:pointer;transition:all var(--tr);white-space:nowrap;flex-shrink:0}.lp:hover{color:var(--t2);border-color:var(--t3)}.lp.on{background:color-mix(in srgb,var(--accent) 15%,transparent);border-color:var(--accent);color:var(--accent)}
.edm{flex:1;display:flex;overflow:hidden;background:var(--ed)}
.lns{background:var(--gut);border-right:1px solid var(--brd);padding:16px 0;min-width:52px;overflow:hidden;flex-shrink:0;user-select:none;text-align:right}
.ln{font-family:var(--font-code);font-size:13px;line-height:1.7;color:var(--ln);padding:0 12px 0 6px;height:22.1px}
.cc{flex:1;overflow:auto;padding:16px;font-family:var(--font-code);font-size:13px;line-height:1.7;color:var(--t1);white-space:pre;tab-size:2;background:var(--ed)}
.cc .sk{color:var(--sk);font-weight:600}.cc .ss{color:var(--ss)}.cc .sc{color:var(--sc);font-style:italic}.cc .sf{color:var(--sf)}.cc .sn{color:var(--sn)}.cc .stg{color:var(--stg)}.cc .sa{color:var(--sa)}.cc .sv{color:var(--sv)}.cc .scl{color:var(--scl);font-weight:600}.cc .so{color:var(--so)}.cc .svr{color:var(--svr)}.cc .sp{color:var(--sp)}
.mmap{width:80px;background:var(--gut);border-left:1px solid var(--brd);overflow:hidden;flex-shrink:0;opacity:.55}
.mmap canvas{display:block;width:100%;height:100%}
.stbar{background:var(--accent);color:rgba(255,255,255,.9);padding:3px 14px;display:flex;align-items:center;justify-content:space-between;font-size:11px;font-family:var(--font-code);flex-shrink:0;gap:12px}
.stl,.str{display:flex;align-items:center;gap:14px}
.sti{display:flex;align-items:center;gap:4px;opacity:.9;white-space:nowrap}.sti i{font-size:9px}
.caibar{background:var(--panel);border-top:1px solid var(--brd);padding:10px 12px;display:flex;gap:8px;align-items:center;flex-shrink:0}
.cai-in{flex:1;background:var(--inp);border:1px solid var(--brd);border-radius:8px;padding:8px 12px;color:var(--t1);font-family:var(--font-ui);font-size:13px;outline:none;transition:border-color var(--tr)}.cai-in:focus{border-color:var(--accent)}.cai-in::placeholder{color:var(--t3)}
.cai-btn{padding:8px 16px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:13px;font-family:var(--font-ui);font-weight:600;display:flex;align-items:center;gap:6px;transition:all var(--tr)}.cai-btn:hover{opacity:.9;transform:translateY(-1px)}.cai-btn:disabled{opacity:.4;cursor:not-allowed;transform:none}

/* â”€â”€ TOAST â”€â”€ */
.toast{position:fixed;bottom:20px;right:20px;background:var(--panel);border:1px solid var(--brd);border-left:3px solid var(--accent);color:var(--t1);padding:11px 17px;border-radius:8px;font-size:12px;display:none;align-items:center;gap:9px;z-index:9999;box-shadow:0 8px 32px rgba(0,0,0,.4);animation:tin .25s ease;max-width:320px}
.toast.show{display:flex}.toast.err{border-left-color:#ff5555}.toast.ok{border-left-color:#50fa7b}
@keyframes tin{from{opacity:0;transform:translateX(28px)}to{opacity:1;transform:translateX(0)}}

/* â”€â”€ OVERLAY â”€â”€ */
.ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:490;backdrop-filter:blur(2px)}.ov.show{display:block}

/* â”€â”€ FOOTER â”€â”€ */
.ftr{background:var(--panel);border-top:1px solid var(--brd);padding:8px 20px;display:flex;align-items:center;justify-content:space-between;font-size:11px;color:var(--t3);flex-shrink:0;gap:10px;flex-wrap:wrap}
.ftr a{color:var(--accent);text-decoration:none;transition:color var(--tr)}.ftr a:hover{color:var(--accent2)}
.flinks{display:flex;gap:14px;flex-wrap:wrap}

/* â”€â”€ RESPONSIVE â”€â”€ */
@media(max-width:900px){.mmap{display:none}.sb{width:300px}.ncpanel.open{width:250px}}
@media(max-width:768px){.ham{display:flex}.sb{position:fixed;top:0;left:0;bottom:0;width:300px;z-index:500;transform:translateX(-100%)}.sb.open{transform:translateX(0)}.ncpanel.open{width:220px}.str .sti:not(:first-child){display:none}}
@media(max-width:480px){.hdr{padding:0 12px}.vtb{padding:6px 8px}.vbtn span{display:none}.cdhdr{padding:0 8px}}
@supports(-webkit-touch-callout:none){body{height:-webkit-fill-available}}
</style>
</head>
<body>

<!-- HEADER -->
<header class="hdr">
  <div class="logo">
    <div class="logo-ic"><i class="fas fa-bolt"></i></div>
    <div><h1>Zedex</h1><span>AI Web App Generator</span></div>
  </div>
  <div class="hdr-r">
    <button class="tbtn-hdr" onclick="toggleTdrop()">
      <i class="fas fa-palette"></i><span id="tlbl">Dark</span>
      <i class="fas fa-chevron-down" style="font-size:9px;opacity:.5"></i>
    </button>
    <button class="ham" onclick="toggleSb()"><i class="fas fa-bars"></i></button>
  </div>
</header>

<!-- THEME DROPDOWN -->
<div class="tdrop" id="tdrop">
  <div class="topt on" data-t="dark"      onclick="setTheme('dark','Dark')">       <div class="tsw" style="background:#0d0d0f;border-color:#7c6af7"></div>Dark</div>
  <div class="topt"    data-t="light"     onclick="setTheme('light','Light')">     <div class="tsw" style="background:#f0f0f7;border-color:#7c4dff"></div>Light</div>
  <div class="topt"    data-t="nord"      onclick="setTheme('nord','Nord')">       <div class="tsw" style="background:#2e3440;border-color:#88c0d0"></div>Nord</div>
  <div class="topt"    data-t="dracula"   onclick="setTheme('dracula','Dracula')"> <div class="tsw" style="background:#282a36;border-color:#bd93f9"></div>Dracula</div>
  <div class="topt"    data-t="monokai"   onclick="setTheme('monokai','Monokai')"> <div class="tsw" style="background:#272822;border-color:#a6e22e"></div>Monokai</div>
  <div class="topt"    data-t="neon"      onclick="setTheme('neon','Neon')">       <div class="tsw" style="background:#050510;border-color:#00ffc8"></div>Neon</div>
  <div class="topt"    data-t="onedark"   onclick="setTheme('onedark','One Dark')"><div class="tsw" style="background:#282c34;border-color:#61afef"></div>One Dark</div>
  <div class="topt"    data-t="github"    onclick="setTheme('github','GitHub')">   <div class="tsw" style="background:#0d1117;border-color:#388bfd"></div>GitHub</div>
  <div class="topt"    data-t="solarized" onclick="setTheme('solarized','Solarized')"><div class="tsw" style="background:#002b36;border-color:#268bd2"></div>Solarized</div>
</div>

<!-- TABS BAR -->
<div class="tabbar">
  <button class="pagetab on" id="tab-v" onclick="switchPg('v')"><i class="fas fa-eye"></i> Editor Visual</button>
  <button class="pagetab"    id="tab-c" onclick="switchPg('c')"><i class="fas fa-code"></i> SÃ³ CÃ³digo <span class="pulsedot" id="cdot"></span></button>
</div>

<div class="ov" id="ov" onclick="closeSb()"></div>

<!-- WORKSPACE -->
<div class="ws">

  <!-- SIDEBAR -->
  <aside class="sb" id="sb">
    <div class="sbh"><i class="fas fa-wand-magic-sparkles"></i><h2>Descreva seu App</h2></div>
    <div class="sbb">
      <textarea class="ta" id="pi" placeholder="Ex: Dashboard financeiro dark mode com grÃ¡ficos Chart.js, cards KPI, tabela de transaÃ§Ãµes e sidebar navegÃ¡vel..."></textarea>
      <div>
        <div class="lbl">Exemplos rÃ¡pidos</div>
        <div class="chips">
          <button class="chip" onclick="sp('Landing page para startup de tecnologia com hero animado, seÃ§Ã£o de features, pricing cards e CTA')">ğŸš€ Landing Page Startup</button>
          <button class="chip" onclick="sp('Dashboard admin com grÃ¡ficos de barras e linhas, cards KPI animados e tabela de dados')">ğŸ“Š Dashboard Admin</button>
          <button class="chip" onclick="sp('Calculadora cientÃ­fica com histÃ³rico completo, funÃ§Ãµes trig e design glassmorphism')">ğŸ§® Calculadora Premium</button>
          <button class="chip" onclick="sp('Jogo Snake em canvas com pontuaÃ§Ã£o, nÃ­veis progressivos, power-ups e efeitos neon')">ğŸ Snake Neon Game</button>
          <button class="chip" onclick="sp('App de tarefas com drag and drop, categorias coloridas, filtros e animaÃ§Ãµes fluidas')">âœ… Todo App Pro</button>
          <button class="chip" onclick="sp('Player de mÃºsica com visualizador de frequÃªncias em canvas, playlist e equalizer animado')">ğŸµ Music Player</button>
        </div>
      </div>
      <button class="genbtn" id="gbtn" onclick="genApp()">
        <i class="fas fa-bolt" id="gi"></i><span id="gt">Gerar App</span>
      </button>
    </div>
  </aside>

  <!-- CONTENT -->
  <div class="cnt">

    <!-- â•â• VISUAL PAGE â•â• -->
    <div class="pg on" id="pg-v">

      <!-- Thinking panel -->
      <div class="tkp" id="tkp"></div>

      <!-- â•â•â• AI ITERATIVE CHAT â•â•â• -->
      <div class="aichat" id="aichat">
        <div class="aichat-hdr">
          <div class="aichat-title">
            <i class="fas fa-robot"></i>
            IA Assistindo seu App
            <span class="badge">Chat Iterativo</span>
          </div>
          <button class="done-btn" onclick="doneApp()">
            <i class="fas fa-check-circle"></i> EstÃ¡ Pronto!
          </button>
        </div>
        <div class="msgs" id="msgs"></div>
        <div class="chat-inp-row">
          <input class="chat-inp" id="chatinp" placeholder='Diga o que ajustar: "Muda o fundo para azul escuro", "Adiciona botÃ£o de WhatsApp", "Remove a seÃ§Ã£o de preÃ§os"...' onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendChat()}">
          <button class="chat-send" id="csend" onclick="sendChat()">
            <i class="fas fa-paper-plane"></i> Enviar
          </button>
        </div>
      </div>

      <!-- Toolbar -->
      <div class="vtb">
        <button class="vbtn" onclick="refreshPv()"><i class="fas fa-rotate-right"></i><span>Atualizar</span></button>
        <button class="vbtn" onclick="dlApp()"><i class="fas fa-download"></i><span>Baixar HTML</span></button>
        <button class="vbtn" onclick="openFs()"><i class="fas fa-expand"></i><span>Fullscreen</span></button>
        <button class="vbtn" onclick="switchPg('c');showHtml()"><i class="fas fa-code"></i><span>Ver CÃ³digo</span></button>
        <button class="vbtn on" id="ncbtn" onclick="toggleNc()"><i class="fas fa-paintbrush"></i><span>Editor Visual</span></button>
      </div>

      <!-- Preview + No-Code Panel side by side -->
      <div class="pvwrap">
        <div class="pvempty" id="pve">
          <i class="fas fa-bolt"></i>
          <p>Seu app aparecerÃ¡ aqui</p>
          <small>Descreva o que quer criar e clique em Gerar App</small>
        </div>
        <iframe class="pvframe" id="pvf"></iframe>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             NO-CODE PANEL
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <div class="ncpanel" id="ncp">
          <div class="nchdr">
            <div class="nchdr-title"><i class="fas fa-paintbrush"></i> Editor Visual</div>
            <button class="nc-close" onclick="toggleNc()"><i class="fas fa-times"></i></button>
          </div>
          <div class="ncbody" id="ncbody">
            <div class="nc-info">
              <i class="fas fa-arrow-left" style="color:var(--accent)"></i><br><br>
              Gere um app primeiro para poder editÃ¡-lo aqui sem escrever cÃ³digo!
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â• CODE PAGE â•â• -->
    <div class="pg" id="pg-c">
      <div class="cdl">

        <!-- Titlebar -->
        <div class="cdhdr">
          <div class="cdtabs" id="cdtabs"></div>
          <div class="cdactions">
            <button class="cdabtn" onclick="cpCode()"><i class="fas fa-copy"></i> Copiar</button>
            <button class="cdabtn" onclick="dlCode()"><i class="fas fa-download"></i> Baixar</button>
            <button class="cdabtn run" onclick="genCodeLang()"><i class="fas fa-wand-magic-sparkles"></i> Gerar</button>
          </div>
        </div>

        <!-- Lang pills -->
        <div class="lbar">
          <button class="lp on" onclick="selLang('html')"   data-l="html">HTML</button>
          <button class="lp"    onclick="selLang('css')"    data-l="css">CSS</button>
          <button class="lp"    onclick="selLang('js')"     data-l="js">JavaScript</button>
          <button class="lp"    onclick="selLang('ts')"     data-l="ts">TypeScript</button>
          <button class="lp"    onclick="selLang('python')" data-l="python">Python</button>
          <button class="lp"    onclick="selLang('java')"   data-l="java">Java</button>
          <button class="lp"    onclick="selLang('cpp')"    data-l="cpp">C++</button>
          <button class="lp"    onclick="selLang('php')"    data-l="php">PHP</button>
          <button class="lp"    onclick="selLang('rb')"     data-l="rb">Ruby</button>
          <button class="lp"    onclick="selLang('go')"     data-l="go">Go</button>
          <button class="lp"    onclick="selLang('rs')"     data-l="rs">Rust</button>
          <button class="lp"    onclick="selLang('custom')" data-l="custom">+ Custom</button>
        </div>

        <!-- Editor area -->
        <div class="edm">
          <div class="lns" id="lns"></div>
          <div class="cc" id="cc"><span style="color:var(--t3);font-style:italic">// CÃ³digo aparecerÃ¡ aqui com syntax highlight completo...</span></div>
          <div class="mmap" id="mmap"><canvas id="mc"></canvas></div>
        </div>

        <!-- AI bar -->
        <div class="caibar">
          <i class="fas fa-robot" style="color:var(--accent);font-size:16px;flex-shrink:0"></i>
          <input class="cai-in" id="cain" placeholder="PeÃ§a Ã  IA: 'API REST em Node.js com JWT', 'Script Python para anÃ¡lise de dados'..." onkeydown="if(event.key==='Enter')genCodeLang()">
          <button class="cai-btn" id="caibtn" onclick="genCodeLang()"><i class="fas fa-paper-plane"></i> Gerar</button>
        </div>

        <!-- Status bar -->
        <div class="stbar">
          <div class="stl">
            <div class="sti"><i class="fas fa-code-branch"></i><span id="stlang">HTML</span></div>
            <div class="sti"><i class="fas fa-lines-leaning"></i><span id="stlines">0 linhas</span></div>
            <div class="sti"><i class="fas fa-robot"></i><span>Qwen-Coder</span></div>
          </div>
          <div class="str">
            <div class="sti"><i class="fas fa-check-circle"></i><span>UTF-8</span></div>
            <div class="sti"><i class="fas fa-indent"></i><span>Spaces: 2</span></div>
            <div class="sti">Zedex</div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /cnt -->
</div><!-- /ws -->

<!-- FOOTER -->
<footer class="ftr">
  <div>Â© 2025 <a href="https://zenia-projects.netlify.app" target="_blank">ZÃ©nia Projects</a> | <a href="https://ia-zenia.netlify.app" target="_blank">IA-ZÃ©nia</a> | <a href="https://instagram.com/inacio.u.daniel" target="_blank">@inacio.u.daniel</a></div>
  <div class="flinks">
    <a href="https://zenia-projects.netlify.app" target="_blank">ğŸŒ ZÃ©nia Projects</a>
    <a href="https://ia-zenia.netlify.app" target="_blank">ğŸ¤– IA-ZÃ©nia</a>
  </div>
</footer>

<div class="toast" id="toast"><i class="fas fa-circle-check" id="tic"></i><span id="tmsg"></span></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ZEDEX v3 CORE â€” by ZÃ©nia Projects
   @inacio.u.daniel
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const API_KEY = 'pk_7HHmBkBPEiNS5dyF';
const API_URL = 'https://gen.pollinations.ai/v1/chat/completions';
const MODEL   = 'qwen-coder';

/* â”€â”€ STATE â”€â”€ */
const S = {
  lang: 'html', html: '', raw: '', busy: false,
  hist: []  // conversation history for iterative chat
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   API CALL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function api(msgs) {
  const r = await fetch(API_URL, {
    method: 'POST',
    headers: { 'Authorization': `Bearer ${API_KEY}`, 'Content-Type': 'application/json' },
    body: JSON.stringify({ model: MODEL, messages: msgs, temperature: 0.7, max_tokens: 16000 })
  });
  if (!r.ok) { const e = await r.text(); throw new Error(`(${r.status}) ${e}`); }
  const j = await r.json();
  if (j.choices?.[0]?.message?.content) return j.choices[0].message.content;
  if (j.content) return j.content;
  throw new Error('Resposta inesperada da API');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GENERATE APP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function genApp() {
  const prompt = document.getElementById('pi').value.trim();
  if (!prompt) { toast('Descreva o app primeiro!', 'err'); return; }
  if (S.busy) return;
  S.busy = true;
  setBtn(true);
  showTk();

  think('ğŸ” Analisando requisitos do projeto...', 'ana', 0);
  think('ğŸ—ï¸ Planejando arquitetura e componentes...', 'plan', 450);
  think('âš¡ Qwen-Coder processando...', 'gen', 900);
  think('ğŸ¨ Aplicando design moderno e responsivo...', 'gen', 1350);
  think('ğŸ”§ Otimizando performance...', 'fin', 1800);

  const SYS = `VocÃª Ã© um especialista em desenvolvimento web full-stack de Ãºltima geraÃ§Ã£o.

REGRAS ABSOLUTAS:
- Retorne APENAS cÃ³digo HTML puro. ZERO markdown, ZERO explicaÃ§Ãµes, ZERO blocos de cÃ³digo.
- Todo CSS em <style> no <head>. Todo JS em <script> antes de </body>.
- Design ULTRA moderno: gradientes, glassmorphism, animaÃ§Ãµes CSS/JS, micro-interaÃ§Ãµes.
- 100% funcional e completo. SEMPRE comece com <!DOCTYPE html>.
- Use Font Awesome CDN (https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css).
- Use Google Fonts via CDN quando adequado.
- FaÃ§a apps que IMPRESSIONEM visualmente e funcionalmente.
- Inclua TODAS as funcionalidades pedidas sem truncar.`;

  try {
    // Reset history for new app
    S.hist = [
      { role: 'system', content: SYS },
      { role: 'user', content: `Crie um aplicativo web completo para: "${prompt}"\n\nApenas cÃ³digo HTML. Nenhum texto extra.` }
    ];

    const content = await api(S.hist);
    let html = cleanCode(content);

    // Save assistant response in history
    S.hist.push({ role: 'assistant', content: html });
    S.html = html; S.raw = html;

    think('âœ… App gerado! Use o chat abaixo para ajustar â¬‡ï¸', 'fin', 300);
    setTimeout(() => streamCode(html), 500);

    setTimeout(() => {
      renderPv(html);
      updCode(html, 'html');
      document.getElementById('cdot').style.display = 'inline-block';
      hideTk();
      toast('App gerado! Ajuste com o chat abaixo ğŸ‰', 'ok');
      // Start iterative chat
      startChat(prompt);
    }, 2300);

  } catch(e) {
    think('âŒ Erro: ' + e.message, 'fin', 0);
    toast('Erro: ' + (e.message || 'Tente novamente'), 'err');
    hideTk();
  } finally {
    S.busy = false;
    setBtn(false);
  }
}

function cleanCode(c) {
  let h = c.trim()
    .replace(/^```html\s*/i, '').replace(/^```\s*/, '').replace(/```\s*$/, '').trim();
  if (!h.toLowerCase().includes('<!doctype')) h = '<!DOCTYPE html>\n' + h;
  return h;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ITERATIVE AI CHAT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startChat(prompt) {
  const chat = document.getElementById('aichat');
  document.getElementById('msgs').innerHTML = '';
  chat.classList.add('show');

  addMsg('ai',
    `âœ… App criado com base em: <strong>"${prompt.substring(0,60)}${prompt.length>60?'...':''}"</strong><br><br>` +
    `NÃ£o estÃ¡ perfeito? Sou todo ouvidos! Me diz o que mudar â€” cores, textos, layout, botÃµes, funcionalidades â€” qualquer coisa!<br><br>` +
    `Quando estiver satisfeito clica em <strong>âœ… EstÃ¡ Pronto!</strong>`,
    false, true
  );
}

async function sendChat() {
  if (S.busy) return;
  const inp = document.getElementById('chatinp');
  const msg = inp.value.trim();
  if (!msg) { toast('Escreva o que deseja ajustar!', 'err'); return; }
  if (!S.html) { toast('Gere um app primeiro!', 'err'); return; }

  inp.value = '';
  addMsg('user', msg);
  const thinking = addMsg('ai', 'Aplicando ajuste', false, false, true);
  document.getElementById('csend').disabled = true;
  S.busy = true;

  try {
    S.hist.push({
      role: 'user',
      content: `Pedido de ajuste: "${msg}"\n\nRetorne APENAS o HTML completo e atualizado. Zero texto extra, zero markdown.`
    });

    const content = await api(S.hist);
    const html = cleanCode(content);

    S.hist.push({ role: 'assistant', content: html });
    S.html = html; S.raw = html;

    // Update preview and code
    renderPv(html);
    updCode(html, 'html');
    rebuildNcPanel(); // refresh no-code panel

    // Update the thinking bubble
    thinking.classList.remove('loading');
    thinking.innerHTML = `âœ… Feito! <em>"${msg.substring(0,50)}"</em> â€” Confira no preview. Precisa de mais alguma coisa?`;

    toast('Ajuste aplicado! âœ¨', 'ok');

  } catch(e) {
    thinking.classList.remove('loading');
    thinking.textContent = 'âŒ Erro ao aplicar: ' + (e.message || 'Tente novamente');
    toast('Erro', 'err');
  } finally {
    S.busy = false;
    document.getElementById('csend').disabled = false;
    document.getElementById('chatinp').focus();
  }
}

function addMsg(role, html, raw=false, isHtml=false, loading=false) {
  const msgs = document.getElementById('msgs');
  const d = document.createElement('div');
  d.className = `msg ${role}${loading ? ' loading' : ''}`;
  if (isHtml) d.innerHTML = html;
  else d.textContent = html;
  msgs.appendChild(d);
  msgs.scrollTop = msgs.scrollHeight;
  return d;
}

function doneApp() {
  document.getElementById('aichat').classList.remove('show');
  toast('ğŸ‰ App finalizado! Pode baixar quando quiser.', 'ok');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NO-CODE VISUAL EDITOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let ncOpen = false;

function toggleNc() {
  ncOpen = !ncOpen;
  document.getElementById('ncp').classList.toggle('open', ncOpen);
  document.getElementById('ncbtn').classList.toggle('on', ncOpen);
  if (ncOpen) rebuildNcPanel();
}

function rebuildNcPanel() {
  if (!S.html) return;
  const body = document.getElementById('ncbody');
  body.innerHTML = `

    <!-- CORES -->
    <div class="ncg">
      <div class="ncg-title"><i class="fas fa-palette"></i> Cores & Fontes</div>
      <div class="ncprop">
        <label>Cor Principal (ex: botÃµes, links)</label>
        <input type="color" id="nc_c1" value="#7c6af7">
      </div>
      <div class="ncprop">
        <label>Cor SecundÃ¡ria (destaques)</label>
        <input type="color" id="nc_c2" value="#f06292">
      </div>
      <div class="ncprop">
        <label>Cor de Fundo</label>
        <input type="color" id="nc_bg" value="#0d0d0f">
      </div>
      <div class="ncprop">
        <label>Cor do Texto</label>
        <input type="color" id="nc_tc" value="#e8e8ff">
      </div>
      <div class="ncprop">
        <label>FamÃ­lia de Fonte</label>
        <select id="nc_font">
          <option value="'Segoe UI', sans-serif">Segoe UI</option>
          <option value="'Inter', sans-serif">Inter</option>
          <option value="'Roboto', sans-serif">Roboto</option>
          <option value="'Poppins', sans-serif">Poppins</option>
          <option value="'Montserrat', sans-serif">Montserrat</option>
          <option value="'Open Sans', sans-serif">Open Sans</option>
          <option value="'Raleway', sans-serif">Raleway</option>
          <option value="'Nunito', sans-serif">Nunito</option>
        </select>
      </div>
      <div class="ncprop">
        <label>Tamanho base da fonte</label>
        <select id="nc_fsize">
          <option value="14px">Pequena â€” 14px</option>
          <option value="16px" selected>Normal â€” 16px</option>
          <option value="18px">Grande â€” 18px</option>
          <option value="20px">Extra grande â€” 20px</option>
        </select>
      </div>
    </div>

    <!-- TEXTOS -->
    <div class="ncg">
      <div class="ncg-title"><i class="fas fa-text-height"></i> Textos Principais</div>
      <div class="ncprop">
        <label>TÃ­tulo / Nome do App</label>
        <input type="text" id="nc_title" placeholder="Ex: Meu App IncrÃ­vel">
      </div>
      <div class="ncprop">
        <label>SubtÃ­tulo / Slogan</label>
        <input type="text" id="nc_sub" placeholder="Ex: A soluÃ§Ã£o mais completa">
      </div>
      <div class="ncprop">
        <label>Texto do BotÃ£o Principal</label>
        <input type="text" id="nc_btnlbl" placeholder="Ex: ComeÃ§ar Agora">
      </div>
      <div class="ncprop">
        <label>Texto do RodapÃ©</label>
        <input type="text" id="nc_footer" placeholder="Ex: Â© 2025 Minha Empresa">
      </div>
    </div>

    <!-- PEÃ‡A Ã€ IA -->
    <div class="ncg">
      <div class="ncg-title"><i class="fas fa-wand-magic-sparkles"></i> Pedir Ã  IA</div>
      <div class="ncprop">
        <label>Descreva qualquer alteraÃ§Ã£o</label>
        <textarea id="nc_ai" placeholder='Exemplos:
â€¢ "Adiciona um formulÃ¡rio de contacto"
â€¢ "Remove a seÃ§Ã£o de preÃ§os"  
â€¢ "Adiciona um botÃ£o flutuante de WhatsApp"
â€¢ "Muda o layout para 3 colunas"
â€¢ "Adiciona contador regressivo"
â€¢ "Muda as animaÃ§Ãµes para mais suaves"'></textarea>
      </div>
      <button class="nc-apply" id="ncapplybtn" onclick="ncApplyAi()">
        <i class="fas fa-wand-magic-sparkles"></i> Aplicar com IA
      </button>
    </div>

    <!-- AÃ‡Ã•ES RÃPIDAS -->
    <div class="ncg">
      <div class="ncg-title"><i class="fas fa-bolt"></i> AÃ§Ãµes RÃ¡pidas com 1 Clique</div>
      <button class="qa-btn" onclick="quickAi('Adiciona botÃ£o de toggle dark/light mode no canto superior direito')">
        <i class="fas fa-moon"></i> Adicionar Dark Mode
      </button>
      <button class="qa-btn" onclick="quickAi('Torna o app 100% responsivo para mobile com menu hambÃºrguer se necessÃ¡rio')">
        <i class="fas fa-mobile-alt"></i> Melhorar Mobile
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona animaÃ§Ãµes suaves de entrada (fade-in, slide-up) nos elementos principais')">
        <i class="fas fa-magic"></i> Adicionar AnimaÃ§Ãµes
      </button>
      <button class="qa-btn" onclick="quickAi('Aplica efeito glassmorphism moderno nos cards, painÃ©is e componentes principais')">
        <i class="fas fa-circle-half-stroke"></i> Glassmorphism
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona um botÃ£o flutuante de WhatsApp no canto inferior direito')">
        <i class="fab fa-whatsapp"></i> BotÃ£o WhatsApp
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona rodapÃ© profissional com links, redes sociais e copyright')">
        <i class="fas fa-shoe-prints"></i> Adicionar Footer
      </button>
      <button class="qa-btn" onclick="quickAi('Melhora as cores e o contraste para ficar mais vibrante e moderno')">
        <i class="fas fa-droplet"></i> Melhorar Cores
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona micro-interaÃ§Ãµes nos botÃµes e elementos clicÃ¡veis (hover, click effects)')">
        <i class="fas fa-hand-pointer"></i> Micro-interaÃ§Ãµes
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona loading skeleton nos cards e conteÃºdos para melhor UX')">
        <i class="fas fa-spinner"></i> Loading States
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona scroll suave e botÃ£o de volta ao topo')">
        <i class="fas fa-arrow-up"></i> Scroll ao Topo
      </button>
    </div>

    <!-- ESTRUTURA -->
    <div class="ncg">
      <div class="ncg-title"><i class="fas fa-layer-group"></i> Adicionar SecÃ§Ãµes</div>
      <button class="qa-btn" onclick="quickAi('Adiciona uma seÃ§Ã£o hero moderna com imagem de fundo, tÃ­tulo grande e CTA button')">
        <i class="fas fa-star"></i> SeÃ§Ã£o Hero
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona seÃ§Ã£o de depoimentos/testimonials com cards de clientes e estrelas de avaliaÃ§Ã£o')">
        <i class="fas fa-quote-right"></i> Depoimentos
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona seÃ§Ã£o de FAQ acordeÃ£o com as perguntas mais comuns')">
        <i class="fas fa-question-circle"></i> FAQ AcordeÃ£o
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona galeria de imagens com grid responsivo e lightbox ao clicar')">
        <i class="fas fa-images"></i> Galeria
      </button>
      <button class="qa-btn" onclick="quickAi('Adiciona barra de navegaÃ§Ã£o sticky com logo, links e botÃ£o CTA')">
        <i class="fas fa-bars"></i> Navbar Sticky
      </button>
    </div>
  `;
}

async function ncApplyAi() {
  const req = document.getElementById('nc_ai')?.value.trim();
  if (!req) { toast('Descreva a alteraÃ§Ã£o!', 'err'); return; }
  if (!S.html) { toast('Gere um app primeiro!', 'err'); return; }
  await quickAi(req);
  document.getElementById('nc_ai').value = '';
}

async function quickAi(req) {
  if (S.busy) { toast('Aguarde a operaÃ§Ã£o atual...', 'err'); return; }
  if (!S.html) { toast('Gere um app primeiro!', 'err'); return; }

  // Show chat and add messages
  document.getElementById('aichat').classList.add('show');
  addMsg('user', req);
  const thinking = addMsg('ai', 'Aplicando', false, false, true);
  S.busy = true;

  // Disable no-code apply button
  const applybtn = document.getElementById('ncapplybtn');
  if (applybtn) { applybtn.disabled = true; applybtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> A processar...'; }

  try {
    S.hist.push({
      role: 'user',
      content: `${req}\n\nRetorne APENAS o HTML completo. Zero texto extra.`
    });

    const content = await api(S.hist);
    const html = cleanCode(content);

    S.hist.push({ role: 'assistant', content: html });
    S.html = html; S.raw = html;

    renderPv(html);
    updCode(html, 'html');

    thinking.classList.remove('loading');
    thinking.textContent = 'âœ… Pronto! ' + req.substring(0, 60);
    toast('Aplicado! âœ¨', 'ok');

  } catch(e) {
    thinking.classList.remove('loading');
    thinking.textContent = 'âŒ Erro: ' + e.message;
    toast('Erro', 'err');
  } finally {
    S.busy = false;
    if (applybtn) { applybtn.disabled = false; applybtn.innerHTML = '<i class="fas fa-wand-magic-sparkles"></i> Aplicar com IA'; }
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CODE GENERATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function genCodeLang() {
  const inp = document.getElementById('cain').value.trim() || document.getElementById('pi').value.trim();
  if (!inp) { toast('Escreva o que deseja!', 'err'); return; }
  const btn = document.getElementById('caibtn');
  btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
  const nm = {html:'HTML',css:'CSS',js:'JavaScript',ts:'TypeScript',python:'Python',java:'Java',cpp:'C++',php:'PHP',rb:'Ruby',go:'Go',rs:'Rust',custom:'cÃ³digo'};
  const l = S.lang === 'custom' ? (inp.split(' ')[0]||'cÃ³digo') : (nm[S.lang]||S.lang);
  try {
    const c = await api([
      { role:'system', content:`Expert em ${l}. Retorne APENAS cÃ³digo ${l} limpo, sem markdown, sem explicaÃ§Ãµes. Completo, funcional e bem comentado.` },
      { role:'user', content:`Crie cÃ³digo ${l} para: "${inp}"` }
    ]);
    const code = c.trim().replace(/^```[\w]*\n?/,'').replace(/```$/,'').trim();
    S.raw = code;
    updCode(code, S.lang);
    toast(`CÃ³digo ${l} gerado! ğŸš€`, 'ok');
  } catch(e) { toast('Erro: ' + e.message, 'err'); }
  finally { btn.disabled = false; btn.innerHTML = '<i class="fas fa-paper-plane"></i> Gerar'; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SYNTAX HIGHLIGHT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function hl(code, lang) {
  let e = code.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

  if (lang === 'html') return e
    .replace(/(&lt;!--[\s\S]*?--&gt;)/g,'<span class="sc">$1</span>')
    .replace(/(&lt;!DOCTYPE[^&]*&gt;)/gi,'<span class="sc">$1</span>')
    .replace(/(&lt;\/?)([\w-]+)/g,'$1<span class="stg">$2</span>')
    .replace(/([\w:-]+)(=)(&quot;[^"]*&quot;)/g,'<span class="sa">$1</span><span class="so">$2</span><span class="sv">$3</span>');

  if (lang === 'css') return e
    .replace(/(\/\*[\s\S]*?\*\/)/g,'<span class="sc">$1</span>')
    .replace(/([.#:[\w][^{,]*?)(\{)/g,'<span class="sv">$1</span>$2')
    .replace(/([\w-]+)(\s*:)(?![^{]*\{)/g,'<span class="sp">$1</span>$2')
    .replace(/:\s*(#[0-9a-fA-F]{3,8}|rgba?\([^)]+\)|[\d.]+(?:px|em|rem|vh|vw|%|s|ms))/g,': <span class="sn">$1</span>');

  const jsLike = s => s
    .replace(/(\/\/[^\n]*)/g,'<span class="sc">$1</span>')
    .replace(/(\/\*[\s\S]*?\*\/)/g,'<span class="sc">$1</span>')
    .replace(/\b(function|const|let|var|if|else|for|while|return|class|import|export|async|await|try|catch|throw|new|this|typeof|instanceof|switch|case|break|continue|default|extends|super|yield|static|get|set|from|of|in|do|delete|void|debugger)\b/g,'<span class="sk">$1</span>')
    .replace(/\b(true|false|null|undefined|NaN|Infinity)\b/g,'<span class="scl">$1</span>')
    .replace(/(&quot;(?:[^&]|&(?!quot;))*&quot;|&#x27;[^&#]*&#x27;|`[^`]*`)/g,'<span class="ss">$1</span>')
    .replace(/\b(\d+\.?\d*[eE]?[+-]?\d*)\b/g,'<span class="sn">$1</span>')
    .replace(/\b([A-Z][a-zA-Z0-9_]*)\b/g,'<span class="scl">$1</span>')
    .replace(/\b([a-z_$][a-z0-9_$]*)(?=\s*\()/g,'<span class="sf">$1</span>');

  if (['js','ts'].includes(lang)) return jsLike(e);

  if (lang === 'python') return e
    .replace(/(#[^\n]*)/g,'<span class="sc">$1</span>')
    .replace(/("""[\s\S]*?"""|\'\'\'[\s\S]*?\'\'\')/g,'<span class="ss">$1</span>')
    .replace(/\b(def|class|if|elif|else|for|while|return|import|from|try|except|finally|with|as|lambda|yield|async|await|pass|raise|global|nonlocal|del|assert|in|is|not|and|or)\b/g,'<span class="sk">$1</span>')
    .replace(/\b(True|False|None|self|cls)\b/g,'<span class="scl">$1</span>')
    .replace(/(&quot;[^&]*&quot;|&#x27;[^&#]*&#x27;)/g,'<span class="ss">$1</span>')
    .replace(/\b(\d+\.?\d*)\b/g,'<span class="sn">$1</span>')
    .replace(/\b([a-z_][a-z0-9_]*)(?=\s*\()/g,'<span class="sf">$1</span>');

  if (['java','cpp'].includes(lang)) return e
    .replace(/(\/\/[^\n]*|\/\*[\s\S]*?\*\/)/g,'<span class="sc">$1</span>')
    .replace(/\b(public|private|protected|static|final|abstract|class|interface|enum|extends|implements|import|package|void|int|long|double|float|boolean|char|byte|short|String|return|if|else|for|while|do|try|catch|throw|throws|new|this|super|synchronized|volatile|transient|native)\b/g,'<span class="sk">$1</span>')
    .replace(/\b(true|false|null)\b/g,'<span class="scl">$1</span>')
    .replace(/(&quot;[^&]*&quot;|&#x27;.&#x27;)/g,'<span class="ss">$1</span>')
    .replace(/\b(\d+\.?\d*[fFdDlL]?)\b/g,'<span class="sn">$1</span>')
    .replace(/\b([A-Z][a-zA-Z0-9_]*)\b/g,'<span class="scl">$1</span>')
    .replace(/\b([a-z_][a-z0-9_]*)(?=\s*\()/g,'<span class="sf">$1</span>');

  if (lang === 'php') return e
    .replace(/(\/\/[^\n]*|\/\*[\s\S]*?\*\/|#[^\n]*)/g,'<span class="sc">$1</span>')
    .replace(/\b(function|class|if|else|elseif|foreach|for|while|return|echo|print|include|require|extends|implements|public|private|protected|static|new|namespace|use|try|catch|throw|array|match)\b/g,'<span class="sk">$1</span>')
    .replace(/(\$[a-zA-Z_][a-zA-Z0-9_]*)/g,'<span class="svr">$1</span>')
    .replace(/(&quot;[^&]*&quot;|&#x27;[^&#]*&#x27;)/g,'<span class="ss">$1</span>')
    .replace(/\b(\d+)\b/g,'<span class="sn">$1</span>');

  if (['rb','go','rs'].includes(lang)) return jsLike(e);
  return e;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CODE EDITOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const LM = {
  html:{ic:'fab fa-html5',ext:'index.html',c:'ehtml'},css:{ic:'fab fa-css3-alt',ext:'style.css',c:'ecss'},
  js:{ic:'fab fa-js-square',ext:'script.js',c:'ejs'},ts:{ic:'fas fa-code',ext:'index.ts',c:'ets'},
  python:{ic:'fab fa-python',ext:'main.py',c:'epy'},java:{ic:'fab fa-java',ext:'Main.java',c:'ejv'},
  cpp:{ic:'fas fa-c',ext:'main.cpp',c:'ecpp'},php:{ic:'fab fa-php',ext:'index.php',c:'ephp'},
  rb:{ic:'fas fa-gem',ext:'app.rb',c:'erb'},go:{ic:'fas fa-code',ext:'main.go',c:'ego'},
  rs:{ic:'fas fa-code',ext:'main.rs',c:'ers'},custom:{ic:'fas fa-file-code',ext:'arquivo.txt',c:''}
};

function updCode(code, lang) {
  S.raw = code;
  const lines = code.split('\n');
  document.getElementById('lns').innerHTML = lines.map((_,i) => `<div class="ln">${i+1}</div>`).join('');
  document.getElementById('cc').innerHTML = hl(code, lang);
  document.getElementById('stlines').textContent = lines.length + ' linhas';
  document.getElementById('stlang').textContent = lang.toUpperCase();
  buildCdTabs(lang);
  drawMmap(code);
}

function buildCdTabs(l) {
  const m = LM[l] || LM.custom;
  document.getElementById('cdtabs').innerHTML =
    `<button class="cdtab on"><i class="${m.ic} ${m.c}" style="font-size:13px"></i><span>${m.ext}</span></button>`;
}

function showHtml() { if (S.html) updCode(S.html, 'html'); }

function selLang(l) {
  S.lang = l;
  document.querySelectorAll('.lp').forEach(p => p.classList.remove('on'));
  document.querySelector(`[data-l="${l}"]`)?.classList.add('on');
  if (l === 'custom') {
    document.getElementById('cain').placeholder = 'Ex: "Rust: servidor HTTP", "Bash: script de backup"...';
    document.getElementById('cain').focus(); return;
  }
  if (S.html) {
    if (l === 'html') { updCode(S.html, 'html'); return; }
    if (l === 'css') { const m = S.html.match(/<style[^>]*>([\s\S]*?)<\/style>/i); if (m) { updCode(m[1].trim(), 'css'); return; } }
    if (l === 'js')  { const m = S.html.match(/<script[^>]*>([\s\S]*?)<\/script>/i); if (m) { updCode(m[1].trim(), 'js'); return; } }
  }
  const nm = {css:'CSS',js:'JavaScript',ts:'TypeScript',python:'Python',java:'Java',cpp:'C++',php:'PHP',rb:'Ruby',go:'Go',rs:'Rust'};
  document.getElementById('cain').placeholder = `Descreva o que criar em ${nm[l]||l}...`;
  document.getElementById('cain').focus();
  updCode(`// PeÃ§a Ã  IA para gerar cÃ³digo ${nm[l]||l} na barra abaixo...`, l);
}

/* â”€â”€ MINIMAP â”€â”€ */
function drawMmap(code) {
  const cv = document.getElementById('mc'), c = document.getElementById('mmap');
  const W = c.offsetWidth, lines = code.split('\n').slice(0, 200);
  const H = Math.min(lines.length * 3, c.offsetHeight) || 300;
  cv.width = W; cv.height = H;
  const ctx = cv.getContext('2d'); ctx.clearRect(0, 0, W, H);
  lines.forEach((l, i) => {
    const b = Math.min(l.length / 80, 1);
    ctx.fillStyle = `rgba(124,106,247,${b * 0.5})`;
    ctx.fillRect(0, i * 3, W * b, 2);
  });
}

/* â”€â”€ THINKING â”€â”€ */
function showTk() { const p = document.getElementById('tkp'); p.innerHTML = ''; p.classList.add('show'); }
function hideTk() { setTimeout(() => document.getElementById('tkp').classList.remove('show'), 2800); }
function think(txt, t='gen', d=0) {
  setTimeout(() => {
    const p = document.getElementById('tkp');
    const r = document.createElement('div'); r.className = `trow ${t}`;
    r.innerHTML = `<span class="tt">${txt}</span>`;
    p.appendChild(r); p.scrollTop = p.scrollHeight;
  }, d);
}
function streamCode(code) {
  const p = document.getElementById('tkp');
  const w = document.createElement('div'); w.className = 'csm'; p.appendChild(w);
  code.split('\n').filter(l => l.trim()).slice(0, 16).forEach((l, i) => {
    setTimeout(() => {
      const d = document.createElement('div'); d.className = 'sl';
      d.textContent = l.substring(0, 68) + (l.length > 68 ? 'â€¦' : '');
      w.appendChild(d); w.scrollTop = w.scrollHeight;
    }, i * 75);
  });
}

/* â”€â”€ PREVIEW â”€â”€ */
function renderPv(html) {
  const f = document.getElementById('pvf');
  document.getElementById('pve').style.display = 'none';
  f.style.display = 'block';
  f.src = URL.createObjectURL(new Blob([html], { type: 'text/html' }));
}
function refreshPv() { if (S.html) renderPv(S.html); else toast('Gere um app primeiro!', 'err'); }
function openFs() {
  if (!S.html) { toast('Gere um app primeiro!', 'err'); return; }
  const w = window.open(''); w.document.write(S.html); w.document.close();
}
function dlApp() {
  if (!S.html) { toast('Gere um app primeiro!', 'err'); return; }
  dl('zedex-app.html', S.html, 'text/html'); toast('App baixado! ğŸ“¥', 'ok');
}

/* â”€â”€ COPY / DL CODE â”€â”€ */
function cpCode() {
  if (!S.raw) { toast('Sem cÃ³digo!', 'err'); return; }
  navigator.clipboard.writeText(S.raw).then(() => toast('Copiado! ğŸ“‹', 'ok'));
}
function dlCode() {
  if (!S.raw) { toast('Sem cÃ³digo!', 'err'); return; }
  const m = LM[S.lang] || LM.custom;
  dl(m.ext, S.raw, 'text/plain'); toast('Baixado! ğŸ“¥', 'ok');
}
function dl(name, content, type) {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([content], { type }));
  a.download = name; a.click();
}

/* â”€â”€ UI HELPERS â”€â”€ */
function sp(t) { document.getElementById('pi').value = t; closeSb(); }
function setBtn(on) {
  document.getElementById('gbtn').disabled = on;
  document.getElementById('gi').className = on ? 'fas fa-spinner fa-spin' : 'fas fa-bolt';
  document.getElementById('gt').textContent = on ? 'Gerando...' : 'Gerar App';
}
function switchPg(p) {
  document.querySelectorAll('.pg').forEach(e => e.classList.remove('on'));
  document.querySelectorAll('.pagetab').forEach(e => e.classList.remove('on'));
  document.getElementById('pg-' + p).classList.add('on');
  document.getElementById('tab-' + p).classList.add('on');
}
function toast(msg, type='ok') {
  const t = document.getElementById('toast'), i = document.getElementById('tic'), m = document.getElementById('tmsg');
  t.className = `toast show ${type}`;
  i.className = type === 'err' ? 'fas fa-circle-xmark' : 'fas fa-circle-check';
  m.textContent = msg;
  clearTimeout(t._t); t._t = setTimeout(() => t.className = 'toast', 3500);
}

/* â”€â”€ THEME â”€â”€ */
function toggleTdrop() { document.getElementById('tdrop').classList.toggle('open'); }
function setTheme(t, l) {
  document.documentElement.setAttribute('data-theme', t);
  document.getElementById('tlbl').textContent = l;
  document.querySelectorAll('.topt').forEach(o => o.classList.toggle('on', o.dataset.t === t));
  document.getElementById('tdrop').classList.remove('open');
  localStorage.setItem('zt', t); localStorage.setItem('ztl', l);
  if (S.raw) drawMmap(S.raw);
}
document.addEventListener('click', e => {
  if (!e.target.closest('.tbtn-hdr') && !e.target.closest('.tdrop'))
    document.getElementById('tdrop').classList.remove('open');
});

/* â”€â”€ SIDEBAR â”€â”€ */
function toggleSb() { document.getElementById('sb').classList.toggle('open'); document.getElementById('ov').classList.toggle('show'); }
function closeSb() { document.getElementById('sb').classList.remove('open'); document.getElementById('ov').classList.remove('show'); }

/* â”€â”€ INIT â”€â”€ */
(function() {
  const t = localStorage.getItem('zt') || 'dark';
  const l = localStorage.getItem('ztl') || 'Dark';
  document.documentElement.setAttribute('data-theme', t);
  document.getElementById('tlbl').textContent = l;
  document.querySelectorAll('.topt').forEach(o => o.classList.toggle('on', o.dataset.t === t));
  buildCdTabs('html');
  drawMmap('');
})();
</script>
</body>
</html>
