<!DOCTYPE html>
<html lang="pt-PT" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA-Zénia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #0b0d11; color: #e5e7eb; font-family: 'Inter', sans-serif; }
        .sidebar { background-color: #161b22; transition: all 0.3s ease; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .chat-container::-webkit-scrollbar { width: 5px; }
        .chat-container::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
        .glow-button { transition: all 0.3s ease; }
        .glow-button:hover { box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
        @keyframes pulse-red { 0% { transform: scale(1); } 50% { transform: scale(1.1); background: #ef4444; } 100% { transform: scale(1); } }
        .recording { animation: pulse-red 1.5s infinite; }
        @keyframes fade-in { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fade-in 200ms ease-out; }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <aside class="sidebar w-72 flex flex-col border-r border-gray-800">
        <div class="p-6 text-2xl font-bold tracking-tight text-blue-500">
            IA-Zénia <span class="text-xs font-light text-gray-500 block">by Zénia-Projects</span>
        </div>

        <div class="px-4 mb-4">
            <div class="relative">
                <i class="fas fa-search absolute left-3 top-3 text-gray-500 text-sm"></i>
                <input type="text" placeholder="Buscar em chats..." class="w-full bg-gray-900 border-none rounded-lg py-2 pl-9 pr-4 text-sm focus:ring-1 focus:ring-blue-500">
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto px-4 space-y-6">
            <div>
                <p class="text-xs font-semibold text-gray-500 uppercase mb-3">Aplicativos</p>
                <div class="space-y-2">
                    <a href="https://antonia-ia.netlify.app" target="_blank" rel="noopener noreferrer" class="flex items-center p-2 rounded-lg hover:bg-gray-800 transition text-sm">
                        <i class="fas fa-robot mr-3 text-pink-500"></i> Antónia-IA
                    </a>
                    <a href="https://zenia-projects.netlify.app" target="_blank" rel="noopener noreferrer" class="flex items-center p-2 rounded-lg hover:bg-gray-800 transition text-sm">
                        <i class="fas fa-code mr-3 text-blue-500"></i> Zénia-Projects
                    </a>
                </div>
            </div>

            <div>
                <p class="text-xs font-semibold text-gray-500 uppercase mb-3">Recursos</p>
                <button onclick="toggleGallery()" class="w-full flex items-center p-2 rounded-lg hover:bg-gray-800 transition text-sm">
                    <i class="fas fa-images mr-3 text-purple-500"></i> Galeria
                </button>
                <div id="history-list" class="mt-4 space-y-2">
                    <p class="text-xs text-gray-600 px-2 italic">Histórico Local</p>
                    </div>
            </div>
        </nav>

        <div class="p-4 border-t border-gray-800 flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center font-bold">U</div>
            <div class="flex-1 overflow-hidden">
                <p class="text-sm font-medium truncate" id="username-display">Utilizador Zénia</p>
                <p class="text-xs text-green-500 italic">Online</p>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative">
        
        <header class="h-16 border-b border-gray-800 flex items-center justify-between px-6 glass">
            <div class="flex items-center gap-4">
                <select id="voice-select" class="bg-transparent text-xs border border-gray-700 rounded p-1 outline-none focus:ring-1 focus:ring-blue-500">
                    <option value="pt-BR">Voz: Português Padrão</option>
                </select>
                <button id="voice-assist-btn" onclick="toggleVoiceAssist()" class="text-xs px-3 py-1 rounded-full border border-blue-500 text-blue-500 hover:bg-blue-500 hover:text-white transition">
                    <i class="fas fa-headset mr-2"></i>Modo Voz Assist.
                </button>
            </div>
            <div class="text-xs text-gray-500">Modelo: <span class="text-blue-400">Zenia-Full</span></div>
        </header>

        <div id="chat-window" class="flex-1 overflow-y-auto p-6 space-y-6 chat-container">
            <div class="flex flex-col items-center justify-center h-full text-center space-y-4 opacity-50" id="welcome-msg">
                <i class="fas fa-shield-cat text-6xl text-blue-500"></i>
                <h2 class="text-2xl font-bold">Olá, eu sou a Zénia.</h2>
                <p class="max-w-md">Criada no Lubango por Inácio U. Daniel. Como posso ajudar Angola hoje?</p>
            </div>
        </div>

        <div class="p-4 bg-gradient-to-t from-[#0b0d11] to-transparent">
            <div class="max-w-4xl mx-auto glass rounded-2xl p-2 flex flex-col">
                <div class="flex items-end gap-2 px-2 pb-2">
                    <button class="p-3 text-gray-400 hover:text-white transition" title="Anexar Arquivo">
                        <i class="fas fa-plus"></i>
                    </button>
                    <textarea id="user-input" rows="1" placeholder="Pergunte qualquer coisa à Zénia..." class="flex-1 bg-transparent border-none focus:ring-0 text-sm py-3 resize-none outline-none"></textarea>
                    
                    <button id="mic-btn" class="p-3 text-gray-400 hover:text-blue-500 transition">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button onclick="handleSendMessage()" class="p-3 bg-blue-600 rounded-xl hover:bg-blue-700 glow-button transition">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
            <p class="text-[10px] text-center mt-3 text-gray-600 uppercase tracking-widest">
                A Zénia pode cometer erros. Verifique informações importantes. Desenvolvido por Zénia-Projects.
            </p>
        </div>
    </main>

    <script>
        const API_KEY_PUBLIC = "pk_urEpxcajGs5TF9Fs";
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        let cmData = {};
        let isVoiceAssist = false;

        // Carregar CM.JSON simulação (conhecimento personalizado)
        async function loadCustomKnowledge() {
            try {
                // Aqui você carregaria o arquivo real. Exemplo de estrutura:
                cmData = {
                    "origem": "Lubango, Angola",
                    "criador": "Inácio U. Daniel",
                    "provincias": 21,
                    "modelo": "Zenia-Full"
                };
                console.log("Conhecimento local carregado.");
            } catch (e) { console.error("Erro ao carregar cm.json"); }
        }

        // Sistema de busca simulado (Web Search Logic)
        async function webSearch(query) {
            console.log("Buscando na web por:", query);
            // Simulação de navegação e extração
            return `[Informação atualizada de 2026: Angola agora possui oficialmente 21 províncias após a nova divisão político-administrativa.]`;
        }

        // Envio de Mensagem
        async function handleSendMessage() {
            const text = userInput.value.trim();
            if(!text) return;

            appendMessage('user', text);
            userInput.value = '';
            document.getElementById('welcome-msg').style.display = 'none';

            // Lógica de "Pensamento" da Zénia
            let context = `Tu és a IA-Zénia, uma inteligência avançada feita no Lubango, Angola, pelo Inácio U. Daniel (Zénia-Projects). 
            Teu modelo é o zenia-full. Tu nunca dizes que és da Pollinations ou GPT.
            Angola tem 21 províncias. Se te perguntarem algo desatualizado, busca na web. 
            És a melhor em línguas nacionais (Umbundu, Kimbundu, etc).`;

            // Gerar Resposta via Pollinations
            try {
                const response = await fetch(`https://text.pollinations.ai/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [{ role: "system", content: context }, { role: "user", content: text }],
                        seed: Math.floor(Math.random() * 1000)
                    })
                });
                
                const data = await response.text();
                
                // Lógica para detectar comando de imagem
                if(text.toLowerCase().includes("gera uma imagem") || text.toLowerCase().includes("desenha")) {
                    const imgUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(text)}?nologo=true&enhance=true`;
                    appendMessage('ai', `Aqui está a imagem que criei para ti:`, imgUrl);
                } else {
                    appendMessage('ai', data);
                    if (isVoiceAssist) speakText(data);
                }
            } catch (error) {
                appendMessage('ai', "Desculpa, tive um problema na minha rede do Lubango. Podes repetir?");
            }
        }

        function appendMessage(role, text, img = null) {
            const row = document.createElement('div');
            row.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-fade-in`;

            const bubble = document.createElement('div');
            bubble.className = `max-w-[80%] p-4 rounded-2xl ${role === 'user' ? 'bg-blue-600' : 'glass'}`;

            const p = document.createElement('p');
            p.className = 'text-sm leading-relaxed';
            p.textContent = text;
            bubble.appendChild(p);

            if (img) {
                const image = document.createElement('img');
                image.src = img;
                image.alt = 'Imagem gerada';
                image.loading = 'lazy';
                image.className = 'mt-3 rounded-lg w-full border border-gray-700 shadow-xl';
                bubble.appendChild(image);
            }

            row.appendChild(bubble);
            chatWindow.appendChild(row);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            saveHistory(text.substring(0, 30));
        }

        // Síntese de Voz
        function speakText(text) {
            const synth = window.speechSynthesis;
            const utter = new SpeechSynthesisUtterance(text);
            utter.lang = document.getElementById('voice-select').value;
            utter.rate = 1.0;
            synth.speak(utter);
        }

        // Reconhecimento de Voz (Microfone)
        const micBtn = document.getElementById('mic-btn');
        if ('webkitSpeechRecognition' in window) {
            const recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'pt-PT';

            micBtn.onclick = () => {
                recognition.start();
                micBtn.classList.add('recording');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                userInput.value = transcript;
                micBtn.classList.remove('recording');
                handleSendMessage();
            };
        }

        function toggleVoiceAssist() {
            isVoiceAssist = !isVoiceAssist;
            const btn = document.getElementById('voice-assist-btn');
            if(isVoiceAssist) {
                btn.classList.replace('text-blue-500', 'bg-red-500');
                btn.classList.add('text-white');
                appendMessage('ai', "Modo Assistente de Voz ligado. Podes falar comigo naturalmente.");
            } else {
                btn.classList.replace('bg-red-500', 'text-blue-500');
                btn.classList.remove('text-white');
            }
        }

        function saveHistory(title) {
            const hist = document.getElementById('history-list');
            const item = document.createElement('div');
            item.className = "p-2 hover:bg-gray-800 rounded text-[11px] text-gray-400 truncate cursor-pointer flex items-center";
            const icon = document.createElement('i');
            icon.className = "far fa-comment-alt mr-2";
            const textNode = document.createElement('span');
            textNode.textContent = `${title}...`;
            item.appendChild(icon);
            item.appendChild(textNode);
            hist.prepend(item);
        }

        function toggleGallery() {
            let gallery = document.getElementById('gallery-container');
            if (!gallery) {
                const recursosBlock = document.querySelector('button[onclick="toggleGallery()"]').parentElement;
                gallery = document.createElement('div');
                gallery.id = 'gallery-container';
                gallery.className = 'mt-3 grid grid-cols-3 gap-2';
                const sources = [
                    'https://picsum.photos/seed/zenia1/300/200',
                    'https://picsum.photos/seed/zenia2/300/200',
                    'https://picsum.photos/seed/zenia3/300/200',
                    'https://picsum.photos/seed/zenia4/300/200',
                    'https://picsum.photos/seed/zenia5/300/200',
                    'https://picsum.photos/seed/zenia6/300/200'
                ];
                sources.forEach(src => {
                    const img = document.createElement('img');
                    img.src = src;
                    img.alt = 'Galeria Zénia';
                    img.loading = 'lazy';
                    img.className = 'rounded-lg border border-gray-800';
                    gallery.appendChild(img);
                });
                recursosBlock.appendChild(gallery);
            } else {
                gallery.style.display = gallery.style.display === 'none' ? '' : 'none';
            }
        }

        window.onload = loadCustomKnowledge;
    </script>
</body>
</html>
