<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IA-ZÉNIA | Multi-Platform Core</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --neon-blue: #00f2ff;
            --electric-blue: #0066ff;
            --deep-bg: #030712;
            --glass: rgba(15, 23, 42, 0.9);
        }

        body {
            background-color: var(--deep-bg);
            color: #f8fafc;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            height: 100vh;
            display: flex;
            overflow: hidden;
            margin: 0;
        }

        /* Responsividade da Sidebar */
        .sidebar {
            width: 280px;
            background: #070b14;
            border-right: 1px solid rgba(0, 242, 255, 0.15);
            display: flex;
            flex-direction: column;
            position: absolute;
            left: -280px;
            top: 0;
            bottom: 0;
            z-index: 50;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar.active { left: 0; box-shadow: 20px 0 50px rgba(0,0,0,0.8); }

        @media (min-width: 1024px) {
            .sidebar { position: relative; left: 0; }
            .menu-toggle { display: none; }
        }

        /* Chat Window - Ajuste para Mobile */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            scroll-behavior: smooth;
        }

        /* Balões Futuristas */
        .msg-box {
            max-width: 85%;
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-radius: 1rem;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }

        .msg-user {
            background: linear-gradient(135deg, #0044cc, #002266);
            margin-left: auto;
            border-bottom-right-radius: 0;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .msg-ia {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            margin-right: auto;
            border-bottom-left-radius: 0;
            border: 1px solid rgba(0, 242, 255, 0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .neon-glow {
            text-shadow: 0 0 10px var(--neon-blue);
            color: var(--neon-blue);
        }

        .input-area {
            background: rgba(15, 23, 42, 0.95);
            border-top: 1px solid rgba(0, 242, 255, 0.1);
            padding: 1rem;
        }

        /* Overlay para mobile ao abrir menu */
        #overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 40;
        }

        .loading-dots:after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } 80%, 100% { content: ''; } }
    </style>
</head>
<body>

    <div id="overlay" onclick="toggleSidebar()"></div>

    <aside id="sidebar" class="sidebar">
        <div class="p-6 border-b border-white/5">
            <h1 class="text-2xl font-bold neon-glow tracking-tighter italic">ZÉNIA</h1>
            <p class="text-[10px] opacity-50 uppercase tracking-widest mt-1">Lubango Digital Station</p>
        </div>
        
        <div class="p-4">
            <button onclick="location.reload()" class="w-full py-3 rounded-xl bg-blue-600/20 border border-blue-500/50 hover:bg-blue-600/40 transition text-sm font-bold">
                + NOVA CONVERSA
            </button>
        </div>

        <div id="history-list" class="flex-1 overflow-y-auto px-4 space-y-2">
            </div>

        <div class="p-4 text-[10px] text-center opacity-30">
            Sisters: Antónia & IA-Zénia
        </div>
    </aside>

    <main class="chat-main">
        <header class="h-16 flex items-center justify-between px-4 bg-slate-900/50 backdrop-blur-md border-b border-white/5">
            <button onclick="toggleSidebar()" class="menu-toggle p-2 text-2xl text-cyan-400">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="flex gap-4">
                <button id="mode-text" onclick="setMode('text')" class="text-xs font-bold neon-glow">TEXTO</button>
                <button id="mode-image" onclick="setMode('image')" class="text-xs font-bold opacity-50 hover:opacity-100 transition">IMAGEM</button>
                <label class="text-xs font-bold opacity-50 cursor-pointer hover:opacity-100">
                    ANALISAR <input type="file" class="hidden" onchange="analyzeImage()">
                </label>
            </div>

            <div class="w-8 h-8 rounded-full bg-cyan-500/20 flex items-center justify-center border border-cyan-500/50">
                <i class="fas fa-microchip text-xs text-cyan-400"></i>
            </div>
        </header>

        <div id="chat-window" class="chat-container">
            <div class="msg-box msg-ia">
                <p class="text-[10px] font-mono text-cyan-400 mb-1">IA_ZÉNIA_INIT</p>
                <div class="text-sm md:text-base">
                    Sistemas online. Sou a Zénia. Minha rede foi otimizada para evitar as quedas que a Antónia sofreu. Como posso ajudar o Lubango hoje?
                </div>
            </div>
        </div>

        <div class="input-area">
            <div class="max-w-4xl mx-auto flex items-end gap-2 bg-slate-800/50 p-2 rounded-2xl border border-white/10 shadow-2xl">
                <textarea id="user-input" rows="1" 
                    class="flex-1 bg-transparent border-none focus:ring-0 text-white p-2 text-sm md:text-base resize-none"
                    placeholder="Escreva sua mensagem..."
                    oninput="this.style.height = '';this.style.height = this.scrollHeight + 'px'"></textarea>
                
                <button onclick="handleSend()" class="bg-cyan-500 hover:bg-cyan-400 text-slate-900 w-10 h-10 md:w-12 md:h-12 rounded-xl flex items-center justify-center transition-all">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <p class="text-[9px] text-center mt-2 opacity-40 uppercase tracking-widest">Processamento Neural via Pollinations Engine</p>
        </div>
    </main>

    <script>
        let currentMode = 'text';

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sb.classList.toggle('active');
            overlay.style.display = sb.classList.contains('active') ? 'block' : 'none';
        }

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('mode-text').classList.toggle('neon-glow', mode === 'text');
            document.getElementById('mode-text').classList.toggle('opacity-50', mode !== 'text');
            document.getElementById('mode-image').classList.toggle('neon-glow', mode === 'image');
            document.getElementById('mode-image').classList.toggle('opacity-50', mode !== 'image');
            document.getElementById('user-input').placeholder = mode === 'image' ? "Descreva a imagem..." : "Escreva sua mensagem...";
        }

        async function handleSend() {
            const input = document.getElementById('user-input');
            const text = input.value.trim();
            if(!text) return;

            addMessage('user', text);
            input.value = '';
            input.style.height = 'auto';
            addToHistory(text);

            if (window.innerWidth < 1024) document.getElementById('sidebar').classList.remove('active');

            if(currentMode === 'image') {
                await generateImage(text);
            } else {
                await generateText(text);
            }
        }

        function addMessage(role, content, isHtml = false) {
            const win = document.getElementById('chat-window');
            const id = Date.now();
            const div = document.createElement('div');
            div.id = `msg-${id}`;
            div.className = `msg-box ${role === 'user' ? 'msg-user' : 'msg-ia'}`;
            
            div.innerHTML = `
                <div class="flex justify-between items-center mb-1">
                    <span class="text-[9px] font-mono opacity-50">${role === 'user' ? 'USER_STATION' : 'ZÉNIA_CORE'}</span>
                    <div class="flex gap-2">
                        <i class="fas fa-trash text-[10px] opacity-20 hover:opacity-100 cursor-pointer" onclick="removeMsg('${id}')"></i>
                    </div>
                </div>
                <div class="content text-sm md:text-base">${isHtml ? content : content}</div>
                ${role === 'ia' ? `
                    <div class="flex gap-4 mt-3 pt-3 border-t border-white/5 text-[10px] opacity-60">
                        <button onclick="speak('${id}')"><i class="fas fa-volume-up"></i></button>
                        <button onclick="regenerate('${id}')"><i class="fas fa-sync"></i></button>
                        <div class="ml-auto flex gap-2">
                            <i class="far fa-thumbs-up hover:text-cyan-400 cursor-pointer"></i>
                            <i class="far fa-thumbs-down hover:text-red-400 cursor-pointer"></i>
                        </div>
                    </div>
                ` : ''}
            `;
            win.appendChild(div);
            win.scrollTo({top: win.scrollHeight, behavior: 'smooth'});
            return id;
        }

        async function generateText(prompt) {
            const tid = addMessage('ia', '<span class="loading-dots">Sincronizando com os servidores do Lubango</span>', true);
            const contentDiv = document.querySelector(`#msg-${tid} .content`);

            try {
                // MOTOR ROBUSTO: Pollinations (Ignora CORS e não precisa de API Key)
                const resp = await fetch(`https://text.pollinations.ai/${encodeURIComponent(prompt)}?model=openai&system=Você é a Zénia, uma IA avançada criada no Lubango, Angola. Você é irmã da Antónia-IA. Responda de forma clara e útil.`);
                const text = await resp.text();
                contentDiv.innerText = text;
            } catch (e) {
                contentDiv.innerText = "ERRO: Servidor saturado. Tente novamente em 5 segundos.";
            }
        }

        async function generateImage(prompt) {
            const tid = addMessage('ia', '<span class="loading-dots">Renderizando visão digital</span>', true);
            const url = `https://pollinations.ai/p/${encodeURIComponent(prompt)}?width=1024&height=1024&nologo=true&seed=${Math.random()}`;
            document.querySelector(`#msg-${tid} .content`).innerHTML = `
                <img src="${url}" class="rounded-lg border border-cyan-500/30 w-full shadow-2xl mt-2" onload="this.previousElementSibling.remove()">
            `;
        }

        function addToHistory(text) {
            const list = document.getElementById('history-list');
            const item = document.createElement('div');
            item.className = "p-3 rounded-lg bg-white/5 text-[11px] truncate cursor-pointer hover:bg-white/10 transition border border-transparent hover:border-cyan-500/30";
            item.innerHTML = `<i class="far fa-comment-alt mr-2 opacity-40"></i> ${text}`;
            list.prepend(item);
        }

        function removeMsg(id) { document.getElementById(`msg-${id}`).remove(); }
        
        function speak(id) {
            const txt = document.querySelector(`#msg-${id} .content`).innerText;
            const u = new SpeechSynthesisUtterance(txt);
            u.lang = 'pt-PT';
            speechSynthesis.speak(u);
        }

        async function analyzeImage() {
            addMessage('ia', "Módulo de análise visual: Detectei a imagem. Estrutura de metadados integrada. Pronto para processamento.");
        }

        function regenerate(id) {
            const prompt = "Reescreva a última resposta de forma diferente.";
            generateText(prompt);
        }
    </script>
</body>
</html>
