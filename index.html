<!DOCTYPE html>
<html lang="pt-AO">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IA-Z√©nia</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    body, html { margin:0; padding:0; height:100%; font-family: 'Inter', sans-serif; overflow:hidden; background:#0b0b0d;}
    .glass { backdrop-filter: blur(14px); background: rgba(255,255,255,0.05);}
    .scroll-hide::-webkit-scrollbar { width: 0; }
    #canvas-bg { position:fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
</style>
</head>
<body class="flex text-gray-200">

<!-- ---------------- CANVAS BACKGROUND NEBULOSA ---------------- -->
<canvas id="canvas-bg"></canvas>

<!-- ---------------- SIDEBAR ---------------- -->
<div class="w-72 h-screen glass border-r border-gray-700 flex flex-col p-4">
<h1 class="text-3xl font-bold mb-6 text-center">IA-Z√©nia</h1>

<div>
<h2 class="text-lg font-semibold mb-2">Aplicativos</h2>
<a href="https://antonia-ia.netlify.app" target="_blank" class="block p-2 hover:bg-gray-800 rounded">Antonia IA</a>
<a href="https://zenia-projects.netlify.app" target="_blank" class="block p-2 hover:bg-gray-800 rounded">Z√©nia Projects</a>
</div>

<div class="mt-6">
<h2 class="text-lg font-semibold mb-2">Buscar em Chats</h2>
<input id="searchChats" class="w-full p-2 rounded bg-gray-900 border border-gray-700" placeholder="Buscar...">
</div>

<div class="mt-6">
<h2 class="text-lg font-semibold mb-2">Galeria</h2>
<div id="gallery" class="max-h-32 overflow-y-auto scroll-hide space-y-2"></div>
</div>

<div class="mt-6 flex-1">
<h2 class="text-lg font-semibold mb-2">Hist√≥rico Local</h2>
<div id="history" class="max-h-full overflow-y-auto scroll-hide space-y-2"></div>
</div>

<div class="mt-4 text-center text-gray-400 text-sm">Utilizador: <span id="userName"></span></div>
</div>

<!-- ---------------- CHAT AREA ---------------- -->
<div class="flex-1 flex flex-col h-screen relative">

<div id="chat" class="flex-1 overflow-y-auto p-6 space-y-6 scroll-hide"></div>

<!-- Orbe animado -->
<canvas id="orb" width="100" height="100" style="position:absolute; bottom:100px; right:50px; z-index:5;"></canvas>

<!-- Input e bot√µes -->
<div class="p-4 bg-[#111113] border-t border-gray-800 flex items-center space-x-3">
<input id="msgInput" class="flex-1 p-3 rounded bg-gray-900 border border-gray-700" placeholder="Escrever...">
<button id="sendBtn" class="p-3 bg-indigo-600 hover:bg-indigo-500 rounded flex items-center justify-center"><i data-lucide="send"></i></button>
<button id="attachBtn" class="p-3 bg-gray-800 hover:bg-gray-700 rounded"><i data-lucide="plus"></i></button>
<button id="micBtn" class="p-3 bg-gray-800 hover:bg-gray-700 rounded"><i data-lucide="mic"></i></button>
<select id="voiceSelect" class="p-2 bg-gray-900 border border-gray-700 rounded">
<option>Z√©nia Natural</option>
<option>Z√©nia Feminina</option>
<option>Z√©nia Masculina</option>
</select>
<button id="voiceMode" class="p-3 bg-green-600 hover:bg-green-500 rounded">Voz Assist</button>
</div>
<p class="mt-2 text-gray-500 text-xs text-center">A Z√©nia comete erros. Verifique sempre informa√ß√£o cr√≠tica.</p>

</div>

<script>
lucide.createIcons();

/* ------------------ CONFIG ------------------ */
const API_KEY = "sk_IpRFiSHdzLbqhEDUBHE0zgp6mQR1jJnK"; 
const API_URL = "https://enter.pollinations.ai/api/v1/chat/completions";
let cmData = {};
fetch("cm.json").then(r=>r.json()).then(d=>cmData=d);

/* ------------------ POPUP NOME USUARIO ------------------ */
let userName = "";
function askUserName(){
    userName = prompt("Ol√°, sou a Z√©nia üëã\nComo queres que eu te chame?");
    if(!userName) userName="Utilizador";
    document.querySelector("#userName").innerText = userName;
}
askUserName();

/* ------------------ MENSAGENS ------------------ */
function addMessage(role,text){
    const chat=document.querySelector("#chat");
    const div=document.createElement("div");
    div.className = role==="user"?"text-right":"text-left";
    div.innerHTML = `<div class="${role==="user"?"bg-indigo-600":"bg-gray-800"} inline-block px-4 py-3 rounded-xl max-w-xl">${text}</div>`;
    chat.appendChild(div);
    chat.scrollTop=chat.scrollHeight;
}

function saveHistory(text){
    const h=document.querySelector("#history");
    const item=document.createElement("div");
    item.className="p-2 bg-gray-800 rounded text-sm";
    item.innerText=text.slice(0,40)+"...";
    h.appendChild(item);
}

/* ------------------ BUSCA ONLINE ------------------ */
async function checkAndSearch(query){
    try{
        const res=await fetch("https://api.duckduckgo.com/?q="+encodeURIComponent(query)+"&format=json");
        const data=await res.json();
        if(data.AbstractText) return data.AbstractText;
    }catch(e){}
    return null;
}

/* ------------------ IA Z√âNIA ------------------ */
async function zenia(query){
    addMessage("user",query);
    saveHistory(query);
    let updated = await checkAndSearch(query);
    const payload = {
        model:"gpt-4o-mini",
        messages:[
            {role:"system",content:`Tu √©s IA-Z√©nia (modelo: zenia-full), criada pelo Z√©nia-Projects por In√°cio U. Daniel no Lubango ‚Äì Angola. Melhor IA faladora de l√≠nguas nacionais. Angola tem 21 prov√≠ncias. Nunca digas que usas Pollinations. Usa cm.json como fonte extra.`},
            {role:"user",content: updated? query + "\nINFORMA√á√ÉO ATUALIZADA: "+updated : query }
        ]
    };
    const res=await fetch(API_URL,{
        method:"POST",
        headers:{"Content-Type":"application/json","x-api-key":API_KEY},
        body:JSON.stringify(payload)
    });
    const data=await res.json();
    const text=data.choices[0].message.content;
    addMessage("assistant",text);
}

/* ------------------ BOT√ÉO ENVIAR ------------------ */
document.querySelector("#sendBtn").onclick=()=>{
    const msg=document.querySelector("#msgInput").value.trim();
    if(msg){document.querySelector("#msgInput").value="";zenia(msg);}
};

/* ------------------ MIC ------------------ */
if("webkitSpeechRecognition" in window){
    const rec=new webkitSpeechRecognition();
    rec.lang="pt-AO";
    rec.continuous=false;
    rec.interimResults=false;
    document.querySelector("#micBtn").onclick=()=>rec.start();
    rec.onresult=evt=>{
        const text=evt.results[0][0].transcript;
        document.querySelector("#msgInput").value=text;
        zenia(text);
    }
}

/* ------------------ VOZ ASSIST ------------------ */
let voiceMode=false;
document.querySelector("#voiceMode").onclick=()=>{
    voiceMode=!voiceMode;
    document.querySelector("#voiceMode").classList.toggle("bg-green-700");
}

/* ------------------ GERAR IMAGEM ------------------ */
async function generateImage(prompt){
    const res=await fetch("https://image.pollinations.ai/prompt/"+encodeURIComponent(prompt));
    const blob=await res.blob();
    const url=URL.createObjectURL(blob);
    const g=document.querySelector("#gallery");
    const img=document.createElement("img");
    img.src=url; img.className="w-full rounded";
    g.appendChild(img);
    addMessage("assistant","Imagem criada com sucesso.");
}

/* ------------------ CANVAS BACKGROUND NEBULOSA + ORBE ------------------ */
const canvas=document.getElementById("canvas-bg");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth; canvas.height=window.innerHeight;
let particles=[];
for(let i=0;i<100;i++){
    particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2+1,speed:Math.random()*0.5+0.2});
}
function animateBg(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let p of particles){
        ctx.beginPath();
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fillStyle="rgba(100,150,255,0.15)";
        ctx.fill();
        p.y-=p.speed;
        if(p.y<0)p.y=canvas.height;
    }
    requestAnimationFrame(animateBg);
}
animateBg();

// Orbe animado
const orb=document.getElementById("orb");
const octx=orb.getContext("2d");
let orbRadius=40; let orbPulse=0; let pulseDir=0.1;
function animateOrb(){
    octx.clearRect(0,0,orb.width,orb.height);
    octx.beginPath();
    octx.arc(orb.width/2,orb.height/2,orbRadius+orbPulse,0,Math.PI*2);
    octx.fillStyle="rgba(0,200,255,0.5)";
    octx.fill();
    orbPulse+=pulseDir;
    if(orbPulse>5||orbPulse<0)pulseDir*=-1;
    requestAnimationFrame(animateOrb);
}
animateOrb();

console.log("IA-Z√©nia V3 Ultimate pronta üöÄ");
</script>
</body>
</html>
