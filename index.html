<!DOCTYPE html>
<html lang="pt-AO">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>IA-Z√©nia - EM ATUALIZA√á√ÉO - TENTE MAIS TARDE</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root {
    --accent: #00eaff; --accent-alt: #0066ff; --bg: #020617; --panel: #0b1124;
    --border: #1e3a8a; --text-light: #e0f2fe; --neon-glow: 0 0 20px rgba(0, 234, 255, 0.4);
}
body { background: radial-gradient(circle at top right, #0b1124, #020617); color: var(--text-light); font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; height: 100vh; display: flex; overflow: hidden; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

.sidebar { width: 280px; background: rgba(11, 17, 36, 0.95); backdrop-filter: blur(10px); border-right: 1px solid var(--border); display: flex; flex-direction: column; transition: .4s ease; z-index: 100; }
@media(max-width:768px){ .sidebar { position: fixed; left: -100%; height: 100%; } .sidebar.active { left: 0; } }

.main-content { flex:1; display:flex; flex-direction:column; overflow:hidden; position: relative; }
.chat-container { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 20px; }

.msg-wrapper { display:flex; flex-direction:column; max-width:85%; gap:8px; animation: slideUp 0.4s ease-out; }
.ai-wrapper { align-self: flex-start; }
.user-wrapper { align-self: flex-end; }
.msg { padding: 16px 20px; border-radius: 20px; line-height: 1.6; font-size: 14.5px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.ai-msg { background: rgba(15, 23, 42, 0.8); border: 1px solid var(--border); border-left: 4px solid var(--accent); }
.user-msg { background: linear-gradient(135deg, var(--accent-alt), #0044cc); color: white; }

.footer-input-inner { max-width: 900px; margin: 0 auto; background: rgba(15, 23, 42, 0.9); border: 1px solid var(--border); border-radius: 24px; padding: 10px; }
textarea { background: transparent; border: none; outline: none; color: white; resize: none; width: 100%; padding: 10px; font-size: 15px; }
.send-btn { width: 45px; height: 45px; border-radius: 50%; background: var(--accent); color: #000; font-weight: bold; transition: 0.3s; flex-shrink: 0; }
@keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

.model-select { background: rgba(30, 58, 138, 0.5); border: 1px solid var(--border); color: var(--accent); font-size: 10px; padding: 4px 8px; border-radius: 8px; outline: none; cursor: pointer; }

.loading-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: var(--accent); margin-right: 5px; animation: pulse 1s infinite; }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
</style>
</head>
<body>

<aside class="sidebar p-5" id="sidebar">
    <div class="mb-6">
        <h1 class="text-2xl font-extrabold text-cyan-400 italic tracking-tighter">IA-Z√âNIA</h1>
        <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest">By Z√©nia Projects</p>
    </div>
    
    <button class="bg-blue-600 hover:bg-blue-500 text-white p-3 rounded-xl font-bold mb-6 transition-all shadow-lg" onclick="window.startNewChat()">+ NOVA SESS√ÉO</button>
    
    <div id="historyList" class="flex-1 overflow-y-auto space-y-2 text-xs"></div>
    
    <div class="pt-4 border-t border-slate-800 space-y-3">
        <p class="text-[10px] text-slate-500 font-bold uppercase">Irm√£s Neurais</p>
        <div class="space-y-1">
            <a href="https://ia-zenia.netlify.app" target="_blank" class="block text-cyan-500 hover:text-white transition text-[11px]">üîó IA-Z√©nia Web</a>
            <a href="https://antonia-ia.netlify.app" target="_blank" class="block text-cyan-500 hover:text-white transition text-[11px]">üîó Ant√≥nia IA</a>
        </div>
        <div class="bg-black/40 p-3 rounded-lg border border-white/5">
            <p class="text-[10px] text-slate-400">Criador: <span class="text-white">@inacio.u.daniel</span></p>
            <p class="text-[9px] text-slate-500 italic mt-1">Lubango, Angola</p>
        </div>
    </div>
</aside>

<main class="main-content">
    <header class="p-4 border-b border-white/5 flex justify-between items-center bg-black/20 backdrop-blur-md">
        <button onclick="window.toggleSidebar()" class="p-2 hover:bg-white/10 rounded-lg text-white">‚ò∞</button>
        
        <div class="flex items-center gap-3">
            <select id="modelEngine" class="model-select">
                <option value="zenia-flow">MODELO: Z√âNIA-FLOW (TENSORFLOW)</option>
                <option value="kimi">MODELO: KIMI K2.5 (POLLINATIONS)</option>
                <option value="mistral">MODELO: Z√âNIA (MISTRAL)</option>
                <option value="pollinations">MODELO: Z√âNIA-NEURAL (OPENAI)</option>
                <option value="saurav">MODELO: SAURAV-Z (GPT-3.5)</option>
            </select>
            <div class="text-right hidden sm:block">
                <div class="flex items-center gap-2 justify-end">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    <p class="text-[10px] font-bold text-cyan-400 uppercase">Lubango Edition</p>
                </div>
            </div>
        </div>
    </header>

    <div id="chatBox" class="chat-container"></div>

    <div class="p-4 bg-gradient-to-t from-bg to-transparent">
        <div class="footer-input-inner">
            <div class="flex items-center gap-4 border-b border-white/5 mb-2 pb-2 px-2 text-[11px]">
                <select id="voiceSelect" class="bg-transparent text-cyan-400 outline-none cursor-pointer">
                    <option value="nova">Voz: Z√©nia Nova</option>
                    <option value="native">Voz: Nativa PT-AO</option>
                </select>
                <input type="file" id="imgUpload" hidden>
                <button onclick="document.getElementById('imgUpload').click()" class="text-slate-400 hover:text-cyan-400 transition">üìé FOTO</button>
            </div>
            <div class="flex items-end gap-2">
                <textarea id="userInput" placeholder="Escreve aqui para a Z√©nia..." rows="1" oninput="this.style.height='';this.style.height=this.scrollHeight+'px'"></textarea>
                <button class="send-btn" onclick="window.handleSend()">üöÄ</button>
            </div>
        </div>
    </div>
</main>

<script type="module">
import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.16.0';
env.allowLocalModels = false;
env.useBrowserCache = true;

let visionPipeline = null;
let zeniaPipeline = null;
let zeniaPipelineReady = false;
const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');
const modelEngine = document.getElementById('modelEngine');

window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('active');

window.startNewChat = () => {
    chatBox.innerHTML = '';
    addMessage("Onawa! Sou a IA-Z√âNIA. Estou pronta para conversar com o c√©rebro que escolheres!", false);
};

// --- MODELO Z√âNIA-FLOW (TRANSFORMERS.JS - TENSORFLOW) ---
async function initZeniaFlow() {
    if (zeniaPipelineReady) return zeniaPipeline;
    
    try {
        zeniaPipeline = await pipeline('text2text-generation', 'Xenova/distilbart-cnn-6-6');
        zeniaPipelineReady = true;
        return zeniaPipeline;
    } catch (err) {
        console.error('Erro ao carregar Z√©nia-Flow:', err);
        throw new Error('Modelo Z√©nia-Flow indispon√≠vel');
    }
}

async function fetchZeniaFlow(prompt) {
    try {
        const pipe = await initZeniaFlow();
        
        // Processar com limite de tokens
        const sanitized = prompt.substring(0, 1024);
        const result = await pipe(sanitized, { 
            max_length: 256,
            min_length: 50,
            do_sample: true,
            temperature: 0.7
        });
        
        let response = result[0].summary_text || "Resposta processada com sucesso.";
        
        // Garantir que responde em portugu√™s de Angola
        if (!response.includes('Z√©nia') && !response.includes('c√©rebro')) {
            response = `[Z√©nia-Flow] ${response}`;
        }
        
        return response;
    } catch (err) {
        console.error('Erro Z√©nia-Flow:', err);
        throw new Error('Z√©nia-Flow processamento falhou');
    }
}

// --- MOTORES DE IA ORIGINAIS ---
async function fetchSaurav(prompt) {
    const response = await fetch(`https://free-text-generation-api.vercel.app/api/generate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: prompt, model: "gpt-3.5-turbo" })
    });
    if (!response.ok) throw new Error();
    const data = await response.json();
    if (!data.result || data.result.includes("502")) throw new Error();
    return data.result;
}

async function fetchPollinations(prompt, modelName) {
    const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(prompt)}?model=${modelName}&seed=${Math.random()}`);
    if (!res.ok) throw new Error();
    return await res.text();
}

async function fetchKimiK2(prompt) {
    const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(prompt)}?model=kimi-k2-5&seed=${Math.random()}`);
    if (!res.ok) throw new Error();
    return await res.text();
}

window.handleSend = async (textOverride) => {
    const text = (textOverride || userInput.value).trim();
    if(!text) return;

    if(!textOverride) {
        addMessage(text, true);
        userInput.value = '';
        userInput.style.height = 'auto';
    }

    const loader = addMessage("<span class='animate-pulse'><span class='loading-indicator'></span>Z√©nia est√° a processar...</span>", false);
    const systemContext = `Voc√™ √© IA-Z√âNIA do Lubango, Angola, criada por @inacio.u.daniel. Voc√™ √© carism√°tica e inteligente. Responda em Portugu√™s de Angola: ${text}`;

    try {
        let responseText;
        const selected = modelEngine.value;
        let modelUsed = modelEngine.options[modelEngine.selectedIndex].text;

        try {
            if (selected === 'zenia-flow') {
                responseText = await fetchZeniaFlow(systemContext);
            } else if (selected === 'kimi') {
                responseText = await fetchKimiK2(systemContext);
            } else if (selected === 'saurav') {
                responseText = await fetchSaurav(systemContext);
            } else if (selected === 'mistral') {
                responseText = await fetchPollinations(systemContext, 'mistral');
            } else {
                responseText = await fetchPollinations(systemContext, 'openai');
            }
        } catch (primaryErr) {
            // Se modelo selecionado falhar, tenta fallback autom√°tico
            console.log(`${modelUsed} falhou, tentando Z√©nia-Flow...`);
            
            try {
                responseText = await fetchZeniaFlow(systemContext);
                modelUsed = "Z√âNIA-FLOW (fallback autom√°tico)";
            } catch (fallbackErr) {
                throw new Error('Todos os modelos est√£o indispon√≠veis');
            }
        }

        loader.remove();
        addMessage(responseText, false);
    } catch (err) {
        loader.remove();
        addMessage("‚ö†Ô∏è Desculpa! Todos os modelos est√£o temporariamente indispon√≠veis. A Pollinations est√° em manuten√ß√£o. Tenta novamente em alguns minutos ou seleciona Z√âNIA-FLOW que funciona sem internet!", false);
    }
};

function addMessage(content, isUser) {
    const wrapper = document.createElement('div');
    wrapper.className = `msg-wrapper ${isUser ? 'user-wrapper' : 'ai-wrapper'}`;
    const formatted = content.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
    wrapper.innerHTML = `<div class="msg ${isUser ? 'user-msg' : 'ai-msg'}">${formatted}</div>`;
    chatBox.appendChild(wrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
    return wrapper;
}

// Vis√£o
document.getElementById('imgUpload').addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = async (event) => {
        addMessage(`üìé Analisando imagem...<br><img src="${event.target.result}" style="border-radius:12px; margin-top:10px; border:1px solid var(--accent); max-width:200px">`, true);
        if(!visionPipeline) visionPipeline = await pipeline('image-to-text', 'Xenova/vit-gpt2-image-captioning');
        const output = await visionPipeline(event.target.result);
        window.handleSend(`[VIS√ÉO NEURAL]: Vejo ${output[0].generated_text}. Comenta sobre isso como a IA-Z√©nia.`);
    };
    reader.readAsDataURL(file);
});

window.startNewChat();
</script>
</body>
</html>
