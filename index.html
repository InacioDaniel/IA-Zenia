<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA-Z√âNIA Angola 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #3b82f6; --bg: #010409; --panel: #0d1117; --border: #30363d; }
        body { background: var(--bg); color: #e6edf3; font-family: 'Plus Jakarta Sans', sans-serif; height: 100vh; display: flex; overflow: hidden; margin: 0; }
        
        .sidebar { width: 280px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; }
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; scrollbar-width: none; }
        
        /* Mensagens e Formata√ß√£o */
        .msg-wrapper { display: flex; flex-direction: column; max-width: 85%; position: relative; gap: 8px; }
        .user-wrapper { align-self: flex-end; }
        .ai-wrapper { align-self: flex-start; }

        .msg { padding: 15px; border-radius: 18px; line-height: 1.6; border: 1px solid var(--border); position: relative; }
        .user-msg { background: #1f6feb; border: none; }
        .ai-msg { background: #161b22; }

        /* Estiliza√ß√£o de Markdown nas mensagens */
        .msg b { color: #60a5fa; font-weight: 800; }
        .msg h1, .msg h2, .msg h3 { color: var(--accent); font-weight: 800; margin: 10px 0; display: block; }
        .math-box { background: rgba(59, 130, 246, 0.1); border-left: 4px solid var(--accent); padding: 10px; margin: 10px 0; border-radius: 4px; font-family: 'serif'; font-style: italic; }

        /* BLOCO DE C√ìDIGO ADAPT√ÅVEL */
        .code-block { border-radius: 12px; overflow: hidden; margin: 15px 0; border: 1px solid var(--border); background: #000; }
        .code-header { padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); }
        .lang-tag { font-size: 10px; font-weight: 900; text-transform: uppercase; color: var(--accent); }
        .code-tools { display: flex; gap: 8px; }
        .c-btn { font-size: 10px; background: #21262d; padding: 4px 8px; border-radius: 4px; cursor: pointer; border: 1px solid var(--border); color: #8b949e; }
        .c-btn:hover { color: white; border-color: white; }
        pre { padding: 15px; margin: 0; font-family: 'Fira Code', monospace; font-size: 13px; overflow-x: auto; color: #d1d5db; }

        /* Controles de Mensagem */
        .msg-controls { display: flex; gap: 10px; opacity: 0; transition: 0.3s; padding: 0 10px; }
        .msg-wrapper:hover .msg-controls { opacity: 1; }
        .ctrl-btn { font-size: 11px; color: #8b949e; cursor: pointer; font-weight: bold; }
        .ctrl-btn:hover { color: var(--accent); }

        .synapse-glow { border: 1px solid var(--accent) !important; box-shadow: 0 0 10px rgba(59, 130, 246, 0.2); }
    </style>
</head>
<body>

    <aside class="sidebar p-4">
        <h2 class="text-[10px] font-bold text-gray-500 uppercase mb-4 tracking-widest">Hist√≥rico Local</h2>
        <div id="hist" class="flex-1 overflow-y-auto space-y-2"></div>
        <div class="mt-auto pt-4 border-t border-zinc-800 flex flex-col gap-2">
            <a href="https://zenia-projects.netlify.app" target="_blank" class="text-xs text-blue-400">üåê Zenia Projects</a>
            <a href="https://ia-zenia.netlify.app" target="_blank" class="text-xs text-blue-400">üåê IA-Z√©nia Web</a>
            <a href="https://antonia-ia.netlify.app" target="_blank" class="text-xs text-blue-400">üåê Ant√≥nia IA</a>
        </div>
    </aside>

    <main class="main-content">
        <header class="p-4 border-b border-zinc-800 flex justify-between items-center bg-black/20">
            <h1 class="text-xl font-black italic">IA-Z√âNIA <span class="text-blue-500 font-normal text-[10px] ml-2">LUBANGO v2.0</span></h1>
        </header>

        <div id="chatBox" class="chat-container"></div>

        <div class="p-4">
            <div class="max-w-5xl mx-auto bg-[#161b22] rounded-2xl p-2 synapse-glow flex items-end gap-2">
                <textarea id="userInput" placeholder="Digite sua d√∫vida de matem√°tica, f√≠sica ou pe√ßa um c√≥digo..." class="flex-1 bg-transparent border-none outline-none text-sm p-2 text-white h-12 max-h-48 resize-none" oninput="this.style.height='';this.style.height=this.scrollHeight+'px'"></textarea>
                <button onclick="handleSend()" class="bg-blue-600 hover:bg-blue-500 px-6 py-3 rounded-xl font-bold transition-all">ENVIAR</button>
            </div>
        </div>
    </main>

    <script>
        const chatBox = document.getElementById('chatBox');

        // Parser de Markdown e Embelezamento de Matem√°tica
        function parseZeniaContent(text) {
            let t = text.replace(/Support Pollinations.*/gs, "").replace(/Ant√≠nia/gi, "IA-Z√âNIA");
            // Negrito
            t = t.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            // T√≠tulos (#)
            t = t.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            t = t.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            t = t.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            // Blocos de Matem√°tica/Exerc√≠cios
            t = t.replace(/\[MATH\]([\s\S]*?)\[\/MATH\]/g, '<div class="math-box">$1</div>');
            return t.replace(/\n/g, '<br>');
        }

        async function handleSend(retryText = null) {
            const input = document.getElementById('userInput');
            const val = retryText || input.value.trim();
            if(!val) return;

            if(!retryText) addMessage(val, true);
            input.value = '';
            input.style.height = '48px';

            const loadingId = 'L' + Date.now();
            addMessage(`<div id="${loadingId}" class="animate-pulse">Z√©nia est√° resolvendo...</div>`, false);

            try {
                const sys = `Voc√™ √© IA-Z√âNIA do Lubango. Expert em Matem√°tica e F√≠sica. 
                Sempre embeleze resolu√ß√µes de exerc√≠cios usando [MATH] para f√≥rmulas.
                Para c√≥digos, use blocos markdown normais.`;
                
                const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(sys + "\n" + val)}?model=mistral&seed=${Math.random()}`);
                const responseText = await res.text();
                
                document.getElementById(loadingId).parentElement.parentElement.remove();
                processAIResponse(responseText, val);
            } catch(e) { document.getElementById(loadingId).innerText = "Erro na rede neural."; }
        }

        function processAIResponse(fullText, originalQuery) {
            const parts = fullText.split(/```/);
            const wrapper = document.createElement('div');
            wrapper.className = 'msg-wrapper ai-wrapper';
            
            parts.forEach((part, index) => {
                // Se o index for √≠mpar, √© um bloco de c√≥digo
                if(index % 2 !== 0) {
                    const lines = part.split('\n');
                    const lang = lines[0].trim() || 'code';
                    const code = lines.slice(1).join('\n').trim();
                    wrapper.appendChild(createCodeBlock(code, lang));
                } else {
                    if(part.trim()) {
                        const msgDiv = document.createElement('div');
                        msgDiv.className = 'msg ai-msg';
                        msgDiv.innerHTML = parseZeniaContent(part);
                        wrapper.appendChild(msgDiv);
                    }
                }
            });

            // Adiciona Controles de Mensagem
            const controls = document.createElement('div');
            controls.className = 'msg-controls';
            controls.innerHTML = `
                <span class="ctrl-btn" onclick="handleSend('${originalQuery.replace(/'/g, "\\'")}')">REENVIAR</span>
                <span class="ctrl-btn" onclick="this.closest('.msg-wrapper').remove()">ELIMINAR</span>
                <span class="ctrl-btn" onclick="alert('Obrigado pelo feedback!')">üëç</span>
                <span class="ctrl-btn" onclick="alert('Feedback anotado.')">üëé</span>
            `;
            wrapper.appendChild(controls);
            chatBox.appendChild(wrapper);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function createCodeBlock(code, lang) {
            const container = document.createElement('div');
            container.className = 'code-block';
            // Adaptar cor pela linguagem
            const colors = { html: '#ff5722', js: '#ffca28', javascript: '#ffca28', css: '#29b6f6', python: '#4caf50', shell: '#8b949e', bash: '#8b949e' };
            const accentColor = colors[lang.toLowerCase()] || '#3b82f6';
            
            container.innerHTML = `
                <div class="code-header" style="border-bottom: 2px solid ${accentColor}">
                    <span class="lang-tag" style="color: ${accentColor}">${lang}</span>
                    <div class="code-tools">
                        <button class="c-btn" onclick="copyCode(this)">COPIAR</button>
                        <button class="c-btn" onclick="saveCode('${lang}', this)">SALVAR</button>
                    </div>
                </div>
                <pre><code>${code.replace(/</g, '&lt;')}</code></pre>
            `;
            return container;
        }

        function addMessage(txt, isUser) {
            const w = document.createElement('div');
            w.className = `msg-wrapper ${isUser ? 'user-wrapper' : 'ai-wrapper'}`;
            w.innerHTML = `
                <div class="msg ${isUser ? 'user-msg' : 'ai-msg'}">${isUser ? txt : parseZeniaContent(txt)}</div>
                ${isUser ? '<span class="ctrl-btn self-end mr-2" onclick="editMsg(this)">EDITAR</span>' : ''}
            `;
            chatBox.appendChild(w);
            chatBox.scrollTop = chatBox.scrollHeight;
            return w;
        }

        function copyCode(btn) {
            const code = btn.closest('.code-block').querySelector('code').innerText;
            navigator.clipboard.writeText(code);
            btn.innerText = "COPIADO!";
            setTimeout(() => btn.innerText = "COPIAR", 2000);
        }

        function saveCode(lang, btn) {
            const code = btn.closest('.code-block').querySelector('code').innerText;
            const blob = new Blob([code], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `zenia_code.${lang || 'txt'}`;
            a.click();
        }

        function editMsg(btn) {
            const msgDiv = btn.parentElement.querySelector('.msg');
            const newVal = prompt("Editar mensagem:", msgDiv.innerText);
            if(newVal) msgDiv.innerText = newVal;
        }

        document.getElementById('userInput').addEventListener('keydown', (e) => {
            if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); }
        });
    </script>
</body>
</html>
