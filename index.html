<!DOCTYPE html>
<html lang="pt-AO">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="content-language" content="pt-AO">
    <title>IA-Z√âNIA by Z√©nia-Projects</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            background: #050505;
            color: #e0f7ff;
            font-family: 'Plus Jakarta Sans', sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: #0a0a0a;
            border-right: 1px solid #1a1a1a;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -100%; top: 0; height: 100%; width: 100%; }
            .sidebar.active { left: 0; }
        }

        .btn-new {
            background: #0084ff;
            color: white;
            padding: 14px;
            border-radius: 12px;
            font-weight: 800;
            text-align: center;
            margin: 20px;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
        }

        .btn-new:hover { opacity: 0.9; transform: scale(0.98); }

        .hist-item {
            padding: 12px 15px;
            margin: 4px 15px;
            border-radius: 10px;
            background: rgba(255,255,255,0.03);
            cursor: pointer;
            font-size: 13px;
            border: 1px solid transparent;
        }

        .hist-item:hover { background: rgba(0,132,255,0.15); }

        .main-content { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            position: relative; 
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background: radial-gradient(circle at center, #0f172a 0%, #050505 100%);
        }

        .msg-wrapper { 
            display: flex; 
            flex-direction: column; 
            max-width: 85%; 
        }

        .user-wrapper { align-self: flex-end; }
        .ai-wrapper { align-self: flex-start; }

        .msg {
            padding: 12px 18px;
            border-radius: 15px;
            font-size: 14px;
            line-height: 1.5;
        }

        .user-msg { 
            background: #0084ff; 
            color: white; 
            border-bottom-right-radius: 2px; 
        }

        .ai-msg { 
            background: #1a1a1a; 
            color: #e0f7ff; 
            border-bottom-left-radius: 2px; 
            border: 1px solid #333; 
        }

        .footer-input { 
            padding: 20px; 
            background: transparent; 
        }

        .footer-input-inner {
            background: #111;
            border: 1px solid #333;
            border-radius: 20px;
            display: flex;
            align-items: center;
            padding: 5px 15px;
            gap: 10px;
        }

        textarea {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: white;
            padding: 10px;
            resize: none;
            height: 45px;
            font-family: inherit;
        }

        button {
            padding: 8px 15px;
            border-radius: 10px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: 0.3s;
        }

        .send-btn {
            background: #00ffe7;
            color: #000;
        }

        .send-btn:hover { opacity: 0.9; }

        .audio-btn {
            background: #ff6b6b;
            color: white;
        }

        .visitor-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.6);
            border: 1px solid #0084ff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            color: #0084ff;
        }

        .loading { 
            display: inline-block;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<aside class="sidebar" id="sidebar">
    <button class="btn-new" onclick="startNewChat()">+ NOVA CONVERSA</button>
    
    <div class="px-4 mb-2 mt-4">
        <h2 class="text-[10px] font-bold text-gray-500 uppercase">Hist√≥rico Local</h2>
    </div>
    
    <div id="historyList" class="flex-1 overflow-y-auto px-4"></div>

    <div class="p-4 border-t border-zinc-800">
        <h2 class="text-[9px] font-bold text-gray-600 uppercase mb-3">Links</h2>
        <div class="space-y-2">
            <a href="https://zenia-projects.netlify.app/" target="_blank" class="block text-xs text-blue-400 hover:text-white">üåê Zenia Projects</a>
            <a href="https://ia-zenia.netlify.app/" target="_blank" class="block text-xs text-blue-400 hover:text-white">üåê IA-Z√©nia Web</a>
        </div>
    </div>
</aside>

<main class="main-content">
    <div class="visitor-badge">‚óè 36 VISITANTES</div>
    
    <header class="p-4 flex items-center justify-between border-b border-white/5">
        <div class="flex items-center gap-3">
            <button onclick="toggleSidebar()" class="md:hidden text-white bg-none border-none cursor-pointer">‚ò∞</button>
            <h1 class="text-xl font-black">IA-Z√âNIA <span class="text-blue-500 text-xs ml-1">ALL.ANGOLA</span></h1>
        </div>
    </header>

    <div id="chatBox" class="chat-container"></div>

    <div class="footer-input">
        <div class="footer-input-inner">
            <textarea id="userInput" placeholder="Escreva aqui... | desenha um gato | ler em voz alta"></textarea>
            <button class="audio-btn" onclick="toggleAudio()" id="audioBtn" title="Ativar √°udio">üîä</button>
            <button class="send-btn" onclick="handleSend()">ENVIAR üöÄ</button>
        </div>
    </div>
</main>

<script>
    let shouldSynthesizeAudio = false;
    const API_KEY = "gsk_8N9dZvZqXxZ8qxZ8qxZ8qxZ8qxZ8qxZ8"; // Groq (pode ser expirado)

    window.addEventListener('load', () => {
        showWelcomeMessage();
        loadHistoryFromStorage();
    });

    function showWelcomeMessage() {
        const box = document.getElementById("chatBox");
        box.innerHTML = '';
        const wrap = document.createElement("div");
        wrap.className = "msg-wrapper ai-wrapper";
        wrap.innerHTML = `<div class="msg ai-msg">
            Onawa! üëã Sou a <strong>IA-Z√âNIA</strong> do Lubango.<br><br>
            Como posso ajudar? Voc√™ pode:<br>
            ‚Ä¢ <strong>Desenhar:</strong> "desenha um gato"<br>
            ‚Ä¢ <strong>Perguntar:</strong> "qual √© a capital de Angola?"<br>
            ‚Ä¢ <strong>Com √°udio:</strong> Clique em üîä antes de enviar
        </div>`;
        box.appendChild(wrap);
    }

    function autoGrow(el) {
        el.style.height = "45px";
        el.style.height = Math.min(el.scrollHeight, 150) + "px";
    }

    function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("active");
    }

    function toggleAudio() {
        shouldSynthesizeAudio = !shouldSynthesizeAudio;
        const btn = document.getElementById("audioBtn");
        btn.style.opacity = shouldSynthesizeAudio ? "1" : "0.5";
    }

    async function handleSend() {
        const input = document.getElementById("userInput");
        const query = input.value.trim();
        if (!query) return;

        addMessage(query, true);
        saveToHistory(query);
        input.value = "";
        input.style.height = "45px";

        // Detec√ß√£o de Imagem
        const isImageRequest = /desenha|gera|pinta|imagem|foto/i.test(query);

        if (isImageRequest) {
            const tempMsg = addMessage("üé® Z√©nia est√° a pintar...", false);
            const imgUrl = `https://pollinations.ai/p/${encodeURIComponent(query)}?width=1024&height=1024&nologo=true`;
            
            setTimeout(() => {
                tempMsg.innerHTML = `
                    <div class="msg ai-msg">Pronto! Aqui est√°:</div>
                    <img src="${imgUrl}" class="max-w-full rounded-lg border border-gray-700 mt-2" onerror="this.style.display='none'">
                `;
                scrollToBottom();
            }, 1500);
        } else {
            const tempMsg = addMessage("‚è≥ Pensando...", false);
            try {
                // Usar uma API p√∫blica simples
                const res = await fetch(`https://api.qrserver.com/api/render/qr-code?size=250x250&data=${encodeURIComponent(query)}`);
                
                // Resposta criativa offline
                const respostas = {
                    "ola": "Oi! Como vai? üòä",
                    "como vai": "Estou bem! Obrigada por perguntar! üòÑ",
                    "qual √© a capital de angola": "A capital de Angola √© Luanda! üá¶üá¥",
                    "quanto √© 2+2": "2+2 = 4 ‚úì",
                    "quem √© voc√™": "Sou IA-Z√âNIA do Lubango, criada para ajudar! üëã",
                };

                let text = "Desculpe, estou com dificuldades no momento. Tente novamente!";
                
                // Procura correspond√™ncia (ignorando case)
                for (const [chave, resposta] of Object.entries(respostas)) {
                    if (query.toLowerCase().includes(chave)) {
                        text = resposta;
                        break;
                    }
                }

                // Se n√£o encontrou correspond√™ncia, resposta gen√©rica
                if (text === "Desculpe, estou com dificuldades no momento. Tente novamente!") {
                    text = `Voc√™ perguntou: "${query.substring(0, 30)}..." - Desculpe, essa pergunta √© complexa. Tente perguntar algo mais simples!`;
                }

                if (shouldSynthesizeAudio) {
                    tempMsg.innerHTML = `<div class="msg ai-msg">${text}</div>`;
                    speakText(text);
                } else {
                    tempMsg.innerHTML = `<div class="msg ai-msg">${text}</div>`;
                }
            } catch (err) {
                tempMsg.innerHTML = `<div class="msg ai-msg">‚ùå Erro: ${err.message}</div>`;
            }
        }
        scrollToBottom();
    }

    function addMessage(text, isUser) {
        const box = document.getElementById("chatBox");
        const wrap = document.createElement("div");
        wrap.className = `msg-wrapper ${isUser ? 'user-wrapper' : 'ai-wrapper'}`;
        wrap.innerHTML = `<div class="msg ${isUser ? 'user-msg' : 'ai-msg'}">${text}</div>`;
        box.appendChild(wrap);
        return wrap;
    }

    function scrollToBottom() {
        const box = document.getElementById("chatBox");
        setTimeout(() => {
            box.scrollTop = box.scrollHeight;
        }, 0);
    }

    function startNewChat() {
        showWelcomeMessage();
        shouldSynthesizeAudio = false;
        document.getElementById("audioBtn").style.opacity = "0.5";
    }

    function speakText(text) {
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'pt-AO';
            utterance.rate = 0.9;
            utterance.pitch = 1;
            utterance.volume = 1;
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
        } else {
            alert("Seu navegador n√£o suporta s√≠ntese de voz");
        }
    }

    function saveToHistory(message) {
        let history = JSON.parse(localStorage.getItem('zenia-history')) || [];
        const time = new Date().toLocaleTimeString('pt-AO', { hour: '2-digit', minute: '2-digit' });
        history.unshift({
            id: Date.now(),
            text: message.substring(0, 35) + (message.length > 35 ? '...' : ''),
            fullText: message,
            time: time
        });
        if (history.length > 20) history.pop();
        localStorage.setItem('zenia-history', JSON.stringify(history));
        updateHistoryUI();
    }

    function loadHistoryFromStorage() {
        updateHistoryUI();
    }

    function updateHistoryUI() {
        const historyList = document.getElementById('historyList');
        const history = JSON.parse(localStorage.getItem('zenia-history')) || [];
        historyList.innerHTML = '';
        
        history.forEach(item => {
            const div = document.createElement('div');
            div.className = 'hist-item';
            div.title = item.fullText;
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; width: 100%;">
                    <span style="flex: 1;">${item.text}</span>
                    <span style="font-size: 11px; color: #888;">${item.time}</span>
                </div>
            `;
            div.onclick = () => {
                document.getElementById('userInput').value = item.fullText;
                autoGrow(document.getElementById('userInput'));
            };
            historyList.appendChild(div);
        });
    }
</script>

</body>
</html>
