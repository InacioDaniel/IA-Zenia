<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA-ZÉNIA EM ATUALIZAÇÃO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --zenia-cyan: #00f2ff; --bg-dark: #050a15; }
        body { background: var(--bg-dark); color: white; font-family: 'Segoe UI', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(0, 242, 255, 0.1); }
        .ia-msg { border-left: 3px solid var(--zenia-cyan); background: linear-gradient(90deg, rgba(0,242,255,0.05) 0%, transparent 100%); }
        .user-img { max-width: 200px; border-radius: 10px; border: 1px solid var(--zenia-cyan); margin-bottom: 10px; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--zenia-cyan); border-radius: 10px; }
    </style>
</head>
<body class="h-screen flex flex-col">

    <header class="p-4 glass flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 bg-cyan-500 rounded-full animate-pulse"></div>
            <h1 class="font-bold tracking-widest text-xl">IA-ZÉNIA</h1>
        </div>
        <select id="model-select" class="bg-black/50 text-xs border border-cyan-500/50 p-2 rounded-lg outline-none">
            <option value="mistral">ZENIA-LLM-1 (Mistral)</option>
            <option value="openai">ZENIA-LLM-2 (OpenAI)</option>
        </select>
    </header>

    <main id="chat-window" class="flex-1 overflow-y-auto p-4 space-y-6"></main>

    <div id="image-preview-container" class="px-4 hidden">
        <div class="relative inline-block">
            <img id="image-preview" class="h-20 w-20 object-cover rounded-lg border border-cyan-500">
            <button onclick="clearImage()" class="absolute -top-2 -right-2 bg-red-500 rounded-full w-5 h-5 text-[10px]">X</button>
        </div>
    </div>

    <footer class="p-4 glass m-4 rounded-2xl">
        <div class="flex items-end gap-3">
            <label class="cursor-pointer p-3 hover:text-cyan-400 transition">
                <i class="fas fa-paperclip"></i>
                <input type="file" id="file-input" accept="image/*" class="hidden" onchange="previewImage(this)">
            </label>
            
            <textarea id="user-input" rows="1" class="flex-1 bg-transparent border-none outline-none py-3 resize-none" placeholder="Pergunte, gere imagens ou áudio..."></textarea>
            
            <button id="mic-btn" onclick="toggleMic()" class="p-3 hover:text-cyan-400 transition">
                <i class="fas fa-microphone"></i>
            </button>
            
            <button onclick="processInput()" class="bg-cyan-600 hover:bg-cyan-500 text-black px-6 py-3 rounded-xl font-bold transition">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </footer>

    <script>
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const modelSelect = document.getElementById('model-select');
        let selectedImageBase64 = null;

        // --- RECONHECIMENTO DE VOZ ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = SpeechRecognition ? new SpeechRecognition() : null;
        if(recognition) {
            recognition.lang = 'pt-PT';
            recognition.onresult = (event) => {
                userInput.value = event.results[0][0].transcript;
                processInput();
            };
        }

        function toggleMic() {
            if(!recognition) return alert("Voz não suportada neste navegador.");
            recognition.start();
            document.getElementById('mic-btn').classList.add('text-red-500');
            setTimeout(() => document.getElementById('mic-btn').classList.remove('text-red-500'), 3000);
        }

        // --- GESTÃO DE IMAGENS ---
        function previewImage(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    selectedImageBase64 = e.target.result;
                    document.getElementById('image-preview').src = selectedImageBase64;
                    document.getElementById('image-preview-container').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function clearImage() {
            selectedImageBase64 = null;
            document.getElementById('image-preview-container').classList.add('hidden');
            document.getElementById('file-input').value = "";
        }

        // --- MOTOR DE PROCESSAMENTO ---
        async function processInput() {
            const prompt = userInput.value.trim();
            if (!prompt && !selectedImageBase64) return;

            addMessage('user', prompt, selectedImageBase64);
            userInput.value = "";
            const zeniaMsg = addMessage('ia', '<i class="fas fa-circle-notch animate-spin"></i> Processando...');

            // Lógica: Se o prompt pedir imagem
            const promptLower = prompt.toLowerCase();
            if (promptLower.includes("gere uma imagem") || promptLower.includes("desenha") || promptLower.includes("image of")) {
                generateImage(prompt, zeniaMsg);
            } 
            // Lógica: Se houver imagem, é análise (Vision)
            else if (selectedImageBase64) {
                analyzeImage(prompt, selectedImageBase64, zeniaMsg);
            }
            // Lógica: Texto padrão
            else {
                generateText(prompt, zeniaMsg);
            }
            clearImage();
        }

        async function generateText(prompt, msgElement) {
            const model = modelSelect.value;
            try {
                const seed = Math.floor(Math.random() * 1000);
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(prompt)}?model=${model}&seed=${seed}`);
                const text = await response.text();
                msgElement.innerHTML = text;
                // Opção de áudio automática se quiseres: speak(text);
            } catch (e) {
                msgElement.innerText = "Erro nos motores. Tente novamente.";
            }
        }

        async function generateImage(prompt, msgElement) {
            const seed = Math.floor(Math.random() * 99999);
            const imageUrl = `https://pollinations.ai/p/${encodeURIComponent(prompt)}?width=1024&height=1024&seed=${seed}&nologo=true`;
            msgElement.innerHTML = `
                <p class="mb-2">Gerando sua visão artística...</p>
                <img src="${imageUrl}" class="rounded-lg border border-cyan-500 shadow-lg shadow-cyan-500/20" onload="window.scrollTo(0,document.body.scrollHeight)">
                <a href="${imageUrl}" target="_blank" class="text-[10px] text-cyan-400 mt-2 block italic">Link da Imagem HD</a>
            `;
        }

        async function analyzeImage(prompt, base64, msgElement) {
            msgElement.innerText = "Analisando imagem via ZENIA-VISION...";
            // Pollinations suporta envio de imagem via prompt URL em alguns modelos ou via custom endpoint
            // Aqui usamos o fallback de descrição via prompt para simular a análise em motores públicos
            generateText(`Descreva esta imagem detalhadamente (Contexto: ${prompt})`, msgElement);
        }

        function addMessage(role, text, imgData = null) {
            const div = document.createElement('div');
            div.className = `flex flex-col ${role === 'user' ? 'items-end' : 'items-start'}`;
            
            let content = '';
            if (imgData) content += `<img src="${imgData}" class="user-img">`;
            content += `<div class="msg p-4 rounded-2xl max-w-[85%] ${role === 'user' ? 'bg-cyan-600 text-black font-semibold' : 'ia-msg'}">${text}</div>`;
            
            div.innerHTML = content;
            chatWindow.appendChild(div);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            return div.querySelector('.msg');
        }

        // --- SÍNTESE DE VOZ (RESPOSTA) ---
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'pt-PT';
            window.speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
