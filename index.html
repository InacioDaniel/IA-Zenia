// ========== GERA√á√ÉO DE V√çDEOS KIE.AI ==========
async function handleGenerateVideoKie() {
  const prompt = document.getElementById("videoPrompt").value.trim();
  if (!prompt) return;

  const resultDiv = document.getElementById("videoResult");
  const statusDiv = document.getElementById("videoStatus");
  resultDiv.innerHTML = "";
  statusDiv.innerHTML = '<span class="loading">‚è≥</span> Gerando seu v√≠deo com Kie.ai...';

  try {
    setStatus("üé¨ Gerando v√≠deo com Kie.ai...", 30);

    const response = await fetch("https://api.kie.ai/v1/video/generations", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer demo"
      },
      body: JSON.stringify({
        prompt: prompt,
        model: "flux-pro-video",
        duration: 5,
        fps: 24
      })
    }).then(r => r.json());

    if (response?.data?.[0]?.url) {
      const url = response.data[0].url;
      resultDiv.innerHTML = `
        <div style="text-align:center">
          <video width="100%" controls style="border-radius:8px;border:1px solid rgba(124,58,237,0.3)">
            <source src="${url}" type="video/mp4">
          </video>
          <p style="font-size:12px;color:var(--muted);margin-top:8px">Prompt: <strong>${prompt}</strong></p>
          <button onclick="window.open('${url}');" style="margin-top:8px">üíæ Baixar</button>
        </div>
      `;
      statusDiv.innerHTML = "‚úÖ V√≠deo criado com sucesso!";
      setStatus("‚úì V√≠deo gerado!", 100);
      return;
    }

    throw new Error("API indispon√≠vel");
  } catch(err) {
    console.error(err);
    resultDiv.innerHTML = `<div style="background:rgba(239,68,68,0.15);padding:12px;border-radius:8px;border-left:3px solid #ef4444">
      <p style="color:#fca5a5;margin:0;font-size:12px"><strong>‚ùå Erro:</strong> APIs de v√≠deo Kie.ai indispon√≠veis</p>
    </div>`;
    statusDiv.innerHTML = "‚ùå Falha na gera√ß√£o";
    setStatus("Erro ao gerar v√≠deo", 0);
  }
}

// ========== GERA√á√ÉO DE M√öSICA KIE.AI ==========
async function handleGenerateMusic() {
  const prompt = document.getElementById("musicPrompt").value.trim();
  if (!prompt) return;

  const resultDiv = document.getElementById("musicResult");
  const statusDiv = document.getElementById("musicStatus");
  resultDiv.innerHTML = "";
  statusDiv.innerHTML = '<span class="loading">‚è≥</span> Gerando m√∫sica com Kie.ai...';

  try {
    setStatus("üéµ Gerando m√∫sica com Kie.ai...", 30);

    const response = await fetch("https://api.kie.ai/v1/audio/generations", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer demo"
      },
      body: JSON.stringify({
        prompt: prompt,
        model: "flux-pro-audio",
        duration: 15 // dura√ß√£o em segundos
      })
    }).then(r => r.json());

    if (response?.data?.[0]?.url) {
      const url = response.data[0].url;
      resultDiv.innerHTML = `
        <div style="text-align:center">
          <audio controls style="width:100%;margin-top:8px">
            <source src="${url}" type="audio/mpeg">
            Seu navegador n√£o suporta √°udio.
          </audio>
          <p style="font-size:12px;color:var(--muted);margin-top:8px">Prompt: <strong>${prompt}</strong></p>
          <button onclick="window.open('${url}');" style="margin-top:8px">üíæ Baixar M√∫sica</button>
        </div>
      `;
      statusDiv.innerHTML = "‚úÖ M√∫sica criada com sucesso!";
      setStatus("‚úì M√∫sica gerada!", 100);
      return;
    }

    throw new Error("API indispon√≠vel");
  } catch(err) {
    console.error(err);
    resultDiv.innerHTML = `<div style="background:rgba(239,68,68,0.15);padding:12px;border-radius:8px;border-left:3px solid #ef4444">
      <p style="color:#fca5a5;margin:0;font-size:12px"><strong>‚ùå Erro:</strong> APIs de m√∫sica Kie.ai indispon√≠veis</p>
    </div>`;
    statusDiv.innerHTML = "‚ùå Falha na gera√ß√£o";
    setStatus("Erro ao gerar m√∫sica", 0);
  }
}

// ========== CHAT COM KIE.AI ==========
async function handleChatKie(prompt) {
  if (!prompt) return "‚ùå Prompt vazio";

  try {
    const response = await fetch("https://api.kie.ai/v1/text/generations", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer demo"
      },
      body: JSON.stringify({
        prompt: prompt,
        model: "flux-pro-chat",
        max_tokens: 300
      })
    }).then(r => r.json());

    if (response?.data?.[0]?.text) {
      return response.data[0].text;
    }
  } catch(e) {
    console.error(e);
  }
  return "‚ùå Erro ao conectar com Kie.ai";
}

// Sobrescreve fun√ß√£o de chat para usar Kie.ai
async function generateIntelligentResponse(userText) {
  const response = await handleChatKie(userText);
  return response;
}

// BOT√ïES NOVOS
document.getElementById("generateMusicBtn").addEventListener("click", handleGenerateMusic);
document.getElementById("generateVideoBtn").addEventListener("click", handleGenerateVideoKie);
