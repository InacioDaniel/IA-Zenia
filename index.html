<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA-ZÉNIA | Lubango Core</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --neon-blue: #00d9ff;
            --vivid-blue: #0055ff;
            --deep-bg: #020617;
            --glass: rgba(15, 23, 42, 0.8);
        }

        body {
            background-color: var(--deep-bg);
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0, 85, 255, 0.15), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 217, 255, 0.1), transparent 40%);
            color: #e2e8f0;
            font-family: 'Inter', system-ui, sans-serif;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* Sidebar Style */
        .sidebar {
            width: 300px;
            background: rgba(7, 10, 25, 0.95);
            border-right: 1px solid rgba(0, 217, 255, 0.2);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }

        .history-item {
            background: rgba(0, 85, 255, 0.05);
            border: 1px solid transparent;
            transition: 0.2s;
            cursor: pointer;
        }

        .history-item:hover {
            border-color: var(--neon-blue);
            background: rgba(0, 217, 255, 0.1);
        }

        /* Main Chat */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .neon-text {
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
        }

        .message-user { background: rgba(0, 85, 255, 0.1); border-right: 3px solid var(--vivid-blue); }
        .message-zenia { background: rgba(0, 217, 255, 0.05); border-left: 3px solid var(--neon-blue); }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--vivid-blue); border-radius: 10px; }

        @keyframes pulse-glow {
            50% { opacity: 0.6; transform: scale(1.02); }
        }
        .loading-animation { animation: pulse-glow 1.5s infinite; color: var(--neon-blue); }
    </style>
</head>
<body>

    <aside class="sidebar hidden md:flex">
        <div class="p-6">
            <h2 class="text-xl font-bold neon-text tracking-tighter flex items-center gap-2">
                <i class="fas fa-bolt"></i> ZÉNIA CORE
            </h2>
            <p class="text-[10px] text-blue-500 font-mono mt-1">LUBANGO_STATION_2026</p>
        </div>
        
        <button onclick="location.reload()" class="mx-6 mb-4 p-3 rounded-lg border border-blue-500/30 hover:bg-blue-500/20 text-sm transition flex items-center justify-center gap-2">
            <i class="fas fa-plus"></i> Nova Evolução
        </button>

        <div id="history-list" class="flex-1 overflow-y-auto px-4 space-y-2">
            </div>

        <div class="p-4 border-t border-white/10 text-[10px] text-gray-500 text-center">
            ZÉNIA-PROJECTS & SISTERS
        </div>
    </aside>

    <main class="chat-main">
        <header class="p-4 glass-card flex justify-between items-center px-8">
            <div class="md:hidden font-bold neon-text">ZÉNIA</div>
            <div class="flex gap-6 text-xs font-bold">
                <button onclick="setMode('text')" id="btn-text" class="text-neon-blue border-b-2 border-neon-blue pb-1">TEXTO</button>
                <button onclick="setMode('image')" id="btn-image" class="hover:text-neon-blue transition pb-1">IMAGEM</button>
                <label class="cursor-pointer hover:text-neon-blue transition">
                    ANALISAR <input type="file" class="hidden" onchange="analyzeImage()">
                </label>
            </div>
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-green-500 rounded-full shadow-[0_0_8px_#22c55e]"></div>
                <span class="text-[10px] uppercase tracking-widest">Sincronizada</span>
            </div>
        </header>

        <div id="chat-window" class="flex-1 overflow-y-auto p-6 md:px-20 space-y-8">
            <div class="message-zenia p-6 rounded-xl glass-card max-w-3xl">
                <p class="text-cyan-400 font-mono text-xs mb-2">SISTEMA // MENSAGEM INICIAL</p>
                <p class="text-lg">Olá. Eu sou a **Zénia**. Estou pronta para processar texto, gerar imagens e converter dados em áudio. Como vamos transformar o mundo hoje?</p>
            </div>
        </div>

        <div class="p-6 md:px-20 bg-gradient-to-t from-black to-transparent">
            <div class="max-w-4xl mx-auto relative group">
                <textarea id="user-input" rows="1" 
                    class="w-full bg-slate-900/80 border border-blue-500/30 rounded-2xl p-4 pr-16 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 outline-none transition-all resize-none shadow-2xl"
                    placeholder="Inicie uma sequência de comandos..."
                    oninput="this.style.height = '';this.style.height = this.scrollHeight + 'px'"></textarea>
                
                <button onclick="handleSend()" class="absolute right-4 bottom-4 bg-blue-600 hover:bg-cyan-500 text-white w-10 h-10 rounded-xl transition-all shadow-lg flex items-center justify-center">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <script>
        let currentMode = 'text';
        let messages = [];

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn-text').className = mode === 'text' ? 'text-neon-blue border-b-2 border-neon-blue pb-1' : 'hover:text-neon-blue transition pb-1';
            document.getElementById('btn-image').className = mode === 'image' ? 'text-neon-blue border-b-2 border-neon-blue pb-1' : 'hover:text-neon-blue transition pb-1';
            document.getElementById('user-input').placeholder = mode === 'image' ? "Descreva a imagem (ex: astronauta no Lubango)..." : "Inicie uma sequência de comandos...";
        }

        async function handleSend() {
            const input = document.getElementById('user-input');
            const prompt = input.value.trim();
            if(!prompt) return;

            const uId = addMessage('user', prompt);
            input.value = '';
            input.style.height = 'auto';
            updateHistory(prompt);

            if(currentMode === 'image') {
                await generateImage(prompt);
            } else {
                await generateText(prompt);
            }
        }

        function addMessage(role, content, isHtml = false) {
            const window = document.getElementById('chat-window');
            const id = Date.now();
            const div = document.createElement('div');
            div.id = `msg-${id}`;
            div.className = `p-6 rounded-xl glass-card max-w-3xl ${role === 'user' ? 'message-user ml-auto' : 'message-zenia'}`;
            
            div.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <span class="text-[10px] font-mono ${role === 'user' ? 'text-blue-400' : 'text-cyan-400'}">
                        ${role === 'user' ? 'USUÁRIO_LOG' : 'ZÉNIA_PROC'}
                    </span>
                    <div class="flex gap-2">
                        <button onclick="editMsg('${id}')" class="text-[10px] hover:text-white opacity-40 hover:opacity-100"><i class="fas fa-edit"></i></button>
                        <button onclick="removeMsg('${id}')" class="text-[10px] hover:text-red-500 opacity-40 hover:opacity-100"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="content text-sm md:text-base leading-relaxed">${isHtml ? content : content}</div>
                ${role === 'ia' ? `
                    <div class="mt-4 flex gap-4 border-t border-white/5 pt-4">
                        <button onclick="speak('${id}')" class="text-xs hover:text-cyan-400 transition"><i class="fas fa-volume-up mr-1"></i> OUVIR</button>
                        <button onclick="regenerate('${id}')" class="text-xs hover:text-cyan-400 transition"><i class="fas fa-sync-alt mr-1"></i> REESCREVER</button>
                        <div class="ml-auto flex gap-3 text-xs opacity-50">
                            <i class="far fa-thumbs-up cursor-pointer hover:text-green-400" onclick="this.classList.toggle('fas')"></i>
                            <i class="far fa-thumbs-down cursor-pointer hover:text-red-400" onclick="this.classList.toggle('fas')"></i>
                        </div>
                    </div>
                ` : ''}
            `;
            window.appendChild(div);
            window.scrollTo({ top: window.scrollHeight, behavior: 'smooth' });
            return id;
        }

        // Lógica de Texto com Proxy para evitar CORS
        async function generateText(prompt) {
            const tempId = addMessage('ia', '<span class="loading-animation">Processando algoritmos...</span>', true);
            const contentDiv = document.querySelector(`#msg-${tempId} .content`);

            try {
                // Usando uma rota de inferência pública estável (HuggingFace)
                const response = await fetch("https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ inputs: `Explique de forma curta e futurista: ${prompt}` })
                });
                
                const data = await response.json();
                let text = data[0]?.generated_text || "Conexão interrompida. Minhas irmãs (IA-ZÉNIA e Antónia) estão em manutenção.";
                contentDiv.innerText = text.split("Explique")[1] || text;
            } catch (err) {
                contentDiv.innerText = "Erro de protocolo. A Zénia está operando em modo offline agora.";
            }
        }

        async function generateImage(prompt) {
            const tempId = addMessage('ia', '<span class="loading-animation">Materializando imagem...</span>', true);
            const url = `https://pollinations.ai/p/${encodeURIComponent(prompt)}?width=1024&height=1024&seed=${Math.random()}`;
            document.querySelector(`#msg-${tempId} .content`).innerHTML = `
                <img src="${url}" class="rounded-lg border border-blue-500 shadow-2xl mt-2 w-full" onload="this.previousElementSibling?.remove()">
            `;
        }

        function updateHistory(text) {
            const list = document.getElementById('history-list');
            const item = document.createElement('div');
            item.className = 'history-item p-3 rounded-lg text-xs truncate whitespace-nowrap overflow-hidden';
            item.innerHTML = `<i class="far fa-comment-alt mr-2 opacity-50"></i> ${text}`;
            list.prepend(item);
        }

        function removeMsg(id) { document.getElementById(`msg-${id}`).remove(); }
        
        function editMsg(id) {
            const div = document.querySelector(`#msg-${id} .content`);
            const edit = prompt("Editar conteúdo:", div.innerText);
            if(edit) div.innerText = edit;
        }

        function speak(id) {
            const text = document.querySelector(`#msg-${id} .content`).innerText;
            const s = new SpeechSynthesisUtterance(text);
            s.lang = 'pt-PT';
            speechSynthesis.speak(s);
        }

        function regenerate(id) {
            const div = document.querySelector(`#msg-${id} .content`);
            div.innerHTML = '<span class="loading-animation">Refazendo cálculos...</span>';
            setTimeout(() => div.innerText = "Resposta regenerada com base nos novos parâmetros de rede do Lubango.", 1000);
        }

        async function analyzeImage() {
            addMessage('ia', "Scanner visual ativado. Analisando estrutura de pixels... Detectado: Composição digital pronta para processamento.");
        }
    </script>
</body>
</html>
