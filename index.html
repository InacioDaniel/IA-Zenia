<!DOCTYPE html>
<html lang="pt-AO">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>IA-ZÃ©nia | Lubango Edition</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root {
    --accent: #00eaff;        
    --accent-alt: #0066ff;    
    --bg: #020617;             
    --panel: #0b1124;          
    --border: #1e3a8a;        
    --text-light: #e0f2fe;    
    --neon-glow: 0 0 20px rgba(0, 234, 255, 0.4);
}

body { 
    background: radial-gradient(circle at top right, #0b1124, #020617);
    color: var(--text-light); 
    font-family: 'Plus Jakarta Sans', sans-serif; 
    margin: 0; height: 100vh; display: flex; overflow: hidden; 
}

/* Scrollbar Custom */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

/* Sidebar Futurista */
.sidebar { 
    width: 280px; 
    background: rgba(11, 17, 36, 0.95);
    backdrop-filter: blur(10px);
    border-right: 1px solid var(--border); 
    display: flex; flex-direction: column; transition: .4s cubic-bezier(0.4, 0, 0.2, 1); 
    z-index: 100;
}

.main-content { flex:1; display:flex; flex-direction:column; overflow:hidden; position: relative; }

/* Chat Bubbles */
.chat-container { 
    flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 24px;
}

.msg-wrapper { display:flex; flex-direction:column; max-width:85%; gap:8px; animation: slideUp 0.4s ease-out; }
.ai-wrapper { align-self: flex-start; }
.user-wrapper { align-self: flex-end; }

.msg { 
    padding: 16px 20px; border-radius: 22px; line-height: 1.6; font-size: 14.5px; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.ai-msg { 
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid var(--border);
    border-left: 4px solid var(--accent);
    color: #f8fafc;
}

.user-msg { 
    background: linear-gradient(135deg, var(--accent-alt), #0044cc);
    color: white; border-bottom-right-radius: 4px;
}

/* Input Area Refinada */
.footer-input-inner {
    max-width: 900px; margin: 0 auto;
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid var(--border);
    border-radius: 24px; padding: 10px;
    box-shadow: 0 -10px 25px rgba(0,0,0,0.3);
}

textarea {
    background: transparent; border: none; outline: none; color: white;
    resize: none; padding: 10px; width: 100%; font-size: 15px;
}

.action-btn {
    width: 45px; height: 45px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    transition: 0.3s;
}

.send-btn { background: var(--accent); color: #000; font-weight: bold; }
.send-btn:hover { transform: scale(1.1); box-shadow: var(--neon-glow); }

/* AnimaÃ§Ãµes */
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

.art-img { border-radius: 15px; border: 1px solid var(--accent); margin-top: 10px; max-width: 100%; box-shadow: var(--neon-glow); }
</style>
</head>
<body>

<aside class="sidebar p-5" id="sidebar">
    <div class="mb-8">
        <h1 class="text-2xl font-extrabold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent italic">IA-ZÃ‰NIA</h1>
        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Lubango Creative Labs</p>
    </div>
    
    <button class="btn-new bg-blue-600 hover:bg-blue-500 p-3 rounded-xl font-bold transition-all mb-6" onclick="window.startNewChat()">+ NOVA SESSÃƒO</button>
    
    <div id="historyList" class="flex-1 overflow-y-auto space-y-2"></div>
    
    <div class="pt-4 border-t border-slate-800">
        <p class="text-[11px] text-slate-400">IrmÃ£s: zenia-projects, ia-zenia, antonia-ia</p>
    </div>
</aside>

<main class="main-content">
    <header class="p-4 border-b border-white/5 flex justify-between items-center bg-black/20 backdrop-blur-md">
        <button onclick="window.toggleSidebar()" class="p-2 hover:bg-white/10 rounded-lg">â˜°</button>
        <div class="flex items-center gap-2">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
            <span class="text-xs font-mono text-cyan-400">SERVER: SAURAV-Z/FREE-GEN</span>
        </div>
    </header>

    <div id="chatBox" class="chat-container"></div>

    <div class="p-4 bg-gradient-to-t from-bg to-transparent">
        <div class="footer-input-inner">
            <div class="flex items-center gap-2 border-b border-white/5 mb-2 pb-2 px-2">
                <select id="voiceSelect" class="bg-transparent text-[11px] text-cyan-400 outline-none">
                    <option value="nova">Voz Nova</option>
                    <option value="alloy">Alloy</option>
                    <option value="native">Nativa (PT-AO)</option>
                </select>
                <input type="file" id="imgUpload" hidden>
                <button onclick="document.getElementById('imgUpload').click()" class="text-xs text-slate-400 hover:text-white transition">ðŸ“Ž ANEXAR IMAGEM</button>
            </div>
            <div class="flex items-end gap-2">
                <textarea id="userInput" placeholder="Escreve para a ZÃ©nia..." rows="1" oninput="this.style.height='';this.style.height=this.scrollHeight+'px'"></textarea>
                <button class="action-btn send-btn" onclick="window.handleSend()">ðŸš€</button>
            </div>
        </div>
    </div>
</main>

<script type="module">
import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.16.0';
env.allowLocalModels = false;
env.useBrowserCache = true;

let visionPipeline = null;
const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');
let sessions = JSON.parse(localStorage.getItem('zenia_sessions')||'[]');
let currentSessionId = Date.now();

// EXPOR FUNÃ‡Ã•ES
window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('-translate-x-full');
window.startNewChat = () => { 
    currentSessionId = Date.now(); 
    chatBox.innerHTML = ''; 
    addMessage("OlÃ¡! Sou a IA-ZÃ‰NIA de Lubango. Como posso ajudar hoje?", false); 
};

// --- CORE: CHAMADA AO MODELO SAURAV-Z ---
async function fetchAIResponse(prompt) {
    try {
        // Usando a API solicitada
        const response = await fetch(`https://free-text-generation-api.vercel.app/api/generate`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                prompt: prompt,
                model: "gpt-3.5-turbo" // O endpoint costuma aceitar o nome do modelo desejado
            })
        });
        const data = await response.json();
        return data.result || data.text || "NÃ£o consegui processar o pensamento agora.";
    } catch (err) {
        // Fallback para Pollinations Mistral se a API falhar
        const res = await fetch('https://text.pollinations.ai/'+encodeURIComponent(prompt)+'?model=mistral');
        return await res.text();
    }
}

async function handleSend(textOverride) {
    const text = (textOverride || userInput.value).trim();
    if(!text) return;

    if(!textOverride) {
        addMessage(text, true);
        userInput.value = '';
    }

    const loader = addMessage("<span class='animate-pulse'>ZÃ©nia estÃ¡ a processar...</span>", false);

    const context = `VocÃª Ã© IA-ZÃ‰NIA, criada em Lubango. Responda em PortuguÃªs de Angola. Contexto: ${text}`;
    const responseText = await fetchAIResponse(context);
    
    loader.remove();
    addMessage(responseText, false);
}

function addMessage(content, isUser) {
    const wrapper = document.createElement('div');
    wrapper.className = `msg-wrapper ${isUser ? 'user-wrapper' : 'ai-wrapper'}`;
    
    // FormataÃ§Ã£o bÃ¡sica de negrito e quebra de linha
    const formatted = content.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
    
    wrapper.innerHTML = `<div class="msg ${isUser ? 'user-msg' : 'ai-msg'}">${formatted}</div>`;
    chatBox.appendChild(wrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
    return wrapper;
}

// LÃ³gica de VisÃ£o (Simplificada do seu original)
document.getElementById('imgUpload').addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if(!file) return;
    
    const reader = new FileReader();
    reader.onload = async (event) => {
        addMessage(`ðŸ“Ž Analisando imagem...<br><img src="${event.target.result}" class="art-img">`, true);
        if(!visionPipeline) visionPipeline = await pipeline('image-to-text', 'Xenova/vit-gpt2-image-captioning');
        const output = await visionPipeline(event.target.result);
        handleSend(`[VISÃƒO]: Eu vejo nesta imagem: ${output[0].generated_text}. Comenta sobre isso em portuguÃªs.`);
    };
    reader.readAsDataURL(file);
});

window.startNewChat();
</script>
</body>
</html>
