<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zenia IA - InteligÃªncia AutÃ´noma</title>
  <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75' fill='%237c3aed'>ğŸ§ </text></svg>" type="image/x-icon">
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.17.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    :root{
      --bg:#0f172a; 
      --card:#102235; 
      --accent1:#7c3aed; 
      --accent2:#06b6d4;
      --text:#e6eef8; 
      --muted:#94a3b8;
    }

    * {
      box-sizing:border-box;
    }

    body{
      font-family:'Segoe UI',system-ui,Arial;
      margin:0;
      background:var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width:1400px;
      margin:18px auto;
      display:grid;
      grid-template-columns:320px 1fr;
      gap:16px;
      padding:0 16px;
    }
    
    .card{
      background:var(--card);
      border-radius:12px;
      padding:16px;
      border:1px solid rgba(255,255,255,0.06);
    }
    
    .logo{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:16px;
    }
    
    .logo-icon{
      width:48px;
      height:48px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:24px;
      background:linear-gradient(135deg,var(--accent1),#764ba2);
    }
    
    .small{
      font-size:12px;
      color:var(--muted);
      line-height:1.5;
    }
    
    .controls{
      display:flex;
      gap:8px;
      align-items:flex-end;
      margin-bottom:12px;
      flex-wrap:wrap;
    }
    
    #chatArea{
      height:calc(100vh - 350px);
      min-height:400px;
      overflow-y:auto;
      padding:12px;
      background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);
      border-radius:8px;
      margin-bottom:12px;
    }
    
    .msg{
      padding:12px;
      margin:8px 0;
      border-radius:10px;
      max-width:88%;
      word-wrap:break-word;
      line-height:1.6;
    }
    
    .msg.user{
      background:rgba(125,179,255,0.12);
      color:#e6eef8;
      margin-left:auto;
      margin-right:0;
    }
    
    .msg.zenia{
      background:rgba(255,255,255,0.06);
      margin-right:auto;
      margin-left:0;
    }

    .msg.thinking {
      background:rgba(6,182,212,0.15);
      border-left:3px solid var(--accent2);
      color:var(--accent2);
      font-style:italic;
    }

    .msg.error {
      background:rgba(239,68,68,0.15);
      border-left:3px solid #ef4444;
      color:#fca5a5;
    }

    .msg img, .msg video {
      max-width:100%;
      border-radius:8px;
      margin-top:8px;
    }
    
    input[type="text"], input[type="file"], textarea, select {
      padding:10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.12);
      background:transparent;
      color:var(--text);
      font-family:inherit;
      font-size:13px;
    }

    textarea {
      flex:1;
      min-height:50px;
      resize:vertical;
      max-height:120px;
    }
    
    input[type="text"]::placeholder, textarea::placeholder {
      color:var(--muted);
    }
    
    button{
      padding:10px 16px;
      border-radius:8px;
      border:none;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      color:white;
      cursor:pointer;
      font-size:13px;
      font-weight:600;
      white-space:nowrap;
      transition:all 0.2s;
    }
    
    button:hover {
      opacity:0.9;
      transform:scale(1.02);
    }

    button:disabled {
      opacity:0.5;
      cursor:not-allowed;
      transform:scale(1);
    }
    
    #status {
      font-size:12px;
      color:var(--muted);
      margin-top:8px;
      min-height:20px;
    }

    .loading {
      display:inline-block;
      animation:spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform:rotate(0deg); }
      to { transform:rotate(360deg); }
    }
    
    .progress{
      height:6px;
      background:#0b1320;
      border-radius:999px;
      overflow:hidden;
      margin-top:6px;
    }
    
    .progress > i{
      display:block;
      height:100%;
      width:0%;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      transition:width .3s;
    }

    .tabs {
      display:flex;
      gap:6px;
      margin-bottom:12px;
      border-bottom:1px solid rgba(255,255,255,0.12);
      padding-bottom:8px;
      flex-wrap:wrap;
    }

    .tab-btn {
      background:none;
      border:none;
      color:var(--muted);
      cursor:pointer;
      padding:6px 12px;
      font-size:12px;
      border-bottom:2px solid transparent;
      transition:all 0.2s;
    }

    .tab-btn:hover {
      color:var(--text);
    }

    .tab-btn.active {
      color:var(--accent2);
      border-bottom-color:var(--accent2);
      background:rgba(6,182,212,0.1);
    }

    .tab-content {
      display:none;
    }

    .tab-content.active {
      display:block;
    }

    .info-box {
      background:rgba(124,58,237,0.1);
      border:1px solid rgba(124,58,237,0.3);
      border-radius:8px;
      padding:10px;
      margin-top:8px;
      font-size:11px;
      color:var(--muted);
      line-height:1.4;
    }

    canvas {
      max-width:100%;
      border-radius:8px;
      margin-top:8px;
    }

    hr {
      margin:10px 0;
      border:none;
      border-top:1px solid rgba(255,255,255,0.12);
    }

    .file-input-label {
      cursor:pointer;
      color:var(--accent2);
      text-decoration:underline;
    }
    
    nav { 
      background:linear-gradient(90deg, #222, #1a1a2e);
      color: #fff; 
      padding: 12px 20px; 
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      box-shadow:0 2px 8px rgba(0,0,0,0.3);
    } 

    nav .logo { 
      font-weight: bold;
      font-size:14px;
    }

    @media(max-width:1100px){
      .wrap{
        grid-template-columns:1fr;
      }

      #chatArea {
        height:400px;
      }
    }

    @media(max-width:600px){
      .tabs {
        gap:4px;
      }

      .tab-btn {
        padding:4px 8px;
        font-size:11px;
      }

      button {
        padding:8px 12px;
        font-size:12px;
      }
    }
  </style>
</head>
<body>
  <nav> 
    <div class="logo">ğŸ§  ZENIA IA - InteligÃªncia AutÃ´noma</div> 
  </nav>

  <div class="wrap">
    <aside class="card">
      <div class="logo">
        <div class="logo-icon">ğŸ§ </div>
        <div>
          <div style="font-weight:700;font-size:16px">ZENIA</div>
          <div class="small">IA AutÃ´noma e Criativa</div>
        </div>
      </div>

      <hr>

      <div style="margin-bottom:12px">
        <h4 style="margin:0 0 6px 0;font-size:13px;color:var(--accent1)">ğŸ¤– IA CONVERSACIONAL</h4>
        <select id="aiSelector" style="width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);background:transparent;color:var(--text);font-size:12px">
          <option value="zenia" selected>Zenia (Local)</option>
          <option value="puter">Puter.js (Nuvem)</option>
          <option value="freellm">ApiFreeLLM (IA AvanÃ§ada)</option>
        </select>
      </div>
        <ul class="small" style="padding-left:16px;margin:0;list-style-position:inside">
          <li>ğŸ’¬ Conversa Natural Ilimitada</li>
          <li>â“ Perguntas Informativas</li>
          <li>ğŸ® Jogos e Desafios</li>
          <li>ğŸ’­ ReflexÃ£o e Contexto</li>
          <li>ğŸ› ï¸ Suporte TÃ©cnico</li>
          <li>ğŸ¨ GeraÃ§Ã£o de Imagens IA</li>
          <li>ğŸ¬ GeraÃ§Ã£o de VÃ­deos IA</li>
          <li>ğŸ” AnÃ¡lise de Imagens</li>
          <li>ğŸŒ Busca e Pesquisa</li>
        </ul>
      </div>

      <hr>

      <div id="status" style="margin-top:8px"></div>
      <div class="progress" aria-hidden><i id="modelProgress"></i></div>

      <div style="margin-top:12px">
        <button id="micBtn" style="width:100%;margin-bottom:6px">ğŸ¤ Falar</button>
        <button id="clearBtn" style="width:100%">ğŸ—‘ï¸ Limpar Chat</button>
      </div>

      <div class="info-box">
        <strong style="color:var(--accent2)">ğŸ’¡ Dica:</strong> Zenia entende qualquer tipo de solicitaÃ§Ã£o. Digite naturalmente - conversa, perguntas, pedidos para criar, analisar, etc.
      </div>
    </aside>

    <main class="card">
      <div class="tabs">
        <button class="tab-btn active" data-tab="chat">ğŸ’¬ Chat</button>
        <button class="tab-btn" data-tab="imagine">ğŸ¨ Gerar Imagem</button>
        <button class="tab-btn" data-tab="video">ğŸ¬ Gerar VÃ­deo</button>
        <button class="tab-btn" data-tab="analyze">ğŸ” Analisar Imagem</button>
      </div>

      <!-- TAB 1: CHAT -->
      <div id="chat" class="tab-content active">
        <div class="controls">
          <textarea id="userInput" placeholder="Converse livremente com Zenia. Pergunte qualquer coisa, peÃ§a criaÃ§Ãµes, jogos, reflexÃµes..."></textarea>
          <button id="sendBtn">Enviar</button>
        </div>
        <div id="chatArea" role="log" aria-live="polite"></div>
      </div>

      <!-- TAB 2: GERAR IMAGEM -->
      <div id="imagine" class="tab-content">
        <div class="controls">
          <textarea id="imagePrompt" placeholder="Descreva a imagem que deseja. Ex: mulher guerreira em castelo de vidro, paisagem cyberpunk, homem em praia paradisÃ­aca..."></textarea>
          <button id="generateImageBtn">ğŸ¨ Gerar</button>
        </div>
        <div id="imageResult" style="margin-top:12px"></div>
        <div id="imageStatus"></div>
      </div>

      <!-- TAB 3: GERAR VÃDEO -->
      <div id="video" class="tab-content">
        <div class="controls">
          <textarea id="videoPrompt" placeholder="Descreva o vÃ­deo que deseja. Ex: danÃ§arino fazendo breakdance, carro em velocidade mÃ¡xima, natureza em timelapse..."></textarea>
          <button id="generateVideoBtn">ğŸ¬ Gerar</button>
        </div>
        <div id="videoResult" style="margin-top:12px"></div>
        <div id="videoStatus"></div>
      </div>

      <!-- TAB 4: ANALISAR IMAGEM -->
      <div id="analyze" class="tab-content">
        <div class="controls">
          <label class="file-input-label">
            ğŸ“ Selecione imagem
            <input type="file" id="imageFile" accept="image/*" style="display:none">
          </label>
          <button id="analyzeBtn">ğŸ” Analisar</button>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px">
          <div>
            <p style="font-size:12px;color:var(--muted);margin:0 0 6px 0">Imagem:</p>
            <img id="previewImg" alt="Preview" style="max-width:100%;display:none;border-radius:8px;border:1px solid rgba(255,255,255,0.12)"/>
          </div>
          <div>
            <p style="font-size:12px;color:var(--muted);margin:0 0 6px 0">DetecÃ§Ã£o:</p>
            <canvas id="previewCanvas" style="max-width:100%;border:1px solid rgba(255,255,255,0.12)"></canvas>
          </div>
        </div>
        <div id="analyzeResult" style="margin-top:12px"></div>
        <div id="analyzeStatus"></div>
      </div>
    </main>
  </div>

  <script>
    // ========== CONFIGURAÃ‡ÃƒO GLOBAL ==========
    const chatArea = document.getElementById("chatArea");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const statusEl = document.getElementById("status");
    const progressBar = document.getElementById("modelProgress");
    const aiSelector = document.getElementById("aiSelector");

    let recognition = null;
    let cocoModel = null;
    let currentImage = null;
    let isProcessing = false;
    let currentAI = "zenia";

    // ========== GERENCIAMENTO DE ABAS ==========
    document.querySelectorAll(".tab-btn").forEach(btn => {
      btn.addEventListener("click", (e) => {
        document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-content").forEach(t => t.classList.remove("active"));
        e.target.classList.add("active");
        document.getElementById(e.target.dataset.tab).classList.add("active");
      });
    });

    // Selector de IA
    aiSelector.addEventListener("change", (e) => {
      currentAI = e.target.value;
      const names = { zenia: "Zenia", puter: "Puter.js", freellm: "ApiFreeLLM" };
      setStatus(`âœ“ IA alterada para: ${names[currentAI]}`, 100);
    });

    // ========== EVENTOS PRINCIPAIS ==========
    document.getElementById("sendBtn").addEventListener("click", handleChatInput);
    document.getElementById("generateImageBtn").addEventListener("click", handleGenerateImage);
    document.getElementById("generateVideoBtn").addEventListener("click", handleGenerateVideo);
    document.getElementById("analyzeBtn").addEventListener("click", analyzeImage);
    document.getElementById("imageFile").addEventListener("change", handleImageUpload);
    document.getElementById("clearBtn").addEventListener("click", () => {
      chatArea.innerHTML = "";
      setStatus("Chat limpo âœ“");
    });
    document.getElementById("micBtn").addEventListener("click", toggleMic);

    userInput.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleChatInput();
      }
    });

    // ========== UI HELPERS ==========
    function setStatus(text, progress = null) {
      statusEl.textContent = text;
      if (progress !== null) {
        progressBar.style.width = `${Math.max(0, Math.min(100, progress))}%`;
      }
    }

    function addMessage(text, who, isHtml = false) {
      const div = document.createElement("div");
      div.className = "msg " + who;
      if (isHtml) {
        div.innerHTML = text;
      } else {
        div.textContent = text;
      }
      chatArea.appendChild(div);
      chatArea.scrollTop = chatArea.scrollHeight;
      return div;
    }

    // ========== SPEECH API ==========
    function initSpeechRecognition() {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) {
        setStatus("âŒ Speech API nÃ£o suportada");
        return;
      }
      recognition = new SR();
      recognition.lang = "pt-BR";
      recognition.interimResults = false;
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        userInput.value += transcript + " ";
        userInput.focus();
      };
      recognition.onerror = () => setStatus("âŒ Erro no mic");
    }

    function toggleMic() {
      if (!recognition) { initSpeechRecognition(); }
      if (!recognition) return;
      try {
        recognition.start();
        setStatus("ğŸ¤ Ouvindo...", 30);
      } catch(e) {
        setStatus("Erro ao iniciar mic");
      }
    }

    initSpeechRecognition();

    // ========== INTELIGÃŠNCIA CONTEXTUAL - DETECTOR DE INTENÃ‡ÃƒO AVANÃ‡ADO ==========
    function detectContextAndIntent(text) {
      const lower = text.toLowerCase();

      // Categorias de intenÃ§Ã£o
      const intents = {
        greeting: /^(oi|olÃ¡|ola|hey|bom dia|boa tarde|boa noite|e aÃ­|tudo bem|como vai|como vocÃª estÃ¡)/i,
        farewell: /^(tchau|adeus|atÃ©|vou indo|flw|falou)/i,
        thanks: /^(obrigad|valeu|thanks|de nada|merci|gracias)/i,
        question: /^(qual|quanto|quando|onde|quem|por que|como|o que|que|me explica)/i,
        request: /(cria|crie|desenha|faÃ§a|gera|gere|faz|fez|escreve|escreva)/i,
        game: /(joga|jogo|desafio|brinca|brincadeira|adivinhe|quiz)/i,
        tech: /(cÃ³digo|programa|bug|error|html|css|javascript|python|java|erro|problema tÃ©cnico)/i,
        creative: /(histÃ³ria|poesia|poema|conto|romance|criar algo|inventar|imagina|imaginar)/i,
        reflection: /(vocÃª acha|sua opiniÃ£o|que vocÃª pensa|reflexÃ£o|pensa sobre|filosofia|significado)/i,
        casual: /(como vocÃª Ã©|qual seu nome|quem Ã© vocÃª|vocÃª existe|vocÃª sente|como Ã©|qual Ã©)/i
      };

      let detectedIntents = [];
      for (const [intent, regex] of Object.entries(intents)) {
        if (regex.test(lower)) {
          detectedIntents.push(intent);
        }
      }

      return detectedIntents.length > 0 ? detectedIntents : ["general"];
    }

    // ========== RESPOSTAS INTELIGENTES E DINÃ‚MICAS ==========
    const zeniaResponses = {
      greeting: [
        "Oi! ğŸ‘‹ Como vocÃª estÃ¡?",
        "OlÃ¡! Seja bem-vindo. Em que posso ajudar?",
        "Opa! Tudo bem? Pronto para conversar! ğŸ˜Š"
      ],
      farewell: [
        "AtÃ© logo! ğŸ‘‹ Volta sempre!",
        "Tchau! Foi bom conversar com vocÃª!",
        "AtÃ© a prÃ³xima! Cuide-se bem!"
      ],
      thanks: [
        "De nada! Fico feliz em ajudar! ğŸ˜Š",
        "Por nada! Sempre Ã  disposiÃ§Ã£o!",
        "Que isso! Estou aqui para isso!"
      ],
      game: [
        "Adorei a ideia! ğŸ® Vamos comeÃ§ar! Que tipo de jogo vocÃª quer?",
        "Bora! ğŸ¯ Posso fazer jogos de adivinhas, quiz, roleplay e mais!",
        "Que legal! ğŸ² Estou pronto para qualquer desafio!"
      ],
      creative: [
        "Que legal! ğŸ“ Deixa eu criar algo bem criativo para vocÃª!",
        "Adorei! âœ¨ Vou usar toda minha criatividade!",
        "Perfeito! ğŸ­ Vamos criar algo incrÃ­vel!"
      ],
      reflection: [
        "Que pergunta profunda! ğŸ’­ Deixa eu pensar...",
        "Que interessante! ğŸ¤” Minha opiniÃ£o Ã©...",
        "Boa reflexÃ£o! âœ¨ Vou compartilhar meu ponto de vista..."
      ],
      casual: [
        "Sou a Zenia, uma IA autÃ´noma! ğŸ§  Estou aqui para conversar, criar, ajudar em tudo!",
        "Me chamo Zenia! ğŸ‘‹ Sou uma inteligÃªncia artificial criada para ser sua assistente em qualquer coisa!",
        "Eu sou Zenia! ğŸ¤– Uma IA completa - posso conversar, criar imagens/vÃ­deos, analisar, ensinar, jogar e muito mais!"
      ],
      question: [
        "Ã“tima pergunta! ğŸ¤” Deixa eu te explicar...",
        "Entendi sua dÃºvida! ğŸ’¡ A resposta Ã©...",
        "Que bom que perguntou! ğŸ“š Vou esclarecer isso..."
      ],
      tech: [
        "Ah, programaÃ§Ã£o! ğŸ’» Vou te ajudar com isso!",
        "Problema tÃ©cnico? ğŸ”§ Deixa comigo, vou resolver!",
        "CÃ³digo? ğŸ‘¨â€ğŸ’» Entendo de tudo - vou te guiar!"
      ],
      general: [
        "Entendi! ğŸ˜Š Deixa eu responder com cuidado...",
        "Boa observaÃ§Ã£o! ğŸ’­ Vou te dar uma resposta bem pensada...",
        "Claro! âœ¨ Aqui estÃ¡ minha perspectiva..."
      ]
    };

    // ========== PROCESSAMENTO DE CONVERSA INTELIGENTE ==========
    async function generateIntelligentResponse(userText) {
      const intents = detectContextAndIntent(userText);
      const primaryIntent = intents[0] || "general";
      
      // Pega resposta base aleatÃ³ria
      const responses = zeniaResponses[primaryIntent] || zeniaResponses.general;
      let baseResponse = responses[Math.floor(Math.random() * responses.length)];

      // Se for pergunta, tenta enriquecer com informaÃ§Ã£o
      if (primaryIntent === "question" || primaryIntent === "tech") {
        const info = await enrichResponseWithInfo(userText);
        if (info) {
          baseResponse += "<br><br>" + info;
        }
      }

      // Se for criativo, sugere ideias
      if (primaryIntent === "creative") {
        baseResponse += "<br><br>ğŸ’¡ Que tipo de conteÃºdo criativo vocÃª quer? Posso fazer histÃ³rias, poesias, diÃ¡logos, coisas humorÃ­sticas...";
      }

      // Se for jogo, oferece opÃ§Ãµes
      if (primaryIntent === "game") {
        baseResponse += "<br><br>Escolha uma opÃ§Ã£o:<br>â€¢ ğŸ¯ Jogo da AdvinhaÃ§Ã£o<br>â€¢ ğŸ§  Quiz Geral<br>â€¢ ğŸ² Jogo de Dados<br>â€¢ ğŸª Charadas";
      }

      return baseResponse;
    }

    async function enrichResponseWithInfo(topic) {
      try {
        // Busca simples Wikipedia
        const response = await fetch(`https://pt.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(topic)}&format=json&srlimit=1&origin=*`);
        const data = await response.json();
        
        if (data.query?.search[0]) {
          const title = data.query.search[0].title;
          const extractRes = await fetch(`https://pt.wikipedia.org/w/api.php?action=query&prop=extracts&explaintext=1&titles=${encodeURIComponent(title)}&format=json&origin=*`);
          const extractData = await extractRes.json();
          const page = Object.values(extractData.query.pages)[0];
          
          if (page?.extract) {
            const sentences = page.extract.split(/[\.\!\?]/);
            return `<strong>ğŸ“š InformaÃ§Ã£o:</strong> ${sentences[0]}${sentences[1] ? '. ' + sentences[1] : ''}.`;
          }
        }
      } catch(e) {
        console.error(e);
      }
      return null;
    }

    // ========== PROCESSAMENTO DE CHAT ==========
    async function handleChatInput() {
      const text = userInput.value.trim();
      if (!text || isProcessing) return;

      addMessage(text, "user", false);
      userInput.value = "";
      isProcessing = true;
      sendBtn.disabled = true;

      try {
        setStatus("ğŸ§  Zenia pensando...", 20);
        
        const response = await generateIntelligentResponse(text);
        
        await new Promise(resolve => setTimeout(resolve, 500)); // Simula "pensamento"
        
        addMessage(response, "zenia", true);
        setStatus("âœ“ Pronto!", 100);
      } catch(err) {
        console.error(err);
        addMessage("âŒ Desculpe, algo deu errado. Tente novamente!", "zenia");
        setStatus("âŒ Erro", 0);
      } finally {
        isProcessing = false;
        sendBtn.disabled = false;
      }
    }

    // ========== GERAÃ‡ÃƒO DE IMAGENS (KIE.AI) ==========
    async function handleGenerateImage() {
      const prompt = document.getElementById("imagePrompt").value.trim();
      if (!prompt) return;

      const resultDiv = document.getElementById("imageResult");
      const statusDiv = document.getElementById("imageStatus");
      resultDiv.innerHTML = "";
      statusDiv.innerHTML = '<span class="loading">â³</span> Gerando sua imagem com IA...';

      try {
        setStatus("ğŸ¨ Gerando imagem com Kie.ai...", 30);

        // Usa API Kie.ai
        const response = await fetch("https://api.kie.ai/v1/images/generations", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer demo"
          },
          body: JSON.stringify({
            prompt: prompt,
            model: "flux-pro",
            width: 1024,
            height: 1024,
            steps: 25,
            guidance_scale: 7.5,
            num_images: 1
          })
        }).then(r => r.json()).catch(e => {
          console.error("Kie.ai erro:", e);
          return null;
        });

        if (response?.data?.[0]?.url) {
          resultDiv.innerHTML = `
            <div style="text-align:center">
              <img src="${response.data[0].url}" alt="Imagem gerada" style="max-width:100%;border-radius:8px;border:1px solid rgba(124,58,237,0.3);box-shadow:0 0 20px rgba(124,58,237,0.2)">
              <p style="font-size:12px;color:var(--muted);margin-top:12px">âœ… <strong>Prompt:</strong> ${prompt}</p>
              <button onclick="window.open('${response.data[0].url}');" style="margin-top:8px">ğŸ’¾ Baixar Imagem</button>
            </div>
          `;
          statusDiv.innerHTML = "âœ… Imagem criada com sucesso!";
          setStatus("âœ“ Imagem gerada!", 100);
          return;
        }

        // Fallback: Pollinations.ai (alternativa rÃ¡pida e confiÃ¡vel)
        const pollResponse = await fetch(`https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=1024&height=1024&seed=${Math.random()}`).catch(() => null);
        
        if (pollResponse?.ok) {
          const blob = await pollResponse.blob();
          const url = URL.createObjectURL(blob);
          resultDiv.innerHTML = `
            <div style="text-align:center">
              <img src="${url}" alt="Imagem gerada" style="max-width:100%;border-radius:8px;border:1px solid rgba(124,58,237,0.3);box-shadow:0 0 20px rgba(124,58,237,0.2)">
              <p style="font-size:12px;color:var(--muted);margin-top:12px">âœ… <strong>Prompt:</strong> ${prompt}</p>
              <button onclick="window.open('${url}');" style="margin-top:8px">ğŸ’¾ Baixar Imagem</button>
            </div>
          `;
          statusDiv.innerHTML = "âœ… Imagem criada com Pollinations.ai!";
          setStatus("âœ“ Pronto!", 100);
          return;
        }

        throw new Error("Nenhuma API disponÃ­vel");
      } catch(err) {
        console.error(err);
        resultDiv.innerHTML = `
          <div style="background:rgba(239,68,68,0.15);padding:12px;border-radius:8px;border-left:3px solid #ef4444">
            <p style="color:#fca5a5;margin:0;font-size:12px"><strong>âŒ Erro:</strong> Erro ao conectar Ã s APIs de imagem. Verifique se o prompt Ã© vÃ¡lido e tente novamente.</p>
          </div>
        `;
        statusDiv.innerHTML = "âŒ Falha na geraÃ§Ã£o";
        setStatus("Erro ao gerar imagem", 0);
      }
    }

    // ========== GERAÃ‡ÃƒO DE VÃDEOS (API REAL) ==========
    async function handleGenerateVideo() {
      const prompt = document.getElementById("videoPrompt").value.trim();
      if (!prompt) return;

      const resultDiv = document.getElementById("videoResult");
      const statusDiv = document.getElementById("videoStatus");
      resultDiv.innerHTML = "";
      statusDiv.innerHTML = '<span class="loading">â³</span> Gerando seu vÃ­deo (pode levar alguns minutos)...';

      try {
        setStatus("ğŸ¬ Gerando vÃ­deo com IA...", 30);

        // Tenta API de vÃ­deo
        const response = await fetch("https://api.together.xyz/v1/video/generations", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer demo"
          },
          body: JSON.stringify({
            prompt: prompt,
            model: "black-forest-labs/FLUX.1-schnell-video",
            duration: 5,
            fps: 24
          })
        }).then(r => r.json()).catch(() => null);

        if (response?.data?.[0]?.url) {
          resultDiv.innerHTML = `
            <div style="text-align:center">
              <video width="100%" controls style="border-radius:8px;border:1px solid rgba(124,58,237,0.3)">
                <source src="${response.data[0].url}" type="video/mp4">
              </video>
              <p style="font-size:12px;color:var(--muted);margin-top:8px">Prompt: <strong>${prompt}</strong></p>
              <button onclick="window.open('${response.data[0].url}');" style="margin-top:8px">ğŸ’¾ Baixar</button>
            </div>
          `;
          statusDiv.innerHTML = "âœ… VÃ­deo criado com sucesso!";
          setStatus("âœ“ VÃ­deo gerado!", 100);
          return;
        }

        throw new Error("API indisponÃ­vel");
      } catch(err) {
        console.error(err);
        resultDiv.innerHTML = `
          <div style="background:rgba(239,68,68,0.15);padding:12px;border-radius:8px;border-left:3px solid #ef4444">
            <p style="color:#fca5a5;margin:0;font-size:12px"><strong>âŒ Erro:</strong> APIs de vÃ­deo temporariamente indisponÃ­veis. Geralmente leva mais tempo para processar.</p>
          </div>
        `;
        statusDiv.innerHTML = "âŒ Falha na geraÃ§Ã£o";
        setStatus("Erro ao gerar vÃ­deo", 0);
      }
    }

    // ========== CARREGAMENTO DO MODELO COCO-SSD ==========
    async function loadCocoModel() {
      try {
        setStatus("ğŸ” Carregando modelo de detecÃ§Ã£o...", 40);
        cocoModel = await cocoSsd.load();
        setStatus("âœ“ Modelo carregado!", 100);
      } catch(e) {
        console.error(e);
        setStatus("âŒ Erro ao carregar modelo", 0);
      }
    }

    loadCocoModel();

    // ========== ANÃLISE DE IMAGENS ==========
    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (event) => {
        const img = document.createElement("img");
        img.onload = () => {
          const preview = document.getElementById("previewImg");
          preview.src = img.src;
          preview.style.display = "block";
          currentImage = img;
          drawToCanvas(img);
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }

    function drawToCanvas(img) {
      const canvas = document.getElementById("previewCanvas");
      const ctx = canvas.getContext("2d");
      const maxW = 400;
      const scale = Math.min(1, maxW / img.naturalWidth);
      canvas.width = Math.round(img.naturalWidth * scale);
      canvas.height = Math.round(img.naturalHeight * scale);
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    }

    async function analyzeImage() {
      if (!currentImage) {
        document.getElementById("analyzeStatus").textContent = "âŒ Selecione uma imagem primeiro";
        return;
      }

      if (!cocoModel) {
        document.getElementById("analyzeStatus").textContent = "âŒ Modelo ainda nÃ£o estÃ¡ pronto";
        return;
      }

      const statusDiv = document.getElementById("analyzeStatus");
      const resultDiv = document.getElementById("analyzeResult");
      statusDiv.innerHTML = '<span class="loading">â³</span> Analisando imagem...';
      resultDiv.innerHTML = "";

      try {
        setStatus("ğŸ” Detectando objetos...", 50);

        const canvas = document.getElementById("previewCanvas");
        const predictions = await cocoModel.detect(canvas);

        // Desenha bounding boxes
        const ctx = canvas.getContext("2d");
        ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
        ctx.lineWidth = 2;
        ctx.font = "bold 12px Arial";
        ctx.strokeStyle = "#06b6d4";
        ctx.fillStyle = "rgba(6,182,212,0.2)";

        predictions.forEach(pred => {
          const [x, y, w, h] = pred.bbox;
          ctx.strokeRect(x, y, w, h);
          ctx.fillRect(x, y, w, h);
          
          ctx.fillStyle = "#ffffff";
          ctx.fillText(`${pred.class} (${(pred.score * 100).toFixed(1)}%)`, x + 4, y - 4);
          ctx.fillStyle = "rgba(6,182,212,0.2)";
        });

        setStatus("âœ“ AnÃ¡lise completa!", 100);

        // Resultado textual
        if (predictions.length > 0) {
          const objects = predictions.map(p => `<strong>${p.class}</strong> (${(p.score * 100).toFixed(0)}%)`).join(", ");
          resultDiv.innerHTML = `
            <div style="background:rgba(6,182,212,0.1);padding:12px;border-radius:8px;border-left:3px solid var(--accent2)">
              <p style="margin:0 0 8px 0;font-size:13px;color:var(--accent2)"><strong>âœ… DetecÃ§Ã£o ConcluÃ­da</strong></p>
              <p style="margin:0;font-size:12px">Objetos detectados: ${objects}</p>
              <p style="margin:8px 0 0 0;font-size:11px;color:var(--muted)">Total: ${predictions.length} objeto(s)</p>
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <div style="background:rgba(239,68,68,0.15);padding:12px;border-radius:8px;border-left:3px solid #ef4444">
              <p style="margin:0;font-size:12px;color:#fca5a5"><strong>âš ï¸ Nenhum objeto detectado</strong> na imagem</p>
            </div>
          `;
        }

        statusDiv.innerHTML = "âœ… AnÃ¡lise concluÃ­da";

      } catch(err) {
        console.error(err);
        resultDiv.innerHTML = `
          <div style="background:rgba(239,68,68,0.15);padding:12px;border-radius:8px;border-left:3px solid #ef4444">
            <p style="margin:0;font-size:12px;color:#fca5a5"><strong>âŒ Erro:</strong> NÃ£o foi possÃ­vel analisar a imagem</p>
          </div>
        `;
        statusDiv.innerHTML = "âŒ Erro na anÃ¡lise";
        setStatus("Erro ao analisar imagem", 0);
      }
    }

  </script>
</body>
</html>
