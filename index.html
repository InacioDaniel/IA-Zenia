<!DOCTYPE html>
<html lang="pt-AO">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>IA-ZÃ©nia - ZÃ©nia Projects</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root {
    --accent: #00eaff; --accent-alt: #0066ff; --bg: #020617; --panel: #0b1124;
    --border: #1e3a8a; --text-light: #e0f2fe; --neon-glow: 0 0 20px rgba(0, 234, 255, 0.4);
}
body { background: radial-gradient(circle at top right, #0b1124, #020617); color: var(--text-light); font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; height: 100vh; display: flex; overflow: hidden; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

.sidebar { width: 280px; background: rgba(11, 17, 36, 0.95); backdrop-filter: blur(10px); border-right: 1px solid var(--border); display: flex; flex-direction: column; transition: .4s ease; z-index: 100; }
@media(max-width:768px){ .sidebar { position: fixed; left: -100%; height: 100%; } .sidebar.active { left: 0; } }

.main-content { flex:1; display:flex; flex-direction:column; overflow:hidden; position: relative; }
.chat-container { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 20px; }

.msg-wrapper { display:flex; flex-direction:column; max-width:85%; gap:8px; animation: slideUp 0.4s ease-out; }
.ai-wrapper { align-self: flex-start; }
.user-wrapper { align-self: flex-end; }
.msg { padding: 16px 20px; border-radius: 20px; line-height: 1.6; font-size: 14.5px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.ai-msg { background: rgba(15, 23, 42, 0.8); border: 1px solid var(--border); border-left: 4px solid var(--accent); }
.user-msg { background: linear-gradient(135deg, var(--accent-alt), #0044cc); color: white; }

.footer-input-inner { max-width: 900px; margin: 0 auto; background: rgba(15, 23, 42, 0.9); border: 1px solid var(--border); border-radius: 24px; padding: 10px; box-shadow: 0 -5px 20px rgba(0,0,0,0.3); }
textarea { background: transparent; border: none; outline: none; color: white; resize: none; width: 100%; padding: 10px; font-size: 15px; }
.send-btn { width: 45px; height: 45px; border-radius: 50%; background: var(--accent); color: #000; font-weight: bold; transition: 0.3s; flex-shrink: 0; }
.send-btn:hover { transform: scale(1.05); box-shadow: var(--neon-glow); }
@keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<aside class="sidebar p-5" id="sidebar">
    <div class="mb-6">
        <h1 class="text-2xl font-extrabold text-cyan-400 italic tracking-tighter">IA-ZÃ‰NIA</h1>
        <p class="text-[9px] text-slate-500 font-bold uppercase tracking-widest">By ZÃ©nia Projects</p>
    </div>
    
    <button class="bg-blue-600 hover:bg-blue-500 text-white p-3 rounded-xl font-bold mb-6 transition-all shadow-lg" onclick="window.startNewChat()">+ NOVA SESSÃƒO</button>
    
    <div id="historyList" class="flex-1 overflow-y-auto space-y-2 text-xs"></div>
    
    <div class="pt-4 border-t border-slate-800 space-y-3">
        <p class="text-[10px] text-slate-500 font-bold uppercase">IrmÃ£s Neurais</p>
        <div class="space-y-1">
            <a href="https://ia-zenia.netlify.app" target="_blank" class="block text-cyan-500 hover:text-white transition text-[11px]">ðŸ”— IA-ZÃ©nia Web</a>
            <a href="https://antonia-ia.netlify.app" target="_blank" class="block text-cyan-500 hover:text-white transition text-[11px]">ðŸ”— AntÃ³nia IA</a>
        </div>
        <div class="bg-black/40 p-3 rounded-lg border border-white/5">
            <p class="text-[10px] text-slate-400">Criador: <span class="text-white">@inacio.u.daniel</span></p>
            <p class="text-[9px] text-slate-500 italic mt-1">Lubango, Angola</p>
        </div>
    </div>
</aside>

<main class="main-content">
    <header class="p-4 border-b border-white/5 flex justify-between items-center bg-black/20 backdrop-blur-md">
        <button onclick="window.toggleSidebar()" class="p-2 hover:bg-white/10 rounded-lg text-white">â˜°</button>
        <div class="text-right">
            <div class="flex items-center gap-2 justify-end">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                <p class="text-[10px] font-bold text-cyan-400">SISTEMA ACTIVO</p>
            </div>
            <p class="text-[8px] text-slate-500 uppercase tracking-widest">Lubango Edition</p>
        </div>
    </header>

    <div id="chatBox" class="chat-container"></div>

    <div class="p-4 bg-gradient-to-t from-bg to-transparent">
        <div class="footer-input-inner">
            <div class="flex items-center gap-4 border-b border-white/5 mb-2 pb-2 px-2 text-[11px]">
                <select id="voiceSelect" class="bg-transparent text-cyan-400 outline-none cursor-pointer">
                    <option value="nova">Voz: ZÃ©nia Nova</option>
                    <option value="native">Voz: Nativa PT-AO</option>
                </select>
                <input type="file" id="imgUpload" hidden>
                <button onclick="document.getElementById('imgUpload').click()" class="text-slate-400 hover:text-cyan-400 transition">ðŸ“Ž ANEXAR FOTO</button>
            </div>
            <div class="flex items-end gap-2">
                <textarea id="userInput" placeholder="Escreve aqui..." rows="1" oninput="this.style.height='';this.style.height=this.scrollHeight+'px'"></textarea>
                <button class="send-btn" onclick="window.handleSend()">ðŸš€</button>
            </div>
        </div>
    </div>
</main>

<script type="module">
import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.16.0';
env.allowLocalModels = false;
env.useBrowserCache = true;

let visionPipeline = null;
const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');

window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('active');

window.startNewChat = () => {
    chatBox.innerHTML = '';
    addMessage("Onawa! Sou a IA-ZÃ‰NIA de Lubango. Como posso ajudar hoje?", false);
};

// --- FUNÃ‡ÃƒO DE CHAMADA ROBUSTA ---
async function askAI(prompt) {
    const systemPrompt = `VocÃª Ã© IA-ZÃ‰NIA, uma IA angolana do Lubango. Criador: @inacio.u.daniel. Responda sempre em PortuguÃªs de Angola com carisma. Pergunta: ${prompt}`;
    
    // Tenta primeiro a API do Saurav (mesmo instÃ¡vel)
    try {
        const response = await fetch(`https://free-text-generation-api.vercel.app/api/generate`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt: systemPrompt, model: "gpt-3.5-turbo" })
        });
        
        if (!response.ok) throw new Error('API Down');
        const data = await response.json();
        // Se a resposta contiver erro de gateway ou estiver vazia
        if (!data.result || data.result.includes("502")) throw new Error('Bad Gateway');
        return data.result;
    } catch (err) {
        console.warn("API Principal falhou, usando backup...");
        // BACKUP ESTÃVEL (Pollinations)
        const res = await fetch('https://text.pollinations.ai/'+encodeURIComponent(systemPrompt)+'?model=mistral&seed=' + Math.random());
        return await res.text();
    }
}

window.handleSend = async (textOverride) => {
    const text = (textOverride || userInput.value).trim();
    if(!text) return;

    if(!textOverride) {
        addMessage(text, true);
        userInput.value = '';
        userInput.style.height = 'auto';
    }

    const loader = addMessage("<span class='animate-pulse'>ZÃ©nia estÃ¡ a pensar...</span>", false);

    const responseText = await askAI(text);
    loader.remove();
    addMessage(responseText, false);
};

function addMessage(content, isUser) {
    const wrapper = document.createElement('div');
    wrapper.className = `msg-wrapper ${isUser ? 'user-wrapper' : 'ai-wrapper'}`;
    const formatted = content.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
    wrapper.innerHTML = `<div class="msg ${isUser ? 'user-msg' : 'ai-msg'}">${formatted}</div>`;
    chatBox.appendChild(wrapper);
    chatBox.scrollTop = chatBox.scrollHeight;
    return wrapper;
}

// VisÃ£o Local (Transformers.js)
document.getElementById('imgUpload').addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = async (event) => {
        addMessage(`ðŸ“Ž Analisando imagem...<br><img src="${event.target.result}" style="border-radius:12px; margin-top:10px; border: 1px solid var(--accent)">`, true);
        if(!visionPipeline) {
            addMessage("<i>A carregar visÃ£o neural (sÃ³ na primeira vez)...</i>", false);
            visionPipeline = await pipeline('image-to-text', 'Xenova/vit-gpt2-image-captioning');
        }
        const output = await visionPipeline(event.target.result);
        window.handleSend(`[VISÃƒO]: Detectei: ${output[0].generated_text}. Comenta isso como ZÃ©nia.`);
    };
    reader.readAsDataURL(file);
});

window.startNewChat();
</script>
</body>
</html>
