<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA-Z√âNIA aNGOLA 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { background: #010409; color: #e6edf3; font-family: 'Plus Jakarta Sans', sans-serif; height: 100vh; display: flex; overflow: hidden; margin: 0; }
        
        /* Barra Lateral */
        .sidebar { width: 280px; background: #0d1117; border-right: 1px solid #30363d; display: flex; flex-direction: column; transition: all 0.3s; }
        .history-item { padding: 10px; border-radius: 8px; cursor: pointer; font-size: 13px; margin-bottom: 5px; transition: 0.2s; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; border: 1px solid transparent; }
        .history-item:hover { background: #161b22; border-color: #30363d; }
        .sister-link { font-size: 12px; color: #58a6ff; display: block; padding: 8px; border-radius: 6px; text-decoration: none; transition: 0.2s; }
        .sister-link:hover { background: rgba(88, 166, 255, 0.1); }

        /* Main Content */
        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; }
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        
        .msg-wrapper { display: flex; flex-direction: column; max-width: 85%; }
        .ai-wrapper { align-self: flex-start; }
        .user-wrapper { align-self: flex-end; }
        .msg { padding: 15px; border-radius: 18px; line-height: 1.6; border: 1px solid #30363d; }
        .user-msg { background: #1f6feb; border: none; }
        .ai-msg { background: #161b22; }

        /* Canvas Image Box */
        .image-box { background: #000; padding: 10px; border-radius: 12px; border: 1px solid #30363d; margin-top: 10px; width: 270px; }
        canvas { display: block; background: #fff; width: 250px; height: 250px; }
        .img-tools { display: flex; gap: 5px; margin-top: 8px; }
        .btn-img { font-size: 10px; background: #21262d; padding: 5px 8px; border-radius: 4px; color: #c9d1d9; font-weight: bold; }

        #fullScreenOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <div id="fullScreenOverlay" onclick="this.style.display='none'">
        <canvas id="fullCanvas" width="250" height="250" style="transform: scale(3);"></canvas>
    </div>

    <aside class="sidebar p-4">
        <div class="mb-8">
            <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Hist√≥rico Local</h2>
            <div id="historyList" class="overflow-y-auto max-h-[40vh]"></div>
        </div>
        
        <div class="mt-auto border-t border-[#30363d] pt-4">
            <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-2">Irm√£s Z√©nia</h2>
            <a href="https://zenia-projects.netlify.app" target="_blank" class="sister-link">üåê Zenia Projects</a>
            <a href="https://ia-zenia.netlify.app" target="_blank" class="sister-link">üåê IA-Z√©nia Web</a>
            <a href="https://antonia-ia.netlify.app" target="_blank" class="sister-link">üåê Ant√≥nia IA</a>
        </div>
    </aside>

    <main class="main-content">
        <header class="p-4 border-b border-[#30363d] bg-[#0d1117] flex justify-between items-center">
            <div>
                <h1 class="text-xl font-black">IA-Z√âNIA <span class="text-blue-500">2026</span></h1>
                <p class="text-[9px] text-gray-500 uppercase">Natural de: <span class="text-white">Lubango, Angola</span></p>
            </div>
        </header>

        <div id="chatBox" class="chat-container">
            <div class="msg-wrapper ai-wrapper">
                <div class="msg ai-msg">Mbw√©te! Sou a **IA-Z√âNIA**, nascida no Lubango. Meu sistema de imagem est√° otimizado para 250px. Como posso ajudar?</div>
            </div>
        </div>

        <div class="p-4 bg-[#0d1117]">
            <div class="max-w-4xl mx-auto flex gap-2 bg-[#161b22] border border-[#30363d] rounded-2xl p-2 focus-within:border-blue-500">
                <textarea id="userInput" placeholder="Desenha um por do sol no Lubango..." class="flex-1 bg-transparent border-none outline-none p-2 text-sm text-white h-12 resize-none" maxlength="12000"></textarea>
                <button onclick="handleSend()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 rounded-xl font-bold">Enviar</button>
            </div>
        </div>
    </main>

    <script>
        const chatBox = document.getElementById('chatBox');
        const historyList = document.getElementById('historyList');

        // Carregar Hist√≥rico Local
        function loadHistory() {
            const hist = JSON.parse(localStorage.getItem('zenia_chat_history') || '[]');
            historyList.innerHTML = hist.map((q, i) => `<div class="history-item" onclick="document.getElementById('userInput').value='${q}'">${q}</div>`).reverse().join('');
        }

        function saveHistory(q) {
            let hist = JSON.parse(localStorage.getItem('zenia_chat_history') || '[]');
            if(!hist.includes(q)) {
                hist.push(q);
                if(hist.length > 20) hist.shift();
                localStorage.setItem('zenia_chat_history', JSON.stringify(hist));
                loadHistory();
            }
        }

        async function handleSend() {
            const val = document.getElementById('userInput').value.trim();
            if(!val) return;

            addMsg(val, true);
            saveHistory(val);
            document.getElementById('userInput').value = '';

            const isDraw = val.toLowerCase().includes('desenha') || val.toLowerCase().includes('gerar imagem');
            const loading = addMsg("Processando...", false);

            try {
                const system = `IA-Z√âNIA. Natural: Lubango. Se pedir desenho, responda APENAS o c√≥digo JS para canvas ID 'zeniaCanvas' (250x250).`;
                const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(system + "\n" + val)}?model=openai`);
                const text = await res.text();
                loading.remove();

                if(isDraw && text.includes('```')) {
                    const code = text.match(/```(?:javascript|js)?([\s\S]*?)```/)[1];
                    createImageBox(code);
                } else {
                    addMsg(text, false);
                }
            } catch(e) { loading.innerText = "Erro."; }
        }

        function createImageBox(code) {
            const wrapper = document.createElement('div');
            wrapper.className = 'msg-wrapper ai-wrapper';
            wrapper.innerHTML = `
                <div class="image-box">
                    <canvas id="zeniaCanvas" width="250" height="250"></canvas>
                    <div class="img-tools">
                        <button class="btn-img" onclick="viewFull()">Ecr√£ Completo</button>
                        <button class="btn-img" onclick="downloadImg()">Download</button>
                        <button class="btn-img text-red-500" onclick="this.closest('.msg-wrapper').remove()">Eliminar</button>
                    </div>
                </div>`;
            chatBox.appendChild(wrapper);
            setTimeout(() => { try { eval(code); } catch(e){} }, 50);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function viewFull() {
            const mainCanvas = document.getElementById('zeniaCanvas');
            const fullCanvas = document.getElementById('fullCanvas');
            const fCtx = fullCanvas.getContext('2d');
            fCtx.drawImage(mainCanvas, 0, 0);
            document.getElementById('fullScreenOverlay').style.display = 'flex';
        }

        function downloadImg() {
            const link = document.createElement('a');
            link.download = 'zenia-art.png';
            link.href = document.getElementById('zeniaCanvas').toDataURL();
            link.click();
        }

        function addMsg(txt, user) {
            const w = document.createElement('div');
            w.className = `msg-wrapper ${user ? 'user-wrapper' : 'ai-wrapper'}`;
            const clean = txt.replace(/Support Pollinations.*/gs, "").replace(/Ant√≠nia/gi, "IA-Z√âNIA");
            w.innerHTML = `<div class="msg ${user ? 'user-msg' : 'ai-msg'}">${clean.replace(/\n/g, '<br>')}</div>`;
            chatBox.appendChild(w);
            chatBox.scrollTop = chatBox.scrollHeight;
            return w;
        }

        loadHistory();
    </script>
</body>
</html>
