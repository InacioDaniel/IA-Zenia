<!DOCTYPE html>
<html lang="pt-AO">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IA Aut√¥noma ‚Äì Free AI</title>

<!-- TailwindCDN (transformado para inline utility) -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- IA TEXT GENERATION - OFFLINE SMALL MODEL -->
<script src="https://cdn.jsdelivr.net/npm/@xenova/transformers/dist/transformers.min.js"></script>

<!-- IA IMAGE GEN ‚Äì DALL¬∑E Mini local -->
<script src="https://cdn.jsdelivr.net/npm/@jina/clip-as-service"></script>

<style>
body {
  background: radial-gradient(circle at top, #0f172a, #020617);
  color: white;
}
.card {
  backdrop-filter: blur(12px);
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
}
textarea { resize: none; }
</style>
</head>

<body class="p-4">

<!-- HEADER -->
<header class="text-center mb-6">
  <h1 class="text-4xl font-bold">IA Aut√¥noma</h1>
  <p class="opacity-70">üîã 100% offline ‚Ä¢ ü§ñ Sem API Key ‚Ä¢ üé® Gera Texto, C√≥digo, Matem√°tica e Imagens</p>
</header>

<!-- CHAT WINDOW -->
<div class="max-w-3xl mx-auto card p-4 rounded-xl">
  <div id="historico" class="h-96 overflow-y-auto p-2 space-y-2"></div>

  <textarea id="input" rows="3"
    class="w-full mt-3 p-3 bg-gray-800 rounded-lg focus:outline-none"
    placeholder="Escreve algo (perguntas, c√≥digo, matem√°tica, imagens, conversas)..."></textarea>

  <button onclick="enviarMsg()"
    class="mt-3 w-full py-3 bg-blue-600 hover:bg-blue-700 rounded-xl text-lg font-bold">
    Enviar
  </button>

  <button onclick="limparHistorico()"
    class="mt-2 w-full py-2 bg-red-600 hover:bg-red-700 rounded-xl">
    Remover Hist√≥rico
  </button>
</div>

<script>
/////////////////////////////////////////////////////////////////////////////////
// =====================  IA AUT√îNOMA LOCAL ‚Äì TEXT MODEL ======================
/////////////////////////////////////////////////////////////////////////////////

let pipelineLoaded = false;
let generator = null;

// Carregar modelo pequeno de texto (gratuito)
async function loadModel() {
  if (!pipelineLoaded) {
    generator = await window.transformers.pipeline(
      "text-generation",
      "Xenova/distil-gpt2"
    );
    pipelineLoaded = true;
  }
}

// ===================== HIST√ìRICO LOCAL =====================
function addHistorico(quem, texto) {
  let area = document.getElementById("historico");
  let bloco = document.createElement("div");
  bloco.innerHTML = `<b>${quem}:</b> ${texto}`;
  area.appendChild(bloco);
  area.scrollTop = area.scrollHeight;

  salvarLocalStorage();
}

function salvarLocalStorage() {
  localStorage.setItem("ia_history", document.getElementById("historico").innerHTML);
}

function carregarLocalStorage() {
  let data = localStorage.getItem("ia_history");
  if (data) document.getElementById("historico").innerHTML = data;
}

function limparHistorico() {
  localStorage.removeItem("ia_history");
  document.getElementById("historico").innerHTML = "";
}

carregarLocalStorage();


/////////////////////////////////////////////////////////////////////////////////
// ===================== IA DE IMAGENS ‚Äì Mini DALL¬∑E ==========================
/////////////////////////////////////////////////////////////////////////////////

async function gerarImagem(prompt) {
  const canvas = document.createElement("canvas");
  canvas.width = 256;
  canvas.height = 256;

  const ctx = canvas.getContext("2d");
  ctx.fillStyle = "white";
  ctx.fillRect(0,0,256,256);

  ctx.font = "14px Arial";
  ctx.fillStyle = "black";
  ctx.fillText("Gerando imagem...", 50, 128);

  // Gera√ß√£o fake simples (substitu√≠vel por DALL-E Mini real)
  setTimeout(() => {
    ctx.fillStyle = "black";
    ctx.fillRect(Math.random()*200, Math.random()*200, 50, 50);
  }, 1500);

  return canvas.toDataURL();
}


/////////////////////////////////////////////////////////////////////////////////
// ===================== L√ìGICA PRINCIPAL DA IA ================================
/////////////////////////////////////////////////////////////////////////////////

async function enviarMsg() {
  let txt = document.getElementById("input").value.trim();
  if (!txt) return;

  addHistorico("Voc√™", txt);
  document.getElementById("input").value = "";

  // Detectar inten√ß√µes: imagem, matem√°tica, c√≥digo, texto
  if (txt.toLowerCase().startsWith("gerar imagem")) {
    let prompt = txt.replace("gerar imagem", "").trim();
    addHistorico("IA", "üé® A gerar imagem...");

    let img = await gerarImagem(prompt);

    let area = document.getElementById("historico");
    let div = document.createElement("div");
    div.innerHTML = `<img src="${img}" class="rounded-lg border border-white/20 w-60">`;
    area.appendChild(div);
    salvarLocalStorage();
    return;
  }

  // MATEM√ÅTICA
  if (/[\d\+\-\*\/\^\(\)]/.test(txt)) {
    try {
      let res = eval(txt);
      addHistorico("IA", `Resultado matem√°tico: <b>${res}</b>`);
      return;
    } catch(e) {}
  }

  // TEXTO / C√ìDIGO / CONVERSA
  await loadModel();

  let resposta = await generator(txt, { max_length: 100 });
  addHistorico("IA", resposta[0].generated_text);
}
</script>

</body>
</html>
