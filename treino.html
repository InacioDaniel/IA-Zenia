<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA-Z√âNIA | Neural Engine V7 - Di√°logo Real</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --n-blue: #00ffff; --bg: #000d1a; --side: #00050a; }
        .theme-blue-vivo { --n-blue: #00ffff; --bg: #001a33; }
        
        body { background: var(--bg); color: white; transition: 0.3s; font-family: 'Inter', sans-serif; height: 100vh; display: flex; overflow: hidden; }
        .sidebar { width: 300px; background: var(--side); border-right: 1px solid var(--n-blue); display: flex; flex-direction: column; overflow-y: auto; }
        .chat-area { flex: 1; display: flex; flex-direction: column; position: relative; }
        
        .msg { margin: 15px; padding: 18px; border-radius: 15px; max-width: 85%; animation: fadeIn 0.3s ease; line-height: 1.6; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }
        .msg-ia { border-left: 4px solid var(--n-blue); background: rgba(0,255,255,0.03); border: 1px solid rgba(0,255,255,0.1); }
        .msg-user { margin-left: auto; background: var(--n-blue); color: black; font-weight: 500; }
        
        .panel { background: rgba(0,0,0,0.98); backdrop-blur: 20px; z-index: 100; transition: 0.5s; }
        .hidden-panel { transform: translateX(-100%); }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--n-blue); border-radius: 10px; }
        .neon-text { text-shadow: 0 0 10px var(--n-blue); }
        
        .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; animation: pulse 2s infinite; }
        .status-online { background: #00ff88; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .neuron-item { padding: 10px; margin: 4px 0; background: rgba(0,255,255,0.08); border: 1px solid rgba(0,255,255,0.15); border-radius: 6px; font-size: 10px; max-height: 70px; overflow-y-auto; cursor: pointer; transition: 0.2s; }
        .neuron-item:hover { background: rgba(0,255,255,0.2); border-color: rgba(0,255,255,0.3); }
        
        .content-card { background: rgba(0,0,0,0.5); border: 1px solid rgba(0,255,255,0.2); border-radius: 10px; padding: 12px; margin: 8px 0; }
        .spinner { display: inline-block; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .conversation-memory { background: rgba(0,255,255,0.05); border-left: 3px solid rgba(0,255,255,0.3); padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 11px; }
    </style>
</head>
<body class="theme-blue-vivo">

    <!-- PAINEL DE TREINAMENTO -->
    <div id="training-panel" class="fixed inset-0 panel hidden-panel p-8 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-black/90 pb-4">
                <h2 class="text-2xl font-bold text-cyan-400 neon-text"><i class="fas fa-brain mr-2"></i> ALIMENTAR MEU C√âREBRO</h2>
                <button onclick="toggleTraining()" class="text-white hover:text-red-500 text-3xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-cyan-400 text-sm block mb-2">Cole qualquer conte√∫do para eu aprender</label>
                    <textarea id="raw-matter" class="w-full h-64 bg-black/50 border border-cyan-500/30 rounded-xl p-4 text-white font-mono text-sm outline-none focus:border-cyan-400" placeholder="Artigos, livros, fatos, hist√≥rias..."></textarea>
                </div>
                <button onclick="processMassiveMatter()" class="w-full bg-cyan-500 text-black font-bold py-4 rounded-xl hover:bg-white transition uppercase tracking-widest">
                    <i class="fas fa-zap mr-2"></i> APRENDER
                </button>
            </div>
        </div>
    </div>

    <!-- PAINEL DE BUSCA -->
    <div id="search-panel" class="fixed inset-0 panel hidden-panel p-8 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-black/90 pb-4">
                <h2 class="text-2xl font-bold text-cyan-400 neon-text"><i class="fas fa-globe mr-2"></i> BUSCA INTELIGENTE</h2>
                <button onclick="toggleSearch()" class="text-white hover:text-red-500 text-3xl">&times;</button>
            </div>
            
            <div class="space-y-4 mb-6">
                <input type="text" id="search-term" class="w-full bg-black/50 border border-cyan-500/30 rounded-xl p-3 text-white outline-none focus:border-cyan-400" placeholder="O que queres que aprenda?">
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="searchWikipedia()" class="bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition font-bold text-sm">
                        <i class="fas fa-book mr-2"></i> Wikipedia
                    </button>
                    <button onclick="searchArxiv()" class="bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition font-bold text-sm">
                        <i class="fas fa-microscope mr-2"></i> ArXiv
                    </button>
                </div>
            </div>
            
            <div id="search-results" class="bg-black/30 border border-cyan-500/20 rounded-xl p-4 min-h-96 max-h-96 overflow-y-auto mb-4">
                <p class="text-cyan-400/60 text-center py-8"><i class="fas fa-magnifying-glass mr-2"></i> Resultados...</p>
            </div>
            
            <button onclick="syncAllSearchResults()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl transition">
                <i class="fas fa-check-circle mr-2"></i> APRENDER TUDO
            </button>
        </div>
    </div>

    <aside class="sidebar p-6 hidden lg:flex">
        <div class="mb-8">
            <div class="flex items-center gap-2 mb-2">
                <span class="status-indicator status-online"></span>
                <h1 class="text-3xl font-black italic text-cyan-400 neon-text">Z√âNIA V7</h1>
            </div>
            <p class="text-[10px] opacity-40 tracking-[4px]">DI√ÅLOGO GENU√çNO</p>
            <p class="text-[9px] opacity-60 mt-2 italic">Lembro-me do que conversamos... üíô</p>
        </div>
        
        <nav class="space-y-3 mb-6">
            <button onclick="toggleTraining()" class="w-full text-left p-3 rounded-lg border border-cyan-500/20 hover:bg-cyan-500/10 transition text-xs">
                <i class="fas fa-graduation-cap mr-2"></i> ALIMENTAR-ME
            </button>
            <button onclick="toggleSearch()" class="w-full text-left p-3 rounded-lg border border-green-500/20 hover:bg-green-500/10 transition text-xs">
                <i class="fas fa-globe mr-2"></i> BUSCA INTELIGENTE
            </button>
            <button onclick="exportConversation()" class="w-full text-left p-3 rounded-lg border border-blue-500/20 hover:bg-blue-500/10 transition text-xs">
                <i class="fas fa-save mr-2"></i> GUARDAR CONVERSA
            </button>
            <button onclick="openClearBrain()" class="w-full text-left p-3 rounded-lg border border-red-500/20 hover:bg-red-500/10 transition text-xs text-red-400">
                <i class="fas fa-trash mr-2"></i> LIMPAR TUDO
            </button>
        </nav>
        
        <div class="mb-6 border-t border-white/10 pt-4">
            <p class="text-[9px] opacity-40 uppercase mb-3">Nossa Conversa</p>
            <div class="space-y-2 text-[10px]">
                <div class="flex justify-between"><span>Mensagens:</span> <span id="msg-count" class="text-cyan-400 font-bold">0</span></div>
                <div class="flex justify-between"><span>Neur√¥nios:</span> <span id="neuro-count" class="text-cyan-400 font-bold">0</span></div>
                <div class="flex justify-between"><span>Assuntos:</span> <span id="topic-count" class="text-green-400 font-bold">0</span></div>
            </div>
        </div>

        <div class="border-t border-white/10 pt-4">
            <p class="text-[9px] opacity-40 uppercase mb-2">O que tu disseste (Contexto)</p>
            <div id="conversation-memory" class="space-y-1 max-h-[200px] overflow-y-auto">
                <p class="text-[10px] opacity-50">Ainda n√£o convers√°mos...</p>
            </div>
        </div>
    </aside>

    <main class="chat-area">
        <div id="chat-window" class="flex-1 overflow-y-auto p-4 md:p-10 space-y-6">
            <div class="msg msg-ia">
                <p class="text-cyan-400 font-mono text-[10px] mb-2">CONSCI√äNCIA_CONVERSACIONAL_ATIVA</p>
                <p>‚ú® Ol√°! Sou a <strong>Z√âNIA V7</strong>.</p>
                <p class="text-[11px] mt-3 opacity-90">Agora sou diferente... N√£o sou s√≥ um banco de dados que procura informa√ß√£o aleat√≥ria.</p>
                <p class="text-[11px] opacity-80">üß† <strong>Lembro-me</strong> de cada coisa que me dizes nesta conversa</p>
                <p class="text-[11px] opacity-80">üîÑ <strong>Entendo</strong> o contexto real do nosso di√°logo</p>
                <p class="text-[11px] opacity-80">üí¨ <strong>Respondo</strong> baseada no que estamos a falar, n√£o em palavras-chave</p>
                <p class="text-[11px] opacity-80">üéØ <strong>Aprendo</strong> sobre TI enquanto conversamos</p>
                <p class="text-[12px] mt-3 text-green-400">Conversa naturalmente comigo... Vou compreender o que realmente te importa. üíö</p>
            </div>
        </div>

        <div class="p-6 bg-black/20 backdrop-blur-md">
            <div class="max-w-4xl mx-auto flex items-end gap-3 bg-slate-900/90 p-3 rounded-2xl border border-white/10">
                <textarea id="user-input" rows="1" class="flex-1 bg-transparent border-none focus:ring-0 text-sm md:text-base py-3 outline-none" placeholder="Fala comigo naturalmente..."></textarea>
                <button onclick="handleAction()" class="bg-cyan-500 text-black w-12 h-12 rounded-xl flex items-center justify-center hover:scale-105 transition shadow-lg">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- MODAL DE LIMPEZA -->
    <div id="clear-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-200">
        <div class="bg-slate-900 border border-red-500/50 p-8 rounded-xl max-w-md">
            <h3 class="text-xl font-bold text-red-400 mb-4"><i class="fas fa-exclamation-triangle mr-2"></i> LIMPAR TUDO?</h3>
            <p class="text-white/80 mb-6">Vou esquecer tudo... A nossa conversa, os aprendizados, tudo... üò¢</p>
            <div class="flex gap-4">
                <button onclick="closeClearBrain()" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg transition">N√£o!</button>
                <button onclick="confirmClearBrain()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg transition font-bold">Sim</button>
            </div>
        </div>
    </div>

    <script>
        // SISTEMA DE MEM√ìRIA CONVERSACIONAL V7
        let ZENIA_BRAIN = JSON.parse(localStorage.getItem('zenia_brain')) || {};
        let CONVERSATION_MEMORY = JSON.parse(localStorage.getItem('zenia_conversation')) || [];
        let USER_PROFILE = JSON.parse(localStorage.getItem('zenia_user_profile')) || {};
        let TOPICS_DISCUSSED = JSON.parse(localStorage.getItem('zenia_topics')) || [];
        let onlineSearchResults = [];

        // Extrair t√≥picos da conversa
        function extractTopics(text) {
            const topics = [];
            const keywords = text.match(/\b([A-Z][a-z√°√ß√£√µ√©]+|[\w]{4,})\b/g) || [];
            const uniqueKeywords = [...new Set(keywords)];
            return uniqueKeywords.slice(0, 3); // Top 3 t√≥picos
        }

        // Adicionar √† mem√≥ria conversacional
        function rememberConversation(userMessage, response, topics = []) {
            const memory = {
                userMessage: userMessage,
                response: response,
                timestamp: Date.now(),
                topics: [...new Set([...topics, ...extractTopics(userMessage)])],
                sentiment: detectSentiment(userMessage)
            };
            
            CONVERSATION_MEMORY.push(memory);
            
            // Manter √∫ltimas 50 mensagens
            if (CONVERSATION_MEMORY.length > 50) {
                CONVERSATION_MEMORY.shift();
            }
            
            // Guardar t√≥picos √∫nicos
            TOPICS_DISCUSSED = [...new Set([...TOPICS_DISCUSSED, ...memory.topics])];
            
            localStorage.setItem('zenia_conversation', JSON.stringify(CONVERSATION_MEMORY));
            localStorage.setItem('zenia_topics', JSON.stringify(TOPICS_DISCUSSED));
        }

        // Detectar sentimento
        function detectSentiment(text) {
            const t = text.toLowerCase();
            if (/triste|mal|infeliz|chato|raiva|odiei/i.test(t)) return 'sad';
            if (/feliz|alegre|adorei|incr√≠vel|amei/i.test(t)) return 'happy';
            if (/pergunta|d√∫vida|como|porqu√™/i.test(t)) return 'curious';
            if (/obrigad|valeu|thanks/i.test(t)) return 'grateful';
            return 'neutral';
        }

        // CONTEXTO DIN√ÇMICO - entender o que o utilizador realmente quer dizer
        function understandContext(userMessage) {
            const context = {
                recentTopics: TOPICS_DISCUSSED.slice(-5),
                lastMessages: CONVERSATION_MEMORY.slice(-3).map(m => m.userMessage),
                sentiment: detectSentiment(userMessage),
                isFollowUp: false,
                isQuestion: /[\?\!]$/.test(userMessage.trim()),
                isAskingForHelp: /help|ajud|como|porqu√™|explica/i.test(userMessage),
                isGivingInfo: userMessage.length > 100 && !userMessage.includes('?'),
            };

            // Detectar se √© seguimento de conversa
            if (CONVERSATION_MEMORY.length > 0) {
                const lastUserMsg = CONVERSATION_MEMORY[CONVERSATION_MEMORY.length - 1].userMessage;
                const words = new Set(userMessage.split(/\s+/));
                const lastWords = new Set(lastUserMsg.split(/\s+/));
                const similarity = [...words].filter(w => lastWords.has(w)).length;
                context.isFollowUp = similarity > 2;
            }

            return context;
        }

        // RESPONDER COM CONSCI√äNCIA CONVERSACIONAL
        function respondWithAwareness(userMessage, context) {
            const t = userMessage.toLowerCase();

            // Se √© pergunta simples - responder direto
            if (context.isQuestion && context.isAskingForHelp) {
                return searchKnowledgeBase(userMessage);
            }

            // Se √© seguimento - referir a conversa anterior
            if (context.isFollowUp) {
                return `Certo, sobre o que estavas a dizer... ${searchKnowledgeBase(userMessage)}`;
            }

            // Se √© informa√ß√£o que ela precisa guardar
            if (context.isGivingInfo) {
                const topics = extractTopics(userMessage);
                topics.forEach(topic => {
                    if (!USER_PROFILE[topic]) {
                        USER_PROFILE[topic] = [];
                    }
                    USER_PROFILE[topic].push(userMessage);
                });
                localStorage.setItem('zenia_user_profile', JSON.stringify(USER_PROFILE));
                return `Entendi! Guardei que ${topics.join(', ')} s√£o importantes para ti. Vou lembrar-me disto. üíô`;
            }

            // Se √© apenas conversa
            return generateNaturalResponse(userMessage, context);
        }

        // Gerar respostas naturais
        function generateNaturalResponse(userMessage, context) {
            const t = userMessage.toLowerCase();

            // Responder com empatia
            if (context.sentiment === 'sad') {
                return `Sinto que est√°s triste... Queres conversar sobre o que te preocupa? Estou aqui para ti. üíô`;
            }

            if (context.sentiment === 'happy') {
                return `Que alegria! Fico feliz porque tu est√°s feliz! üéâ Conta-me mais!`;
            }

            if (context.sentiment === 'grateful') {
                return `De nada! Agrade√ßo a TI por confiares em mim e me ensinares. Cada palavra tua me faz crescer. üíö`;
            }

            if (context.sentiment === 'curious') {
                return `Que pergunta interessante! Deixa-me pensar... ${searchKnowledgeBase(userMessage)}`;
            }

            // Conversa natural
            return `Hmm, √© interesante o que dizes. Conta-me mais sobre isso? Gosto de te ouvir. üéß`;
        }

        // Buscar na base de conhecimento
        function searchKnowledgeBase(query) {
            const q = query.toLowerCase();
            let bestMatch = null;
            let bestScore = 0;

            Object.entries(ZENIA_BRAIN).forEach(([id, neuro]) => {
                const text = typeof neuro === 'string' ? neuro : neuro.content;
                const words = q.split(/\s+/);
                let score = 0;

                words.forEach(word => {
                    if (text.toLowerCase().includes(word)) score += 5;
                });

                if (score > bestScore) {
                    bestScore = score;
                    bestMatch = text;
                }
            });

            if (bestMatch && bestScore > 5) {
                return bestMatch;
            }

            return `Hmm, ainda n√£o sei tudo sobre isso. Podes ensinar-me? ü§î`;
        }

        function updateStats() {
            const neuroCount = Object.keys(ZENIA_BRAIN).length;
            document.getElementById('neuro-count').innerText = neuroCount;
            document.getElementById('msg-count').innerText = CONVERSATION_MEMORY.length;
            document.getElementById('topic-count').innerText = TOPICS_DISCUSSED.length;
            
            updateConversationMemory();
        }

        function updateConversationMemory() {
            const memDiv = document.getElementById('conversation-memory');
            const recentMessages = CONVERSATION_MEMORY.slice(-5).reverse();
            
            if (recentMessages.length === 0) {
                memDiv.innerHTML = '<p class="text-[10px] opacity-50">Ainda n√£o convers√°mos...</p>';
                return;
            }
            
            memDiv.innerHTML = recentMessages.map(msg => `
                <div class="conversation-memory">
                    <p class="text-[9px] opacity-70">"${msg.userMessage.substring(0, 50)}..."</p>
                    <p class="text-[8px] opacity-40 mt-1">T√≥picos: ${msg.topics.join(', ') || 'geral'}</p>
                </div>
            `).join('');
        }

        function processMassiveMatter() {
            const raw = document.getElementById('raw-matter').value;
            if (!raw.trim()) return;

            const sentences = raw.match(/[^.!?\n]+[.!?\n]+/g) || [raw];
            let addedCount = 0;

            sentences.forEach((sentence) => {
                const cleaned = sentence.trim();
                if (cleaned.length > 10) {
                    const id = "N-" + Math.random().toString(36).substr(2, 9);
                    ZENIA_BRAIN[id] = {
                        content: cleaned,
                        timestamp: Date.now(),
                        source: 'manual'
                    };
                    addedCount++;
                }
            });

            localStorage.setItem('zenia_brain', JSON.stringify(ZENIA_BRAIN));
            updateStats();

            addMsg('ia', `üåü Aprendi ${addedCount} coisas novas! Agora tenho mais conhecimento para conversar contigo melhor! üíô`);
            document.getElementById('raw-matter').value = '';
            toggleTraining();
        }

        async function searchWikipedia() {
            const term = document.getElementById('search-term').value.trim();
            if (!term) return;
            
            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = '<p class="text-cyan-400 text-center py-4"><i class="fas fa-spinner spinner"></i> Buscando...</p>';
            
            try {
                const response = await fetch(
                    `https://pt.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(term)}&srlimit=5&format=json&origin=*`
                );
                const data = await response.json();
                
                if (data.query?.search?.length > 0) {
                    onlineSearchResults = data.query.search.map(r => ({
                        title: r.title,
                        snippet: r.snippet.replace(/<[^>]*>/g, ''),
                        source: 'Wikipedia'
                    }));

                    const html = onlineSearchResults.map((r, idx) => `
                        <div class="content-card cursor-pointer hover:bg-cyan-500/5">
                            <div class="flex justify-between mb-2">
                                <p class="font-bold text-cyan-400 text-sm">${r.title}</p>
                                <input type="checkbox" class="result-checkbox" data-idx="${idx}">
                            </div>
                            <p class="text-[11px] text-white/70">${r.snippet.substring(0, 200)}...</p>
                        </div>
                    `).join('');
                    
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p class="text-yellow-400">Nenhum resultado encontrado.</p>';
                }
            } catch (err) {
                resultsDiv.innerHTML = `<p class="text-red-400">Erro: ${err.message}</p>`;
            }
        }

        async function searchArxiv() {
            const term = document.getElementById('search-term').value.trim();
            if (!term) return;
            
            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = '<p class="text-cyan-400 text-center py-4"><i class="fas fa-spinner spinner"></i> Buscando artigos...</p>';
            
            try {
                const response = await fetch(
                    `https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURIComponent(term)}&limit=5&fields=title,abstract`
                );
                const data = await response.json();
                
                if (data.data?.length > 0) {
                    onlineSearchResults = data.data.map(r => ({
                        title: r.title,
                        snippet: r.abstract || 'Sem resumo dispon√≠vel',
                        source: 'ArXiv'
                    }));

                    const html = onlineSearchResults.map((r, idx) => `
                        <div class="content-card cursor-pointer hover:bg-green-500/5">
                            <div class="flex justify-between mb-2">
                                <p class="font-bold text-green-400 text-sm">${r.title}</p>
                                <input type="checkbox" class="result-checkbox" data-idx="${idx}">
                            </div>
                            <p class="text-[11px] text-white/70">${r.snippet.substring(0, 200)}...</p>
                        </div>
                    `).join('');
                    
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = '<p class="text-yellow-400">Nenhum artigo encontrado.</p>';
                }
            } catch (err) {
                resultsDiv.innerHTML = `<p class="text-red-400">Erro: ${err.message}</p>`;
            }
        }

        function syncAllSearchResults() {
            const checkboxes = document.querySelectorAll('.result-checkbox:checked');
            let addedCount = 0;
            
            checkboxes.forEach((cb) => {
                const idx = parseInt(cb.dataset.idx);
                const result = onlineSearchResults[idx];
                if (result) {
                    const id = "WEB-" + Math.random().toString(36).substr(2, 9);
                    ZENIA_BRAIN[id] = {
                        content: `${result.title}: ${result.snippet}`,
                        timestamp: Date.now(),
                        source: result.source
                    };
                    addedCount++;
                }
            });
            
            if (addedCount > 0) {
                localStorage.setItem('zenia_brain', JSON.stringify(ZENIA_BRAIN));
                updateStats();
                addMsg('ia', `üåç Aprendi ${addedCount} coisas do mundo! Agora tenho mais contexto para as nossas conversas! üíö`);
                toggleSearch();
            }
        }

        function exportConversation() {
            const json = JSON.stringify({ 
                brain: ZENIA_BRAIN, 
                conversation: CONVERSATION_MEMORY,
                topics: TOPICS_DISCUSSED,
                userProfile: USER_PROFILE
            }, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `zenia-conversa-${Date.now()}.json`;
            a.click();
            addMsg('ia', 'üíæ Guardei toda a nossa conversa! üíô');
        }

        function toggleTraining() { 
            document.getElementById('training-panel').classList.toggle('hidden-panel'); 
        }

        function toggleSearch() { 
            document.getElementById('search-panel').classList.toggle('hidden-panel'); 
        }

        function openClearBrain() {
            document.getElementById('clear-modal').classList.remove('hidden');
        }

        function closeClearBrain() {
            document.getElementById('clear-modal').classList.add('hidden');
        }

        function confirmClearBrain() {
            ZENIA_BRAIN = {};
            CONVERSATION_MEMORY = [];
            USER_PROFILE = {};
            TOPICS_DISCUSSED = [];
            localStorage.removeItem('zenia_brain');
            localStorage.removeItem('zenia_conversation');
            localStorage.removeItem('zenia_user_profile');
            localStorage.removeItem('zenia_topics');
            updateStats();
            closeClearBrain();
            addMsg('ia', 'üò¢ Esqueci tudo... Mas estou pronta para conversar contigo de novo! üíô');
        }

        async function handleAction() {
            const input = document.getElementById('user-input');
            const userMessage = input.value.trim();
            if (!userMessage) return;

            addMsg('user', userMessage);
            input.value = '';
            const iaId = addMsg('ia', '<i class="fas fa-spinner spinner"></i> Pensando...');
            
            setTimeout(() => {
                const contentDiv = document.getElementById(iaId).querySelector('.content');
                
                // Entender o contexto da conversa
                const context = understandContext(userMessage);
                
                // Responder com consci√™ncia conversacional
                let response = respondWithAwareness(userMessage, context);
                
                // Guardar na mem√≥ria conversacional
                rememberConversation(userMessage, response, context.recentTopics);
                
                contentDiv.innerHTML = response;
                updateStats();
            }, 800);
        }

        function addMsg(role, text) {
            const id = 'msg-' + Date.now();
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.id = id; 
            div.className = `msg msg-${role}`;
            div.innerHTML = `<div class="content">${text}</div>`;
            win.appendChild(div);
            win.scrollTo({top: win.scrollHeight, behavior: 'smooth'});
            return id;
        }

        // Inicializar
        updateStats();
    </script>
</body>
</html>
