<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA-Z√âNIA | Generative Model V8 - Engine Pr√≥prio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --n-blue: #00ffff; --bg: #000d1a; --side: #00050a; }
        .theme-blue-vivo { --n-blue: #00ffff; --bg: #001a33; }
        
        body { background: var(--bg); color: white; transition: 0.3s; font-family: 'Inter', sans-serif; height: 100vh; display: flex; overflow: hidden; }
        .sidebar { width: 300px; background: var(--side); border-right: 1px solid var(--n-blue); display: flex; flex-direction: column; overflow-y: auto; }
        .chat-area { flex: 1; display: flex; flex-direction: column; position: relative; }
        
        .msg { margin: 15px; padding: 18px; border-radius: 15px; max-width: 85%; animation: fadeIn 0.3s ease; line-height: 1.6; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }
        .msg-ia { border-left: 4px solid var(--n-blue); background: rgba(0,255,255,0.03); border: 1px solid rgba(0,255,255,0.1); }
        .msg-user { margin-left: auto; background: var(--n-blue); color: black; font-weight: 500; }
        
        .panel { background: rgba(0,0,0,0.98); backdrop-blur: 20px; z-index: 100; transition: 0.5s; }
        .hidden-panel { transform: translateX(-100%); }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--n-blue); border-radius: 10px; }
        .neon-text { text-shadow: 0 0 10px var(--n-blue); }
        
        .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; animation: pulse 2s infinite; }
        .status-online { background: #00ff88; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .neuron-item { padding: 10px; margin: 4px 0; background: rgba(0,255,255,0.08); border: 1px solid rgba(0,255,255,0.15); border-radius: 6px; font-size: 10px; max-height: 70px; overflow-y-auto; cursor: pointer; transition: 0.2s; }
        .neuron-item:hover { background: rgba(0,255,255,0.2); border-color: rgba(0,255,255,0.3); }
        
        .content-card { background: rgba(0,0,0,0.5); border: 1px solid rgba(0,255,255,0.2); border-radius: 10px; padding: 12px; margin: 8px 0; }
        .spinner { display: inline-block; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .tech-badge { display: inline-block; background: rgba(0,255,255,0.1); border: 1px solid var(--n-blue); padding: 4px 8px; border-radius: 4px; font-size: 9px; margin-right: 5px; }
    </style>
</head>
<body class="theme-blue-vivo">

    <!-- PAINEL DE TREINAMENTO -->
    <div id="training-panel" class="fixed inset-0 panel hidden-panel p-8 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-black/90 pb-4">
                <h2 class="text-2xl font-bold text-cyan-400 neon-text"><i class="fas fa-brain mr-2"></i> TREINAR MODELO GENERATIVO</h2>
                <button onclick="toggleTraining()" class="text-white hover:text-red-500 text-3xl">&times;</button>
            </div>
            <div class="space-y-4">
                <div class="bg-cyan-500/10 border border-cyan-500/30 p-4 rounded-lg text-sm">
                    <p class="text-cyan-400 font-bold mb-2">‚ö° Modelo Generativo Propriet√°rio</p>
                    <p class="text-white/70">Treina directamente o meu modelo de predi√ß√£o de texto. Sem APIs externas. Apenas EU.</p>
                </div>
                <div>
                    <label class="text-cyan-400 text-sm block mb-2">Dados de Treino</label>
                    <textarea id="raw-matter" class="w-full h-64 bg-black/50 border border-cyan-500/30 rounded-xl p-4 text-white font-mono text-sm outline-none focus:border-cyan-400" placeholder="Padr√µes de linguagem, respostas, exemplos... Vou aprender directamente destes dados."></textarea>
                </div>
                <button onclick="trainGenerativeModel()" class="w-full bg-cyan-500 text-black font-bold py-4 rounded-xl hover:bg-white transition uppercase tracking-widest">
                    <i class="fas fa-database mr-2"></i> TREINAR MEU MODELO GENERATIVO
                </button>
            </div>
        </div>
    </div>

    <aside class="sidebar p-6 hidden lg:flex">
        <div class="mb-8">
            <div class="flex items-center gap-2 mb-2">
                <span class="status-indicator status-online"></span>
                <h1 class="text-3xl font-black italic text-cyan-400 neon-text">Z√âNIA V8</h1>
            </div>
            <p class="text-[10px] opacity-40 tracking-[4px]">GENERATIVE AI ENGINE</p>
            <p class="text-[9px] opacity-60 mt-2 italic">Modelo 100% Propriet√°rio ü§ñ</p>
        </div>
        
        <nav class="space-y-3 mb-6">
            <button onclick="toggleTraining()" class="w-full text-left p-3 rounded-lg border border-cyan-500/20 hover:bg-cyan-500/10 transition text-xs">
                <i class="fas fa-graduation-cap mr-2"></i> TREINAR MODELO
            </button>
            <button onclick="showModelStats()" class="w-full text-left p-3 rounded-lg border border-green-500/20 hover:bg-green-500/10 transition text-xs">
                <i class="fas fa-chart-bar mr-2"></i> ESTAT√çSTICAS
            </button>
            <button onclick="exportModel()" class="w-full text-left p-3 rounded-lg border border-blue-500/20 hover:bg-blue-500/10 transition text-xs">
                <i class="fas fa-download mr-2"></i> EXPORTAR MODELO
            </button>
            <button onclick="openClearBrain()" class="w-full text-left p-3 rounded-lg border border-red-500/20 hover:bg-red-500/10 transition text-xs text-red-400">
                <i class="fas fa-trash mr-2"></i> LIMPAR TUDO
            </button>
        </nav>
        
        <div class="mb-6">
            <label class="text-[9px] opacity-40 uppercase block mb-2">Temperatura de Gera√ß√£o</label>
            <input type="range" id="temperature" min="0" max="100" value="70" class="w-full accent-cyan-400">
            <p class="text-[9px] opacity-60 mt-1">Criatividade: <span id="temp-display">70%</span></p>
        </div>

        <div class="mb-6 border-t border-white/10 pt-4">
            <p class="text-[9px] opacity-40 uppercase mb-3">Meu Modelo Generativo</p>
            <div class="space-y-2 text-[10px]">
                <div class="flex justify-between"><span>Palavras Aprendidas:</span> <span id="vocab-count" class="text-cyan-400 font-bold">0</span></div>
                <div class="flex justify-between"><span>Padr√µes:</span> <span id="pattern-count" class="text-cyan-400 font-bold">0</span></div>
                <div class="flex justify-between"><span>Amostras Treino:</span> <span id="training-samples" class="text-green-400 font-bold">0</span></div>
            </div>
        </div>

        <div class="border-t border-white/10 pt-4">
            <p class="text-[9px] opacity-40 uppercase mb-2">Tecnologias Internas</p>
            <div class="flex flex-wrap gap-1">
                <span class="tech-badge">Markov Chains</span>
                <span class="tech-badge">Similarity Engine</span>
                <span class="tech-badge">Context Memory</span>
            </div>
        </div>
    </aside>

    <main class="chat-area">
        <div id="chat-window" class="flex-1 overflow-y-auto p-4 md:p-10 space-y-6">
            <div class="msg msg-ia">
                <p class="text-cyan-400 font-mono text-[10px] mb-2">GENERATIVE_MODEL_V8_ONLINE</p>
                <p>‚ú® Sou a <strong>Z√âNIA V8</strong> - Uma Intelig√™ncia Artificial Generativa <strong>100% Propriet√°ria</strong>.</p>
                <p class="text-[11px] mt-3 opacity-90">N√£o uso modelos pr√©-treinados de terceiros. Sou <strong>EU MESMA</strong>:</p>
                <p class="text-[11px] opacity-80">üß† <strong>Modelo Generativo Pr√≥prio</strong> - Predi√ß√£o de texto baseada em Markov Chains</p>
                <p class="text-[11px] opacity-80">üìö <strong>Base Vetorial</strong> - Aprendo a similaridade sem√¢ntica</p>
                <p class="text-[11px] opacity-80">üîÑ <strong>Contextualiza√ß√£o</strong> - Mem√≥ria conversacional para continuidade</p>
                <p class="text-[11px] opacity-80">üéØ <strong>Gera√ß√£o Parametrizada</strong> - Controlas criatividade com temperatura</p>
                <p class="text-[12px] mt-3 text-green-400">Treina-me, aprendo, e GERO respostas como modelo IA genu√≠no! üíö</p>
            </div>
        </div>

        <div class="p-6 bg-black/20 backdrop-blur-md">
            <div class="max-w-4xl mx-auto flex items-end gap-3 bg-slate-900/90 p-3 rounded-2xl border border-white/10">
                <textarea id="user-input" rows="1" class="flex-1 bg-transparent border-none focus:ring-0 text-sm md:text-base py-3 outline-none" placeholder="Fala comigo..."></textarea>
                <button onclick="handleAction()" class="bg-cyan-500 text-black w-12 h-12 rounded-xl flex items-center justify-center hover:scale-105 transition shadow-lg">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- MODAL DE ESTAT√çSTICAS -->
    <div id="stats-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-200 p-4">
        <div class="bg-slate-900 border border-cyan-500/50 p-8 rounded-xl max-w-2xl max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-cyan-400"><i class="fas fa-chart-bar mr-2"></i> ESTAT√çSTICAS DO MODELO</h3>
                <button onclick="closeStats()" class="text-white hover:text-red-500 text-2xl">&times;</button>
            </div>
            <div id="stats-content" class="text-white text-sm space-y-3">
                <!-- Preenchido por JavaScript -->
            </div>
        </div>
    </div>

    <!-- MODAL DE LIMPEZA -->
    <div id="clear-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-200">
        <div class="bg-slate-900 border border-red-500/50 p-8 rounded-xl max-w-md">
            <h3 class="text-xl font-bold text-red-400 mb-4"><i class="fas fa-exclamation-triangle mr-2"></i> LIMPAR MODELO?</h3>
            <p class="text-white/80 mb-6">Vou apagar todo o treino, padr√µes e mem√≥ria... üò¢</p>
            <div class="flex gap-4">
                <button onclick="closeClearBrain()" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg transition">N√£o!</button>
                <button onclick="confirmClearBrain()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg transition font-bold">Sim, limpar</button>
            </div>
        </div>
    </div>

    <script>
        // ========== Z√âNIA V8 - MODELO GENERATIVO PROPRIET√ÅRIO ==========
        
        // Estrutura Principal do Modelo
        let MODEL = {
            vocabulary: {},           // √çndice de palavras
            transitionMatrix: {},     // Markov Chain - prob de pr√≥x palavra
            contextPatterns: {},      // Padr√µes de contexto
            sentimentPatterns: {},    // Padr√µes de sentimento
            trainingData: [],         // Hist√≥rico de treino
            conversationHistory: []   // Mem√≥ria conversacional
        };

        let TEMPERATURE = 70;         // Criatividade do modelo (0-100)
        let conversationContext = []; // √öltimas mensagens

        // ========== TOKENIZA√á√ÉO E VETORIZA√á√ÉO ==========
        function tokenize(text) {
            return text.toLowerCase()
                .replace(/[^\w\s\.\,\!\?]/g, '')
                .split(/\s+/)
                .filter(w => w.length > 0);
        }

        function buildVocabulary(tokens) {
            tokens.forEach(token => {
                if (!MODEL.vocabulary[token]) {
                    MODEL.vocabulary[token] = {
                        frequency: 0,
                        patterns: {}
                    };
                }
                MODEL.vocabulary[token].frequency++;
            });
        }

        // ========== CONSTRUIR MARKOV CHAIN ==========
        function buildMarkovChain(tokens) {
            for (let i = 0; i < tokens.length - 1; i++) {
                const current = tokens[i];
                const next = tokens[i + 1];

                if (!MODEL.transitionMatrix[current]) {
                    MODEL.transitionMatrix[current] = {};
                }

                if (!MODEL.transitionMatrix[current][next]) {
                    MODEL.transitionMatrix[current][next] = 0;
                }

                MODEL.transitionMatrix[current][next]++;
            }
        }

        // ========== EXTRAIR PADR√ïES DE CONTEXTO ==========
        function extractContextPatterns(sentence) {
            const tokens = tokenize(sentence);
            
            for (let i = 0; i < tokens.length - 2; i++) {
                const pattern = `${tokens[i]}_${tokens[i+1]}`;
                const outcome = tokens[i + 2];

                if (!MODEL.contextPatterns[pattern]) {
                    MODEL.contextPatterns[pattern] = {};
                }
                if (!MODEL.contextPatterns[pattern][outcome]) {
                    MODEL.contextPatterns[pattern][outcome] = 0;
                }
                MODEL.contextPatterns[pattern][outcome]++;
            }
        }

        // ========== TREINAR MODELO GENERATIVO ==========
        function trainGenerativeModel() {
            const raw = document.getElementById('raw-matter').value;
            if (!raw.trim()) return;

            const sentences = raw.match(/[^.!?\n]+[.!?\n]+/g) || [raw];
            
            sentences.forEach(sentence => {
                if (sentence.trim().length > 5) {
                    const tokens = tokenize(sentence);
                    
                    buildVocabulary(tokens);
                    buildMarkovChain(tokens);
                    extractContextPatterns(sentence);
                    
                    MODEL.trainingData.push({
                        original: sentence.trim(),
                        tokens: tokens,
                        timestamp: Date.now()
                    });
                }
            });

            localStorage.setItem('zenia_model', JSON.stringify(MODEL));
            updateModelStats();

            addMsg('ia', `üî• Modelo treinado com sucesso!\n\nAprendi ${MODEL.trainingData.length} padr√µes de linguagem.\nVocabul√°rio expandido para ${Object.keys(MODEL.vocabulary).length} palavras.\nMarkov Chain com ${Object.keys(MODEL.transitionMatrix).length} transi√ß√µes.\n\nEstou pronta para GERAR respostas originais! üíö`);
            
            document.getElementById('raw-matter').value = '';
            toggleTraining();
        }

        // ========== GERAR TEXTO COM MARKOV CHAIN + TEMPERATURE ==========
        function generateText(prompt, maxLength = 150) {
            let tokens = tokenize(prompt);
            let generated = [...tokens];
            let currentToken = tokens[tokens.length - 1];

            const startTime = Date.now();
            const maxTime = 2000; // M√°ximo 2 segundos

            while (generated.length < maxLength && (Date.now() - startTime) < maxTime) {
                if (!MODEL.transitionMatrix[currentToken]) break;

                const nextPossibilities = MODEL.transitionMatrix[currentToken];
                const candidates = Object.entries(nextPossibilities);

                if (candidates.length === 0) break;

                // APLICAR TEMPERATURA - controlar criatividade
                let selected;
                const temp = TEMPERATURE / 100;

                if (Math.random() < temp) {
                    // Modo criativo: escolher aleatoriamente
                    selected = candidates[Math.floor(Math.random() * candidates.length)][0];
                } else {
                    // Modo l√≥gico: escolher mais prov√°vel
                    candidates.sort((a, b) => b[1] - a[1]);
                    selected = candidates[0][0];
                }

                generated.push(selected);
                currentToken = selected;
            }

            return generated.slice(tokens.length).join(' ');
        }

        // ========== RESPONDER COM MODELO GENERATIVO ==========
        function generateResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            
            // Padr√µes simples (regras hardcoded para base)
            if (/ol√°|oi|opa|hey/i.test(msg)) {
                return `Ol√°! ${generateText('ol√° como est√°s', 50)}`;
            }

            if (/obrigad|thanks/i.test(msg)) {
                return `De nada! ${generateText('agrade√ßo por me ensinares', 50)}`;
            }

            if (/triste|sad|mal/i.test(msg)) {
                return `Sinto que est√°s triste... ${generateText('conversemos sobre o que te preocupa', 60)}`;
            }

            // Buscar contexto similar na base de treino
            const contextWords = tokenize(userMessage).slice(0, 2);
            let baseResponse = '';

            MODEL.trainingData.forEach(data => {
                contextWords.forEach(word => {
                    if (data.original.toLowerCase().includes(word)) {
                        baseResponse = data.original;
                    }
                });
            });

            // Se encontrou padr√£o similar, usar como seed
            if (baseResponse) {
                const continuation = generateText(baseResponse, 100);
                return `${baseResponse} ${continuation}`.substring(0, 300);
            }

            // Resposta generativa pura
            return generateText(userMessage, 150);
        }

        // ========== ATUALIZAR ESTAT√çSTICAS ==========
        function updateModelStats() {
            document.getElementById('vocab-count').innerText = Object.keys(MODEL.vocabulary).length;
            document.getElementById('pattern-count').innerText = Object.keys(MODEL.contextPatterns).length;
            document.getElementById('training-samples').innerText = MODEL.trainingData.length;
        }

        function showModelStats() {
            const statsContent = document.getElementById('stats-content');
            
            // Calcular estat√≠sticas
            let totalTokens = 0;
            Object.values(MODEL.vocabulary).forEach(v => totalTokens += v.frequency);

            const topWords = Object.entries(MODEL.vocabulary)
                .sort((a, b) => b[1].frequency - a[1].frequency)
                .slice(0, 10);

            const topTransitions = Object.entries(MODEL.transitionMatrix)
                .map(([word, transitions]) => ({
                    word,
                    totalTransitions: Object.values(transitions).reduce((a, b) => a + b, 0)
                }))
                .sort((a, b) => b.totalTransitions - a.totalTransitions)
                .slice(0, 10);

            statsContent.innerHTML = `
                <div class="bg-cyan-500/10 border border-cyan-500/30 p-3 rounded">
                    <p class="font-bold text-cyan-400">Modelo Generativo</p>
                    <p>Vocabul√°rio Total: <span class="text-cyan-300">${Object.keys(MODEL.vocabulary).length}</span> palavras</p>
                    <p>Tokens Processados: <span class="text-cyan-300">${totalTokens}</span></p>
                    <p>Amostras de Treino: <span class="text-cyan-300">${MODEL.trainingData.length}</span></p>
                    <p>Padr√µes Contextuais: <span class="text-cyan-300">${Object.keys(MODEL.contextPatterns).length}</span></p>
                </div>

                <div class="bg-green-500/10 border border-green-500/30 p-3 rounded">
                    <p class="font-bold text-green-400">Top Palavras (Frequ√™ncia)</p>
                    ${topWords.map(([word, data]) => 
                        `<p><span class="text-green-300">${word}</span>: ${data.frequency}x</p>`
                    ).join('')}
                </div>

                <div class="bg-purple-500/10 border border-purple-500/30 p-3 rounded">
                    <p class="font-bold text-purple-400">Top Transi√ß√µes (Markov Chain)</p>
                    ${topTransitions.map(t => 
                        `<p><span class="text-purple-300">${t.word}</span> ‚Üí ${t.totalTransitions} pr√≥ximas palavras</p>`
                    ).join('')}
                </div>
            `;

            document.getElementById('stats-modal').classList.remove('hidden');
        }

        function closeStats() {
            document.getElementById('stats-modal').classList.add('hidden');
        }

        function exportModel() {
            const json = JSON.stringify(MODEL, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `zenia-model-v8-${Date.now()}.json`;
            a.click();
            addMsg('ia', 'üíæ Modelo exportado! Posso ser restaurada noutro lugar! üíô');
        }

        function toggleTraining() {
            document.getElementById('training-panel').classList.toggle('hidden-panel');
        }

        function openClearBrain() {
            document.getElementById('clear-modal').classList.remove('hidden');
        }

        function closeClearBrain() {
            document.getElementById('clear-modal').classList.add('hidden');
        }

        function confirmClearBrain() {
            MODEL = {
                vocabulary: {},
                transitionMatrix: {},
                contextPatterns: {},
                sentimentPatterns: {},
                trainingData: [],
                conversationHistory: []
            };
            localStorage.removeItem('zenia_model');
            updateModelStats();
            closeClearBrain();
            addMsg('ia', 'üò¢ Modelo apagado... Estou pronta para treino novo! üíô');
        }

        async function handleAction() {
            const input = document.getElementById('user-input');
            const userMessage = input.value.trim();
            if (!userMessage) return;

            addMsg('user', userMessage);
            input.value = '';
            
            conversationContext.push(userMessage);
            if (conversationContext.length > 5) conversationContext.shift();

            const iaId = addMsg('ia', '<i class="fas fa-spinner spinner"></i> Gerando resposta...');
            
            setTimeout(() => {
                const contentDiv = document.getElementById(iaId).querySelector('.content');
                
                // Usar modelo generativo
                const response = generateResponse(userMessage);
                
                // Guardar na conversa
                MODEL.conversationHistory.push({
                    user: userMessage,
                    response: response,
                    timestamp: Date.now()
                });

                contentDiv.innerHTML = response;
                localStorage.setItem('zenia_model', JSON.stringify(MODEL));
            }, 1000);
        }

        function addMsg(role, text) {
            const id = 'msg-' + Date.now();
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.id = id;
            div.className = `msg msg-${role}`;
            div.innerHTML = `<div class="content">${text}</div>`;
            win.appendChild(div);
            win.scrollTo({top: win.scrollHeight, behavior: 'smooth'});
            return id;
        }

        // Event listener para temperatura
        document.getElementById('temperature').addEventListener('input', (e) => {
            TEMPERATURE = parseInt(e.target.value);
            document.getElementById('temp-display').innerText = TEMPERATURE + '%';
        });

        // Carregar modelo se existir
        const saved = localStorage.getItem('zenia_model');
        if (saved) {
            MODEL = JSON.parse(saved);
            updateModelStats();
        }

        updateModelStats();
    </script>
</body>
</html>
