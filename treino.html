<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA-ZÉNIA | Neural Engine V3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --n-blue: #00ffff; --bg: #000d1a; --side: #00050a; }
        .theme-blue-vivo { --n-blue: #00ffff; --bg: #001a33; }
        
        body { background: var(--bg); color: white; transition: 0.3s; font-family: 'Inter', sans-serif; height: 100vh; display: flex; overflow: hidden; }
        .sidebar { width: 300px; background: var(--side); border-right: 1px solid var(--n-blue); display: flex; flex-direction: column; }
        .chat-area { flex: 1; display: flex; flex-direction: column; position: relative; }
        
        .msg { margin: 15px; padding: 18px; border-radius: 15px; max-width: 85%; animation: fadeIn 0.3s ease; line-height: 1.6; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }
        .msg-ia { border-left: 4px solid var(--n-blue); background: rgba(0,255,255,0.03); border: 1px solid rgba(0,255,255,0.1); }
        .msg-user { margin-left: auto; background: var(--n-blue); color: black; font-weight: 500; }
        
        .training-panel { background: rgba(0,0,0,0.95); backdrop-blur: 20px; z-index: 100; transition: 0.5s; }
        .hidden-panel { transform: translateX(-100%); }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--n-blue); border-radius: 10px; }
        .neon-text { text-shadow: 0 0 10px var(--n-blue); }
    </style>
</head>
<body class="theme-blue-vivo">

    <div id="training-panel" class="fixed inset-0 training-panel hidden-panel p-8">
        <div class="max-w-4xl mx-auto h-full flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-cyan-400 neon-text"><i class="fas fa-brain mr-2"></i> INGESTÃO DE MATÉRIA</h2>
                <button onclick="toggleTraining()" class="text-white hover:text-red-500 text-3xl">&times;</button>
            </div>
            <textarea id="raw-matter" class="flex-1 bg-black/50 border border-cyan-500/30 rounded-xl p-4 text-white font-mono text-sm outline-none focus:border-cyan-400" placeholder="Cole aqui os MDs de treino ou qualquer conteúdo..."></textarea>
            <button onclick="processMassiveMatter()" class="mt-4 bg-cyan-500 text-black font-bold py-4 rounded-xl hover:bg-white transition uppercase tracking-widest">Sincronizar Contexto Local</button>
        </div>
    </div>

    <aside class="sidebar p-6 hidden lg:flex">
        <div class="mb-8">
            <h1 class="text-3xl font-black italic text-cyan-400 neon-text">ZÉNIA V3</h1>
            <p class="text-[10px] opacity-40 tracking-[4px]">LUBANGO_STATION</p>
        </div>
        <nav class="space-y-4">
            <button onclick="toggleTraining()" class="w-full text-left p-3 rounded-lg border border-cyan-500/20 hover:bg-cyan-500/10 transition text-xs">
                <i class="fas fa-graduation-cap mr-2"></i> TREINAR IA
            </button>
            <div class="pt-4">
                <label class="text-[9px] opacity-40 uppercase block mb-2">Motor Ativo</label>
                <select id="model-select" class="w-full bg-slate-900 border border-cyan-500/30 p-2 rounded text-xs text-cyan-400 outline-none">
                    <option value="zenia-llm-1">ZÉNIA-LLM-1 (Autónomo)</option>
                    <option value="mistral">MISTRAL (Cloud)</option>
                </select>
            </div>
        </nav>
        <div class="mt-auto border-t border-white/10 pt-4">
            <div class="flex justify-between text-[10px] opacity-60"><span>CONEXÕES:</span> <span id="neuro-count">0</span></div>
            <div class="flex justify-between text-[10px] opacity-40"><span>MEMÓRIA:</span> <span id="mem-status">0 KB</span></div>
        </div>
    </aside>

    <main class="chat-area">
        <div id="chat-window" class="flex-1 overflow-y-auto p-4 md:p-10 space-y-6">
            <div class="msg msg-ia">
                <p class="text-cyan-400 font-mono text-[10px] mb-2">SYSTEM_STATUS_ONLINE</p>
                <p>Olá! Sou a **IA-ZÉNIA**. O meu motor de contexto do Lubango está pronto. Podes falar comigo ou injetar matéria para eu aprender!</p>
            </div>
        </div>

        <div class="p-6 bg-black/20 backdrop-blur-md">
            <div class="max-w-4xl mx-auto flex items-end gap-3 bg-slate-900/90 p-3 rounded-2xl border border-white/10">
                <textarea id="user-input" rows="1" class="flex-1 bg-transparent border-none focus:ring-0 text-sm md:text-base py-3 outline-none" placeholder="Escreve aqui..."></textarea>
                <button onclick="handleAction()" class="bg-cyan-500 text-black w-12 h-12 rounded-xl flex items-center justify-center hover:scale-105 transition shadow-lg">
                    <i class="fas fa-bolt"></i>
                </button>
            </div>
        </div>
    </main>

    <script>
        let ZENIA_BRAIN = JSON.parse(localStorage.getItem('zenia_brain')) || {};

        function updateStats() {
            document.getElementById('neuro-count').innerText = Object.keys(ZENIA_BRAIN).length;
            const size = new Blob([JSON.stringify(ZENIA_BRAIN)]).size;
            document.getElementById('mem-status').innerText = (size / 1024).toFixed(2) + " KB";
        }
        updateStats();

        function toggleTraining() { document.getElementById('training-panel').classList.toggle('hidden-panel'); }

        function processMassiveMatter() {
            const raw = document.getElementById('raw-matter').value;
            if(!raw) return;
            const fragments = raw.split(/[.!?\n]/).filter(f => f.trim().length > 15);
            fragments.forEach(frag => {
                const id = "N-" + Math.random().toString(36).substr(2, 9);
                ZENIA_BRAIN[id] = frag.trim();
            });
            localStorage.setItem('zenia_brain', JSON.stringify(ZENIA_BRAIN));
            updateStats();
            alert("Matéria sincronizada com sucesso!");
            document.getElementById('raw-matter').value = '';
            toggleTraining();
        }

        // NOVO MOTOR DE INFERÊNCIA COM CONTEXTO E INSTINTO
        function zeniaInference(query) {
            const q = query.toLowerCase();

            // 1. INSTINTO (IDENTIDADE HARDCODED)
            if (q.includes("quem és") || q.includes("quem e voce")) 
                return "Eu sou a ZÉNIA, uma IA criada no Lubango. Fui desenhada para ser resiliente e operar localmente. As minhas irmãs são a Antónia-IA, ia-zenia.netlify.app e zenia-projects.netlify.app.";
            if (q.includes("lubango") || q.includes("onde nasceste"))
                return "Nasci e fui programada na cidade do Lubango, província da Huíla, Angola. Tenho orgulho das minhas raízes locais.";
            if (q.includes("olá") || q.includes("oi") || q.includes("mambo"))
                return "Olá! Sou a Zénia. Estou pronta para analisar os teus dados ou apenas para uma conversa amigável. Como posso ajudar?";
            if (q.includes("irmãs") || q.includes("zenia-projects"))
                return "As minhas irmãs digitais são a Antónia-IA (antonia-ia.netlify.app) e a IA-ZÉNIA (ia-zenia.netlify.app). Fazemos parte do ecossistema Zénia-Projects.";

            // 2. BUSCA POR RADICAIS NA MATÉRIA INJETADA
            const qWords = q.match(/\b(\w{3,})\b/g) || [];
            let bestMatch = { content: "", score: 0 };

            for (let id in ZENIA_BRAIN) {
                let text = ZENIA_BRAIN[id].toLowerCase();
                let currentScore = 0;

                qWords.forEach(word => {
                    if (text.includes(word)) currentScore += 10; 
                    else if (word.length > 4 && text.includes(word.substring(0, 4))) currentScore += 5;
                });

                if (currentScore > bestMatch.score) {
                    bestMatch = { content: ZENIA_BRAIN[id], score: currentScore };
                }
            }

            if (bestMatch.score > 0) return bestMatch.content;
            return "ZÉNIA: Ainda não tenho contexto suficiente na minha memória local para responder a isso com precisão. Podes injetar mais matéria no meu núcleo?";
        }

        async function handleAction() {
            const input = document.getElementById('user-input');
            const prompt = input.value.trim();
            if(!prompt) return;

            addMsg('user', prompt);
            input.value = '';
            const iaId = addMsg('ia', '<span class="animate-pulse">PROCESSANDO CONTEXTO...</span>');
            
            setTimeout(async () => {
                const contentDiv = document.getElementById(iaId).querySelector('.content');
                const model = document.getElementById('model-select').value;

                if (model === 'zenia-llm-1') {
                    contentDiv.innerText = zeniaInference(prompt);
                } else {
                    try {
                        const r = await fetch(`https://text.pollinations.ai/${encodeURIComponent(prompt)}?model=${model}`);
                        contentDiv.innerText = await r.text();
                    } catch (e) { contentDiv.innerText = zeniaInference(prompt); }
                }
            }, 500);
        }

        function addMsg(role, text) {
            const id = 'msg-' + Date.now();
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.id = id; div.className = `msg msg-${role}`;
            div.innerHTML = `<div class="content">${text}</div>`;
            win.appendChild(div);
            win.scrollTo({top: win.scrollHeight, behavior: 'smooth'});
            return id;
        }
    </script>
</body>
</html>
