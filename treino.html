<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lubango AI - LobeStyle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f0f0f; color: #e5e5e5; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .chat-container { height: calc(100vh - 180px); overflow-y: auto; }
        .user-msg { background: #2563eb; color: white; align-self: flex-end; }
        .ai-msg { background: #262626; align-self: flex-start; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col h-screen">

    <header class="p-4 border-b border-white/10 flex justify-between items-center glass">
        <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
            Lubango AI <span class="text-xs font-light text-gray-400">v1.0</span>
        </h1>
        <div id="status" class="text-xs text-yellow-500 font-mono">Carregando motor local...</div>
    </header>

    <main class="flex-1 p-4 md:p-8 flex flex-col gap-4 chat-container" id="chat">
        <div class="ai-msg p-4 rounded-2xl max-w-[80%]">
            Olá! Sou uma IA inspirada no projeto LobeHub, rodando 100% no seu navegador. 
            Como minhas irmãs <b>IA-ZÉNIA</b> e <b>Antónia</b>, fui concebida para ajudar. 
            <br><small class="opacity-50">(Nota: O primeiro carregamento pode demorar, pois baixarei o modelo para seu cache local).</small>
        </div>
    </main>

    <footer class="p-4 bg-transparent">
        <div class="max-w-4xl mx-auto flex gap-2 p-2 rounded-2xl glass">
            <input type="text" id="userInput" placeholder="Digite sua mensagem..." 
                class="bg-transparent flex-1 p-3 outline-none border-none focus:ring-0">
            <button id="sendBtn" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-xl transition-all font-medium disabled:opacity-50">
                Enviar
            </button>
        </div>
        <p class="text-[10px] text-center mt-2 text-gray-500">
            Powered by WebLLM • Inspirado por LobeHub • Lubango, Angola
        </p>
    </footer>

    <script type="module">
        import * as webllm from "https://esm.run/@mlc-ai/web-llm";

        const chatContainer = document.getElementById('chat');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const status = document.getElementById('status');

        // Configuração do Modelo (Llama-3-8B-q4f32_1-MLC)
        const selectedModel = "Llama-3-8B-Instruct-v0.2-q4f16_1-MLC";
        
        const engine = new webllm.MLCEngine();

        engine.setInitProgressCallback((report) => {
            status.textContent = report.text;
        });

        async function initChat() {
            try {
                await engine.reload(selectedModel);
                status.textContent = "● Pronto (Local)";
                status.classList.replace('text-yellow-500', 'text-green-500');
            } catch (e) {
                status.textContent = "Erro: WebGPU não suportado";
                console.error(e);
            }
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            // Interface
            appendMessage(text, 'user-msg');
            userInput.value = '';
            const aiDiv = appendMessage('...', 'ai-msg');
            
            // Lógica de Resposta
            const messages = [{ role: "user", content: text }];
            let fullReply = "";
            
            const chunks = await engine.chat.completions.create({
                messages,
                stream: true,
            });

            for await (const chunk of chunks) {
                const content = chunk.choices[0]?.delta?.content || "";
                fullReply += content;
                aiDiv.innerHTML = fullReply;
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }

        function appendMessage(text, className) {
            const div = document.createElement('div');
            div.className = `${className} p-4 rounded-2xl max-w-[80%] animate-pulse`;
            div.innerHTML = text;
            chatContainer.appendChild(div);
            div.classList.remove('animate-pulse');
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return div;
        }

        sendBtn.onclick = sendMessage;
        userInput.onkeypress = (e) => { if(e.key === 'Enter') sendMessage(); };

        // Inicializa
        initChat();
    </script>
</body>
</html>
