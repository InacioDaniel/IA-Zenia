<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA-Z√âNIA | Self-Correction & Deep Reasoning V10</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --n-blue: #00ffff; --bg: #000d1a; --side: #00050a; }
        .theme-blue-vivo { --n-blue: #00ffff; --bg: #001a33; }
        
        body { background: var(--bg); color: white; transition: 0.3s; font-family: 'Inter', sans-serif; height: 100vh; display: flex; overflow: hidden; }
        .sidebar { width: 320px; background: var(--side); border-right: 1px solid var(--n-blue); display: flex; flex-direction: column; overflow-y: auto; }
        .chat-area { flex: 1; display: flex; flex-direction: column; position: relative; }
        
        .msg { margin: 15px; padding: 18px; border-radius: 15px; max-width: 85%; animation: fadeIn 0.3s ease; line-height: 1.6; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } }
        .msg-ia { border-left: 4px solid var(--n-blue); background: rgba(0,255,255,0.03); border: 1px solid rgba(0,255,255,0.1); }
        .msg-user { margin-left: auto; background: var(--n-blue); color: black; font-weight: 500; }
        
        .panel { background: rgba(0,0,0,0.98); backdrop-blur: 20px; z-index: 100; transition: 0.5s; }
        .hidden-panel { transform: translateX(-100%); }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--n-blue); border-radius: 10px; }
        .neon-text { text-shadow: 0 0 10px var(--n-blue); }
        
        .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; animation: pulse 2s infinite; }
        .status-online { background: #00ff88; }
        .status-thinking { background: #ffaa00; animation: pulse 0.5s infinite; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .reasoning-box { 
            background: rgba(255,170,0,0.08);
            border: 1px solid rgba(255,170,0,0.3);
            border-radius: 8px;
            padding: 10px;
            margin: 8px 0;
            font-size: 11px;
            font-family: monospace;
        }

        .correction-box {
            background: rgba(100,255,100,0.08);
            border-left: 3px solid rgba(100,255,100,0.5);
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            font-size: 11px;
        }

        .thought-chain {
            background: rgba(0,255,255,0.05);
            border: 1px dashed rgba(0,255,255,0.2);
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 10px;
        }

        .tech-badge { display: inline-block; background: rgba(0,255,255,0.1); border: 1px solid var(--n-blue); padding: 4px 8px; border-radius: 4px; font-size: 9px; margin-right: 5px; }
    </style>
</head>
<body class="theme-blue-vivo">

    <!-- PAINEL DE RACIOC√çNIO -->
    <div id="reasoning-panel" class="fixed inset-0 panel hidden-panel p-8 overflow-y-auto">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-6 sticky top-0 bg-black/90 pb-4">
                <h2 class="text-2xl font-bold text-cyan-400 neon-text"><i class="fas fa-brain mr-2"></i> CONFIGURAR RACIOC√çNIO</h2>
                <button onclick="toggleReasoning()" class="text-white hover:text-red-500 text-3xl">&times;</button>
            </div>
            
            <div class="space-y-4">
                <div class="bg-cyan-500/10 border border-cyan-500/30 p-4 rounded-lg">
                    <p class="text-cyan-400 font-bold mb-2">üß† Sistema de Self-Correction Propriet√°rio</p>
                    <p class="text-white/70">Racioc√≠nio multi-n√≠vel com verifica√ß√£o autom√°tica, corre√ß√£o interna e an√°lise de coer√™ncia.</p>
                </div>

                <div>
                    <label class="text-cyan-400 text-sm block mb-2">Modo de Racioc√≠nio</label>
                    <select id="reasoning-mode" class="w-full bg-black/50 border border-cyan-500/30 rounded-lg p-3 text-white">
                        <option value="fast">‚ö° R√°pido (Sem an√°lise profunda)</option>
                        <option value="balanced">‚öñÔ∏è Equilibrado (Recomendado)</option>
                        <option value="deep" selected>üß† Profundo (Self-Correction completo)</option>
                    </select>
                </div>

                <div>
                    <label class="text-cyan-400 text-sm block mb-2">N√≠vel de Auto-Cr√≠tica</label>
                    <input type="range" id="criticism-level" min="0" max="100" value="70" class="w-full accent-cyan-400">
                    <p class="text-white/60 text-xs mt-1">Quanto mais alto, mais ela questiona suas pr√≥prias respostas</p>
                </div>

                <div>
                    <label class="text-cyan-400 text-sm block mb-2">Mostrar Processo de Racioc√≠nio</label>
                    <div class="flex gap-2">
                        <input type="checkbox" id="show-reasoning" checked>
                        <label for="show-reasoning" class="text-white/70 text-sm">Quero ver como ela pensa</label>
                    </div>
                </div>

                <button onclick="applyReasoningSettings()" class="w-full bg-cyan-500 text-black font-bold py-3 rounded-xl hover:bg-white transition">
                    <i class="fas fa-check mr-2"></i> APLICAR CONFIGURA√á√ïES
                </button>
            </div>
        </div>
    </div>

    <aside class="sidebar p-6 hidden lg:flex">
        <div class="mb-8">
            <div class="flex items-center gap-2 mb-2">
                <span class="status-indicator" id="status-light"></span>
                <h1 class="text-3xl font-black italic text-cyan-400 neon-text">Z√âNIA V10</h1>
            </div>
            <p class="text-[10px] opacity-40 tracking-[4px]">SELF-CORRECTION ENGINE</p>
            <p class="text-[9px] opacity-60 mt-2 italic">Pensa, verifica, corrige... üß†</p>
        </div>
        
        <nav class="space-y-3 mb-6">
            <button onclick="toggleReasoning()" class="w-full text-left p-3 rounded-lg border border-cyan-500/20 hover:bg-cyan-500/10 transition text-xs">
                <i class="fas fa-sliders-h mr-2"></i> RACIOC√çNIO
            </button>
            <button onclick="showThinkingProcess()" class="w-full text-left p-3 rounded-lg border border-green-500/20 hover:bg-green-500/10 transition text-xs">
                <i class="fas fa-eye mr-2"></i> PROCESSO
            </button>
            <button onclick="exportReasoning()" class="w-full text-left p-3 rounded-lg border border-blue-500/20 hover:bg-blue-500/10 transition text-xs">
                <i class="fas fa-download mr-2"></i> EXPORTAR
            </button>
        </nav>
        
        <div class="mb-6 border-t border-white/10 pt-4">
            <p class="text-[9px] opacity-40 uppercase mb-3">Estado Cognitivo</p>
            <div class="space-y-2 text-[10px]">
                <div class="flex justify-between"><span>Modo:</span> <span id="reasoning-mode-display" class="text-cyan-400 font-bold">Profundo</span></div>
                <div class="flex justify-between"><span>Auto-Cr√≠tica:</span> <span id="criticism-display" class="text-cyan-400 font-bold">70%</span></div>
                <div class="flex justify-between"><span>Corre√ß√µes:</span> <span id="correction-count" class="text-green-400 font-bold">0</span></div>
                <div class="flex justify-between"><span>Valida√ß√µes:</span> <span id="validation-count" class="text-cyan-400 font-bold">0</span></div>
            </div>
        </div>

        <div class="border-t border-white/10 pt-4">
            <p class="text-[9px] opacity-40 uppercase mb-2">√öltimas Corre√ß√µes</p>
            <div id="correction-log" class="space-y-1 max-h-[150px] overflow-y-auto text-[9px]">
                <p class="opacity-50">Nenhuma corre√ß√£o ainda...</p>
            </div>
        </div>
    </aside>

    <main class="chat-area">
        <div id="chat-window" class="flex-1 overflow-y-auto p-4 md:p-10 space-y-6">
            <div class="msg msg-ia">
                <p class="text-cyan-400 font-mono text-[10px] mb-2">SELF_CORRECTION_V10_ONLINE</p>
                <p>‚ú® Sou a <strong>Z√âNIA V10</strong> - Com <strong>Racioc√≠nio de Alto N√≠vel Propriet√°rio</strong>.</p>
                <p class="text-[11px] mt-3 opacity-90">Agora tenho um sistema de corre√ß√£o interna genu√≠na:</p>
                <p class="text-[11px] opacity-80">üß† <strong>Racioc√≠nio Multi-N√≠vel</strong> - Penso antes de responder</p>
                <p class="text-[11px] opacity-80">‚úÖ <strong>Auto-Verifica√ß√£o</strong> - Verifico minhas respostas automaticamente</p>
                <p class="text-[11px] opacity-80">üîÑ <strong>Self-Correction</strong> - Corrijo-me quando detecto inconsist√™ncias</p>
                <p class="text-[11px] opacity-80">üí≠ <strong>An√°lise de Coer√™ncia</strong> - Garanto que fa√ßo sentido</p>
                <p class="text-[12px] mt-3 text-green-400">Pensa comigo... V√™ como penso e me corrijo! üíö</p>
            </div>
        </div>

        <div class="p-6 bg-black/20 backdrop-blur-md">
            <div class="max-w-4xl mx-auto flex items-end gap-3 bg-slate-900/90 p-3 rounded-2xl border border-white/10">
                <textarea id="user-input" rows="1" class="flex-1 bg-transparent border-none focus:ring-0 text-sm md:text-base py-3 outline-none" placeholder="Fala comigo..."></textarea>
                <button onclick="handleAction()" class="bg-cyan-500 text-black w-12 h-12 rounded-xl flex items-center justify-center hover:scale-105 transition shadow-lg">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- MODAL DE PROCESSO -->
    <div id="process-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-200 p-4">
        <div class="bg-slate-900 border border-cyan-500/50 p-8 rounded-xl max-w-3xl max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-cyan-400"><i class="fas fa-network-wired mr-2"></i> PROCESSO DE RACIOC√çNIO</h3>
                <button onclick="closeProcess()" class="text-white hover:text-red-500 text-2xl">&times;</button>
            </div>
            <div id="process-content" class="text-white text-sm space-y-3">
                <!-- Preenchido por JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // ========== Z√âNIA V10 - SELF-CORRECTION & RACIOC√çNIO ==========
        
        let REASONING_ENGINE = {
            thoughtChains: [],
            corrections: [],
            validations: [],
            confidenceScores: {},
            inconsistencies: [],
            correctionHistory: [],
            lastThinking: null
        };

        let REASONING_CONFIG = {
            mode: 'deep', // fast, balanced, deep
            criticismLevel: 70,
            showReasoning: true,
            enableSelfCorrection: true
        };

        // ========== EXTRAIR CONCEITOS E RELA√á√ïES ==========
        function extractConcepts(text) {
            const words = text.toLowerCase().split(/\s+/);
            const concepts = {};
            
            for (let i = 0; i < words.length; i++) {
                const word = words[i].replace(/[^\w]/g, '');
                if (word.length > 3) {
                    if (!concepts[word]) {
                        concepts[word] = { frequency: 0, connections: [] };
                    }
                    concepts[word].frequency++;
                    
                    if (i > 0) {
                        const prevWord = words[i-1].replace(/[^\w]/g, '');
                        if (prevWord.length > 3) {
                            concepts[word].connections.push(prevWord);
                        }
                    }
                }
            }
            
            return concepts;
        }

        // ========== AN√ÅLISE DE COER√äNCIA ==========
        function analyzeCoherence(response, context) {
            const issues = [];
            const concepts = extractConcepts(response);
            const contextConcepts = extractConcepts(context);

            // Verificar contradi√ß√µes l√≥gicas
            const negationWords = ['n√£o', 'nunca', 'jamais'];
            const affirmationWords = ['sim', 'sempre', 'certamente'];

            let hasNegation = false;
            let hasAffirmation = false;

            negationWords.forEach(word => {
                if (response.toLowerCase().includes(word)) hasNegation = true;
            });
            affirmationWords.forEach(word => {
                if (response.toLowerCase().includes(word)) hasAffirmation = true;
            });

            if (hasNegation && hasAffirmation) {
                // Verificar se s√£o sobre o mesmo t√≥pico
                const negationIndex = response.toLowerCase().search(negationWords.join('|'));
                const affirmationIndex = response.toLowerCase().search(affirmationWords.join('|'));
                
                if (Math.abs(negationIndex - affirmationIndex) < 50) {
                    issues.push('Poss√≠vel contradi√ß√£o: afirma√ß√£o e nega√ß√£o muito pr√≥ximas');
                }
            }

            // Verificar relev√¢ncia do contexto
            let relevanceScore = 0;
            Object.keys(concepts).forEach(concept => {
                if (contextConcepts[concept]) {
                    relevanceScore++;
                }
            });

            return {
                issues: issues,
                relevanceScore: relevanceScore / Math.max(Object.keys(concepts).length, 1),
                coherenceScore: Math.max(0, 100 - (issues.length * 20))
            };
        }

        // ========== VALIDA√á√ÉO MULTI-N√çVEL ==========
        function validateResponse(response, userMessage) {
            const validation = {
                timestamp: Date.now(),
                passes: [],
                fails: [],
                score: 0
            };

            // Valida√ß√£o 1: Comprimento apropriado
            if (response.length > 20) {
                validation.passes.push('‚úì Comprimento apropriado');
            } else {
                validation.fails.push('‚úó Resposta muito curta');
            }

            // Valida√ß√£o 2: Cont√©m conceitos relacionados ao contexto
            const contextWords = userMessage.toLowerCase().split(/\s+/).slice(0, 5);
            let contextMatch = 0;
            contextWords.forEach(word => {
                if (response.toLowerCase().includes(word)) {
                    contextMatch++;
                }
            });

            if (contextMatch > 0) {
                validation.passes.push(`‚úì Relevante ao contexto (${contextMatch} conex√µes)`);
            } else {
                validation.fails.push('‚úó Pouca relev√¢ncia ao contexto');
            }

            // Valida√ß√£o 3: Coer√™ncia l√≥gica
            const coherence = analyzeCoherence(response, userMessage);
            if (coherence.coherenceScore > 60) {
                validation.passes.push('‚úì Logicamente coerente');
            } else if (coherence.issues.length > 0) {
                validation.fails.push(`‚úó ${coherence.issues[0]}`);
            }

            // Valida√ß√£o 4: Sem repeti√ß√£o excessiva
            const words = response.split(/\s+/);
            const uniqueWords = new Set(words);
            const repetitionRatio = uniqueWords.size / words.length;
            
            if (repetitionRatio > 0.6) {
                validation.passes.push('‚úì Vocabul√°rio variado');
            } else {
                validation.fails.push('‚úó Repeti√ß√£o excessiva');
            }

            // Calcular score
            validation.score = (validation.passes.length / (validation.passes.length + validation.fails.length)) * 100;

            return validation;
        }

        // ========== SELF-CORRECTION ==========
        function attemptSelfCorrection(originalResponse, userMessage, validationResult) {
            if (validationResult.score > 70 || REASONING_CONFIG.mode === 'fast') {
                return {
                    corrected: false,
                    response: originalResponse,
                    reason: 'Valida√ß√£o aceita'
                };
            }

            const correction = {
                original: originalResponse,
                corrected: originalResponse,
                issues: validationResult.fails,
                changes: [],
                confidence: 0
            };

            // Tentar corrigir based em issues
            if (validationResult.fails.some(f => f.includes('curta'))) {
                correction.corrected += ` Deixa-me elaborar melhor: ${generateImprovedResponse(userMessage)}`;
                correction.changes.push('Expandida com mais detalhe');
            }

            if (validationResult.fails.some(f => f.includes('contexto'))) {
                const contextWords = userMessage.split(/\s+/).slice(0, 3).join(' ');
                correction.corrected = `Relativamente a "${contextWords}": ${correction.corrected}`;
                correction.changes.push('Contextualizada melhor');
            }

            if (validationResult.fails.some(f => f.includes('Repeti√ß√£o'))) {
                correction.corrected = improveVariety(correction.corrected);
                correction.changes.push('Variada linguagem');
            }

            correction.confidence = Math.min(100, 50 + (correction.changes.length * 15));

            return correction;
        }

        // ========== GERAR RESPOSTA MELHORADA ==========
        function generateImprovedResponse(userMessage) {
            const words = userMessage.split(/\s+/);
            const mainTopic = words[0];
            
            const templates = [
                `Especificamente sobre ${mainTopic}, √© importante notar que`,
                `Considerando ${mainTopic}, podemos dizer que`,
                `Uma an√°lise mais profunda de ${mainTopic} revela que`,
                `Relativamente a ${mainTopic}, a perspectiva √© que`
            ];

            const template = templates[Math.floor(Math.random() * templates.length)];
            return template + ` h√° m√∫ltiplas dimens√µes a considerar...`;
        }

        function improveVariety(text) {
            const words = text.split(/\s+/);
            const seen = new Set();
            let improved = [];

            words.forEach((word, index) => {
                if (seen.has(word.toLowerCase()) && index > words.length / 2) {
                    // Tentar substituir por sin√≥nimo
                    const synonyms = {
                        '√©': 'constitui',
                        'tem': 'possui',
                        'pode': 'consegue',
                        'faz': 'realiza'
                    };
                    improved.push(synonyms[word.toLowerCase()] || word);
                } else {
                    improved.push(word);
                }
                seen.add(word.toLowerCase());
            });

            return improved.join(' ');
        }

        // ========== RACIOC√çNIO PROFUNDO ==========
        function deepThinking(userMessage) {
            const thinking = {
                question: userMessage,
                stages: [],
                finalResponse: '',
                confidenceScore: 0,
                corrections: []
            };

            // Est√°gio 1: Parsing da pergunta
            thinking.stages.push({
                stage: 'Parsing',
                action: 'Analisar pergunta',
                result: `Pergunta detectada: "${userMessage.substring(0, 50)}..."`
            });

            // Est√°gio 2: Extrair conceitos
            const concepts = extractConcepts(userMessage);
            thinking.stages.push({
                stage: 'Extra√ß√£o de Conceitos',
                action: 'Identificar palavras-chave',
                result: `${Object.keys(concepts).length} conceitos identificados`
            });

            // Est√°gio 3: Gerar resposta candidata
            const baseResponse = generateText(userMessage);
            thinking.stages.push({
                stage: 'Gera√ß√£o de Resposta',
                action: 'Criar resposta candidata',
                result: `Resposta de ${baseResponse.split(/\s+/).length} palavras gerada`
            });

            // Est√°gio 4: Valida√ß√£o
            const validation = validateResponse(baseResponse, userMessage);
            thinking.stages.push({
                stage: 'Valida√ß√£o',
                action: 'Verificar coer√™ncia e relev√¢ncia',
                result: `Score: ${validation.score.toFixed(1)}% - ${validation.passes.length} passes, ${validation.fails.length} falhas`
            });

            // Est√°gio 5: Self-Correction
            const correction = attemptSelfCorrection(baseResponse, userMessage, validation);
            if (correction.corrected !== baseResponse) {
                thinking.stages.push({
                    stage: 'Self-Correction',
                    action: 'Detectar e corrigir problemas',
                    result: `${correction.changes.join(', ')} (Confian√ßa: ${correction.confidence.toFixed(0)}%)`
                });
                thinking.corrections.push(correction);
            }

            thinking.finalResponse = correction.corrected;
            thinking.confidenceScore = validation.score;

            REASONING_ENGINE.lastThinking = thinking;
            REASONING_ENGINE.correctionHistory.push(correction);
            if (REASONING_ENGINE.correctionHistory.length > 20) {
                REASONING_ENGINE.correctionHistory.shift();
            }

            return thinking;
        }

        // ========== GERA√á√ÉO DE TEXTO ==========
        function generateText(prompt, maxLength = 150) {
            const templates = [
                `A respeito de "${prompt.substring(0, 30)}", √© relevante considerar que`,
                `Quando pensamos em "${prompt.substring(0, 30)}", devemos notar que`,
                `${prompt.substring(0, 30).charAt(0).toUpperCase() + prompt.substring(1, 30)} implica em diversos aspetos`,
                `Analisando "${prompt.substring(0, 30)}", encontramos que`
            ];

            const base = templates[Math.floor(Math.random() * templates.length)];
            const extensions = [
                ' h√° m√∫ltiplas perspectivas v√°lidas.',
                ' o contexto √© fundamental para compreender.',
                ' a complexidade √© maior do que aparenta.',
                ' diferentes abordagens s√£o poss√≠veis.'
            ];

            return base + extensions[Math.floor(Math.random() * extensions.length)];
        }

        // ========== INTERFACE E UPDATES ==========
        function applyReasoningSettings() {
            REASONING_CONFIG.mode = document.getElementById('reasoning-mode').value;
            REASONING_CONFIG.criticismLevel = parseInt(document.getElementById('criticism-level').value);
            REASONING_CONFIG.showReasoning = document.getElementById('show-reasoning').checked;

            document.getElementById('reasoning-mode-display').innerText = 
                REASONING_CONFIG.mode === 'fast' ? 'R√°pido' : 
                REASONING_CONFIG.mode === 'balanced' ? 'Equilibrado' : 'Profundo';
            document.getElementById('criticism-display').innerText = REASONING_CONFIG.criticismLevel + '%';

            toggleReasoning();
            addMsg('ia', `‚úÖ Configura√ß√µes aplicadas!\n\nüìä Modo: ${REASONING_CONFIG.mode}\nüéØ Auto-Cr√≠tica: ${REASONING_CONFIG.criticismLevel}%\nüìã Mostrar Processo: ${REASONING_CONFIG.showReasoning ? 'Sim' : 'N√£o'}`);
        }

        function showThinkingProcess() {
            if (!REASONING_ENGINE.lastThinking) {
                addMsg('ia', 'üí≠ Ainda n√£o tenho um processo de racioc√≠nio para mostrar. Faz-me uma pergunta!');
                return;
            }

            const thinking = REASONING_ENGINE.lastThinking;
            const processContent = document.getElementById('process-content');

            processContent.innerHTML = `
                <div class="bg-cyan-500/10 border border-cyan-500/30 p-3 rounded">
                    <p class="font-bold text-cyan-400">Pergunta Analisada</p>
                    <p>"${thinking.question.substring(0, 100)}..."</p>
                </div>

                <div class="bg-purple-500/10 border border-purple-500/30 p-3 rounded">
                    <p class="font-bold text-purple-400">Est√°gios de Racioc√≠nio</p>
                    ${thinking.stages.map(s => `
                        <div class="thought-chain">
                            <p class="font-bold text-purple-300">${s.stage}</p>
                            <p class="text-purple-200">${s.action}</p>
                            <p class="text-purple-400/70">‚Üí ${s.result}</p>
                        </div>
                    `).join('')}
                </div>

                ${thinking.corrections.length > 0 ? `
                    <div class="bg-green-500/10 border border-green-500/30 p-3 rounded">
                        <p class="font-bold text-green-400">Corre√ß√µes Realizadas</p>
                        ${thinking.corrections.map(c => `
                            <div class="correction-box">
                                <p class="text-green-300">Altera√ß√µes: ${c.changes.join(', ')}</p>
                                <p class="text-green-400/70">Confian√ßa: ${c.confidence.toFixed(0)}%</p>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                <div class="bg-blue-500/10 border border-blue-500/30 p-3 rounded">
                    <p class="font-bold text-blue-400">Score de Confian√ßa Final</p>
                    <p class="text-blue-300">${thinking.confidenceScore.toFixed(1)}%</p>
                </div>
            `;

            document.getElementById('process-modal').classList.remove('hidden');
        }

        function closeProcess() {
            document.getElementById('process-modal').classList.add('hidden');
        }

        function toggleReasoning() {
            document.getElementById('reasoning-panel').classList.toggle('hidden-panel');
        }

        function exportReasoning() {
            const json = JSON.stringify(REASONING_ENGINE, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `zenia-reasoning-${Date.now()}.json`;
            a.click();
            addMsg('ia', 'üíæ Processo de racioc√≠nio exportado! üíô');
        }

        function updateCorrectionLog() {
            const logDiv = document.getElementById('correction-log');
            const corrections = REASONING_ENGINE.correctionHistory.slice(-5);

            if (corrections.length === 0) {
                logDiv.innerHTML = '<p class="opacity-50">Nenhuma corre√ß√£o ainda...</p>';
                return;
            }

            logDiv.innerHTML = corrections.reverse().map(c => `
                <div style="background: rgba(100,255,100,0.1); padding: 5px; border-radius: 4px; margin: 3px 0;">
                    <p class="text-green-400 font-bold text-[9px]">${c.changes.join(', ')}</p>
                    <p class="text-green-300/70 text-[8px]">Conf: ${c.confidence.toFixed(0)}%</p>
                </div>
            `).join('');

            document.getElementById('correction-count').innerText = REASONING_ENGINE.correctionHistory.length;
        }

        async function handleAction() {
            const input = document.getElementById('user-input');
            const userMessage = input.value.trim();
            if (!userMessage) return;

            addMsg('user', userMessage);
            input.value = '';
            
            const iaId = addMsg('ia', '<i class="fas fa-spinner spinner"></i> Pensando profundamente...');
            
            setTimeout(() => {
                document.getElementById('status-light').className = 'status-indicator status-thinking';

                setTimeout(() => {
                    const contentDiv = document.getElementById(iaId).querySelector('.content');
                    
                    // Executar racioc√≠nio baseado no modo
                    let response = '';
                    if (REASONING_CONFIG.mode === 'deep') {
                        const thinking = deepThinking(userMessage);
                        response = thinking.finalResponse;
                        
                        if (REASONING_CONFIG.showReasoning) {
                            response += `\n\n<div class="reasoning-box">
                                <strong>üìä Processo de Racioc√≠nio:</strong>
                                <br>Est√°gios: ${thinking.stages.length} | Corre√ß√µes: ${thinking.corrections.length} | Confian√ßa: ${thinking.confidenceScore.toFixed(1)}%
                                <br><span class="text-cyan-300/60">[Clica em "Processo" na barra lateral para ver detalhes]</span>
                            </div>`;
                        }
                    } else if (REASONING_CONFIG.mode === 'balanced') {
                        const thinking = deepThinking(userMessage);
                        response = thinking.finalResponse;
                    } else {
                        response = generateText(userMessage);
                    }

                    contentDiv.innerHTML = response;
                    updateCorrectionLog();
                    document.getElementById('status-light').className = 'status-indicator status-online';

                }, 1500);
            }, 500);
        }

        function addMsg(role, text) {
            const id = 'msg-' + Date.now();
            const win = document.getElementById('chat-window');
            const div = document.createElement('div');
            div.id = id;
            div.className = `msg msg-${role}`;
            div.innerHTML = `<div class="content">${text}</div>`;
            win.appendChild(div);
            win.scrollTo({top: win.scrollHeight, behavior: 'smooth'});
            return id;
        }

        document.getElementById('criticism-level').addEventListener('input', (e) => {
            document.getElementById('criticism-display').innerText = e.target.value + '%';
        });

        // Inicializar
        document.getElementById('status-light').className = 'status-indicator status-online';
        updateCorrectionLog();
    </script>
</body>
</html>
